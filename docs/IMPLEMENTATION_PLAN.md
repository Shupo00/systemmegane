# 実装計画 (Implementation Plan)

本書は `docs/REQUIREMENTS.md` の要件を実行可能なタスクへ分解し、順序と完了条件を定義します。Issue/PR作成時はここを基準にしてください。

## 1. フェーズとマイルストーン
- MVP: コア機能（主要FR）と最小NFR（性能/監視の基本）。終了条件: 主要FRのDoD達成、p95応答<目標、主要画面のE2E合格。
- β: 追加FR/改善、スケール/UX洗練。終了条件: 重要NFR80%達成。
- GA: 運用要件の最適化、SLA/SLO準拠。

## 2. ワークストリーム
- 初期基盤: プロジェクト雛形、CI、環境変数、エラーログ/メトリクス基盤。
- 認証/認可: ログイン、ロール、保護ルート。
- データモデル/DB: スキーマ設計、マイグレーション、シード。
- API/アプリ層: コントローラ、サービス、バリデーション、エラー整形。
- UI/UX: 画面、フォーム、状態管理、アクセシビリティ。
- 品質: 単体/結合/E2Eテスト、静的解析、性能計測。
- DevOps: ビルド/デプロイ、監視/アラート、ランブック。

## 3. FR別WBSテンプレート（Issue化のチェックリスト）
- [ ] 要件精査: `REQUIREMENTS.md` の受け入れ基準をテスト可能に落とす（FR-XXX）。
- [ ] スキーマ: エンティティ/インデックス設計、マイグレーション追加、リレーション確認。
- [ ] API契約: エンドポイント/DTO/エラー設計（OpenAPIや型で定義）。
- [ ] アプリ層: ユースケース/サービス実装、入力バリデーション。
- [ ] UI: 画面/フォーム/状態管理、アクセシビリティ、ローディング/空状態。
- [ ] 権限/セキュリティ: 認可ガード、監査ログ、入力サニタイズ。
- [ ] テスト: 単体/結合/E2E、モック/フィクスチャ、カバレッジ基準達成。
- [ ] 性能/監視: p95測定、メトリクス/ログ/トレース埋め込み。
- [ ] ドキュメント: `README`/`AGENTS`/API仕様更新、リリースノート草案。

## 4. 例: FRの分解
- FR-001 アイテム作成
  - [ ] スキーマ: `Item{id, title(必須), description, createdAt}` 追加、ユニーク/長さ制約。
  - [ ] API: `POST /api/items` 201/400/401、ボディ検証、エラー整形。
  - [ ] アプリ層: CreateItemUseCase、リポジトリ保存、重複検知。
  - [ ] UI: 作成フォーム、必須/最大長バリデーション、成功後リダイレクト。
  - [ ] テスト: 成功/バリデーション/認可/エラー整形、E2E（フォーム送信）。
- FR-002 アイテム検索
  - [ ] スキーマ: クエリ用インデックス（title部分一致想定）。
  - [ ] API: `GET /api/items?query=...` 200、ページング/ソート。
  - [ ] アプリ層: SearchItemsUseCase、リポジトリ検索、サニタイズ。
  - [ ] UI: 検索入力、結果リスト、空/スケルトン状態。
  - [ ] テスト: 単体/結合/E2E（検索→結果）。

## 5. 依存関係と順序（MVP案）
1) 初期基盤 → 2) データモデル初期化 → 3) 認証 → 4) FR-001 作成 → 5) FR-002 検索 → 6) 監視/計測 → 7) ハードニング（NFR）。

## 6. ブランチ/PR運用とDoD
- ブランチ: `feat/fr-001-create-item` のようにFR/US IDを含める。
- PR: タイトルにID（例: `feat: FR-001 アイテム作成`）、スクショ/ログ/負荷結果を添付。
- Definition of Done
  - [ ] 受け入れ基準を満たすテストが緑
  - [ ] カバレッジしきい値達成（≥80%目安）
  - [ ] ログ/メトリクスが埋め込まれ、ダッシュボードで確認
  - [ ] セキュリティ/権限/エラー整形の確認
  - [ ] ドキュメント更新済

## 7. Issue化ルール
- 命名: `[FR-001] アイテム作成: API` のように粒度ごとに分割。
- ラベル例: `feature`, `backend`, `frontend`, `infra`, `security`, `test`, `nfr`。
- 親子: 親Issue=FR、子Issue=WBS項目。親に進捗チェックリストを設置。

補足: 実際の `REQUIREMENTS.md` のFR/NFR/USに合わせて上記の例を複製・調整してください。必要であれば自動でIssue雛形も生成します。

