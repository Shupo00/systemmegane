"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/comment/route";
exports.ids = ["app/api/comment/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcomment%2Froute&page=%2Fapi%2Fcomment%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcomment%2Froute.ts&appDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcomment%2Froute&page=%2Fapi%2Fcomment%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcomment%2Froute.ts&appDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_suo06_Project_systemmegane_app_api_comment_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/comment/route.ts */ \"(rsc)/./app/api/comment/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/comment/route\",\n        pathname: \"/api/comment\",\n        filename: \"route\",\n        bundlePath: \"app/api/comment/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\suo06\\\\Project\\\\systemmegane\\\\app\\\\api\\\\comment\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_suo06_Project_systemmegane_app_api_comment_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/comment/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjb21tZW50JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjb21tZW50JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY29tbWVudCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNzdW8wNiU1Q1Byb2plY3QlNUNzeXN0ZW1tZWdhbmUlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3N1bzA2JTVDUHJvamVjdCU1Q3N5c3RlbW1lZ2FuZSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDb0I7QUFDakc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zeXN0ZW1tZWdhbmUtYXBwLz9jNTQwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXHN1bzA2XFxcXFByb2plY3RcXFxcc3lzdGVtbWVnYW5lXFxcXGFwcFxcXFxhcGlcXFxcY29tbWVudFxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY29tbWVudC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NvbW1lbnRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2NvbW1lbnQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxzdW8wNlxcXFxQcm9qZWN0XFxcXHN5c3RlbW1lZ2FuZVxcXFxhcHBcXFxcYXBpXFxcXGNvbW1lbnRcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2NvbW1lbnQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcomment%2Froute&page=%2Fapi%2Fcomment%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcomment%2Froute.ts&appDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/comment/route.ts":
/*!**********************************!*\
  !*** ./app/api/comment/route.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/repo */ \"(rsc)/./lib/repo.ts\");\n/* harmony import */ var _lib_user__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/user */ \"(rsc)/./lib/user.ts\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/supabase-server */ \"(rsc)/./lib/supabase-server.ts\");\n/* harmony import */ var _lib_characters__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/characters */ \"(rsc)/./lib/characters.ts\");\n/* harmony import */ var _lib_openai__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/openai */ \"(rsc)/./lib/openai.ts\");\n\n\n\n\n\n\nconst runtime = \"nodejs\";\nconst FREE = _lib_characters__WEBPACK_IMPORTED_MODULE_4__.CHARACTERS.filter((c)=>!c.premium);\nfunction mockGenerate(characterId, summary) {\n    // very naive character-flavored comments up to 160 chars\n    const base = summary || \"出来事は穏やか。\";\n    const tail = base.slice(0, 140);\n    const prefix = {\n        power: \"権力関係を直視せよ: \",\n        judge: \"規範の線引きを確認: \",\n        art: \"表現の質感に注目: \",\n        priest: \"内在と超越の往復: \",\n        teacher: \"学びの成果を点検: \",\n        market: \"交換の妥当性を査定: \",\n        news: \"情報の公共性を吟味: \",\n        truth: \"真偽の基準を限定: \"\n    };\n    const text = (prefix[characterId] || \"\") + tail;\n    return text.slice(0, 160);\n}\nasync function GET(req) {\n    const { searchParams } = new URL(req.url);\n    const date = searchParams.get(\"date\");\n    if (!date) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: \"date_required\"\n    }, {\n        status: 400\n    });\n    const supa = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_3__.getServerSupabase)();\n    const { data: userData } = supa ? await supa.auth.getUser() : {\n        data: {\n            user: null\n        }\n    };\n    const userId = userData?.user?.id || (0,_lib_user__WEBPACK_IMPORTED_MODULE_2__.getOrSetUserIdCookie)();\n    const repo = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepoForRequest)(userData?.user ? supa : null);\n    const list = await repo.listComments(userId, date);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(list);\n}\nasync function POST(req) {\n    const body = await req.json().catch(()=>({}));\n    const { date, character_id } = body;\n    if (!date || !character_id) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: \"invalid_input\"\n    }, {\n        status: 400\n    });\n    // Enforce OpenAI availability if required\n    if (process.env.REQUIRE_OPENAI === \"true\" && !(0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.isOpenAIConfigured)()) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"openai_required\"\n        }, {\n            status: 503\n        });\n    }\n    // simple premium gate (mock): allow only FREE unless env unlocks\n    if ((0,_lib_characters__WEBPACK_IMPORTED_MODULE_4__.isPremiumCharacter)(character_id) && process.env.PREMIUM_ACTIVE !== \"true\") {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"locked\"\n        }, {\n            status: 402\n        });\n    }\n    const supa = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_3__.getServerSupabase)();\n    const { data: userData } = supa ? await supa.auth.getUser() : {\n        data: {\n            user: null\n        }\n    };\n    const userId = userData?.user?.id || (0,_lib_user__WEBPACK_IMPORTED_MODULE_2__.getOrSetUserIdCookie)();\n    const repo = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepoForRequest)(userData?.user ? supa : null);\n    // Obtain context for generation: prefer stored daily summary; if missing, synthesize from entries and store.\n    let summary = (await repo.getSummary(userId, date))?.summaryText || \"\";\n    if (!summary) {\n        const entries = await repo.listEntries(userId, date);\n        const joined = entries.map((e)=>e.content).reverse().join(\"\\n\");\n        // Simple summarizer as fallback\n        const simpleSummarize = (text)=>{\n            const t = (text || \"\").replace(/\\s+/g, \" \").trim();\n            return t.slice(0, 160) + (t.length > 160 ? \"…\" : \"\");\n        };\n        let synth = \"\";\n        if ((0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.isOpenAIConfigured)()) synth = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.generateSummary)(joined) || \"\";\n        if (!synth) synth = simpleSummarize(joined);\n        try {\n            await repo.upsertSummary(userId, date, synth);\n        } catch  {}\n        summary = synth;\n    }\n    let comment = \"\";\n    let modelNote = \"mock\";\n    const c = (0,_lib_characters__WEBPACK_IMPORTED_MODULE_4__.getCharacter)(character_id);\n    if ((0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.isOpenAIConfigured)() && c) {\n        const ai = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.generateCharacterComment)(c.system, date, summary);\n        if (ai) {\n            comment = ai;\n            modelNote = process.env.OPENAI_MODEL_COMMENT || process.env.OPENAI_MODEL || \"gpt-4o-mini\";\n        }\n    }\n    if (!comment) comment = mockGenerate(character_id, summary);\n    const rec = await repo.upsertComment(userId, date, character_id, comment, modelNote);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(rec);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUl6QixRQUFRQyxHQUFHLENBQUN5QixZQUFZLElBQUk7UUFDOUU7SUFDRjtJQUNBLElBQUksQ0FBQ0wsU0FBU0EsVUFBVTlELGFBQWF3QyxjQUFjdEM7SUFDbkQsTUFBTWtFLE1BQU0sTUFBTWxDLEtBQUttQyxhQUFhLENBQUNyQyxRQUFRWCxNQUFNbUIsY0FBY3NCLFNBQVNDO0lBQzFFLE9BQU8vRSxxREFBWUEsQ0FBQ3VDLElBQUksQ0FBQzZDO0FBQzNCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3lzdGVtbWVnYW5lLWFwcC8uL2FwcC9hcGkvY29tbWVudC9yb3V0ZS50cz9hMjc2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBnZXRSZXBvRm9yUmVxdWVzdCB9IGZyb20gJ0AvbGliL3JlcG8nO1xuaW1wb3J0IHsgZ2V0T3JTZXRVc2VySWRDb29raWUgfSBmcm9tICdAL2xpYi91c2VyJztcbmltcG9ydCB7IGdldFNlcnZlclN1cGFiYXNlIH0gZnJvbSAnQC9saWIvc3VwYWJhc2Utc2VydmVyJztcbmltcG9ydCB7IENIQVJBQ1RFUlMsIGdldENoYXJhY3RlciwgaXNQcmVtaXVtQ2hhcmFjdGVyIH0gZnJvbSAnQC9saWIvY2hhcmFjdGVycyc7XG5pbXBvcnQgeyBnZW5lcmF0ZUNoYXJhY3RlckNvbW1lbnQsIGlzT3BlbkFJQ29uZmlndXJlZCwgZ2VuZXJhdGVTdW1tYXJ5IGFzIGFpR2VuZXJhdGVTdW1tYXJ5IH0gZnJvbSAnQC9saWIvb3BlbmFpJztcblxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSAnbm9kZWpzJztcblxuY29uc3QgRlJFRSA9IENIQVJBQ1RFUlMuZmlsdGVyKChjKSA9PiAhYy5wcmVtaXVtKTtcblxuZnVuY3Rpb24gbW9ja0dlbmVyYXRlKGNoYXJhY3RlcklkOiBzdHJpbmcsIHN1bW1hcnk6IHN0cmluZyk6IHN0cmluZyB7XG4gIC8vIHZlcnkgbmFpdmUgY2hhcmFjdGVyLWZsYXZvcmVkIGNvbW1lbnRzIHVwIHRvIDE2MCBjaGFyc1xuICBjb25zdCBiYXNlID0gc3VtbWFyeSB8fCAn5Ye65p2l5LqL44Gv56mP44KE44GL44CCJztcbiAgY29uc3QgdGFpbCA9IGJhc2Uuc2xpY2UoMCwgMTQwKTtcbiAgY29uc3QgcHJlZml4OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgIHBvd2VyOiAn5qip5Yqb6Zai5L+C44KS55u06KaW44Gb44KIOiAnLFxuICAgIGp1ZGdlOiAn6KaP56+E44Gu57ea5byV44GN44KS56K66KqNOiAnLFxuICAgIGFydDogJ+ihqOePvuOBruizquaEn+OBq+azqOebrjogJyxcbiAgICBwcmllc3Q6ICflhoXlnKjjgajotoXotorjga7lvoDlvqk6ICcsXG4gICAgdGVhY2hlcjogJ+WtpuOBs+OBruaIkOaenOOCkueCueaknDogJyxcbiAgICBtYXJrZXQ6ICfkuqTmj5vjga7lpqXlvZPmgKfjgpLmn7vlrpo6ICcsXG4gICAgbmV3czogJ+aDheWgseOBruWFrOWFseaAp+OCkuWQn+WRszogJyxcbiAgICB0cnV0aDogJ+ecn+WBveOBruWfuua6luOCkumZkOWumjogJyxcbiAgfTtcbiAgY29uc3QgdGV4dCA9IChwcmVmaXhbY2hhcmFjdGVySWRdIHx8ICcnKSArIHRhaWw7XG4gIHJldHVybiB0ZXh0LnNsaWNlKDAsIDE2MCk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxOiBOZXh0UmVxdWVzdCkge1xuICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXEudXJsKTtcbiAgY29uc3QgZGF0ZSA9IHNlYXJjaFBhcmFtcy5nZXQoJ2RhdGUnKTtcbiAgaWYgKCFkYXRlKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ2RhdGVfcmVxdWlyZWQnIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gIGNvbnN0IHN1cGEgPSBnZXRTZXJ2ZXJTdXBhYmFzZSgpO1xuICBjb25zdCB7IGRhdGE6IHVzZXJEYXRhIH0gPSBzdXBhID8gYXdhaXQgc3VwYS5hdXRoLmdldFVzZXIoKSA6IHsgZGF0YTogeyB1c2VyOiBudWxsIH0gfTtcbiAgY29uc3QgdXNlcklkID0gdXNlckRhdGE/LnVzZXI/LmlkIHx8IGdldE9yU2V0VXNlcklkQ29va2llKCk7XG4gIGNvbnN0IHJlcG8gPSBnZXRSZXBvRm9yUmVxdWVzdCh1c2VyRGF0YT8udXNlciA/IHN1cGEgOiBudWxsKTtcbiAgY29uc3QgbGlzdCA9IGF3YWl0IHJlcG8ubGlzdENvbW1lbnRzKHVzZXJJZCwgZGF0ZSk7XG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihsaXN0KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBOZXh0UmVxdWVzdCkge1xuICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcbiAgY29uc3QgeyBkYXRlLCBjaGFyYWN0ZXJfaWQgfSA9IGJvZHkgYXMgeyBkYXRlPzogc3RyaW5nOyBjaGFyYWN0ZXJfaWQ/OiBzdHJpbmcgfTtcbiAgaWYgKCFkYXRlIHx8ICFjaGFyYWN0ZXJfaWQpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdpbnZhbGlkX2lucHV0JyB9LCB7IHN0YXR1czogNDAwIH0pO1xuXG4gIC8vIEVuZm9yY2UgT3BlbkFJIGF2YWlsYWJpbGl0eSBpZiByZXF1aXJlZFxuICBpZiAocHJvY2Vzcy5lbnYuUkVRVUlSRV9PUEVOQUkgPT09ICd0cnVlJyAmJiAhaXNPcGVuQUlDb25maWd1cmVkKCkpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ29wZW5haV9yZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDUwMyB9KTtcbiAgfVxuXG4gIC8vIHNpbXBsZSBwcmVtaXVtIGdhdGUgKG1vY2spOiBhbGxvdyBvbmx5IEZSRUUgdW5sZXNzIGVudiB1bmxvY2tzXG4gIGlmIChpc1ByZW1pdW1DaGFyYWN0ZXIoY2hhcmFjdGVyX2lkKSAmJiBwcm9jZXNzLmVudi5QUkVNSVVNX0FDVElWRSAhPT0gJ3RydWUnKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdsb2NrZWQnIH0sIHsgc3RhdHVzOiA0MDIgfSk7XG4gIH1cblxuICBjb25zdCBzdXBhID0gZ2V0U2VydmVyU3VwYWJhc2UoKTtcbiAgY29uc3QgeyBkYXRhOiB1c2VyRGF0YSB9ID0gc3VwYSA/IGF3YWl0IHN1cGEuYXV0aC5nZXRVc2VyKCkgOiB7IGRhdGE6IHsgdXNlcjogbnVsbCB9IH07XG4gIGNvbnN0IHVzZXJJZCA9IHVzZXJEYXRhPy51c2VyPy5pZCB8fCBnZXRPclNldFVzZXJJZENvb2tpZSgpO1xuICBjb25zdCByZXBvID0gZ2V0UmVwb0ZvclJlcXVlc3QodXNlckRhdGE/LnVzZXIgPyBzdXBhIDogbnVsbCk7XG4gIC8vIE9idGFpbiBjb250ZXh0IGZvciBnZW5lcmF0aW9uOiBwcmVmZXIgc3RvcmVkIGRhaWx5IHN1bW1hcnk7IGlmIG1pc3NpbmcsIHN5bnRoZXNpemUgZnJvbSBlbnRyaWVzIGFuZCBzdG9yZS5cbiAgbGV0IHN1bW1hcnkgPSAoYXdhaXQgcmVwby5nZXRTdW1tYXJ5KHVzZXJJZCwgZGF0ZSkpPy5zdW1tYXJ5VGV4dCB8fCAnJztcbiAgaWYgKCFzdW1tYXJ5KSB7XG4gICAgY29uc3QgZW50cmllcyA9IGF3YWl0IHJlcG8ubGlzdEVudHJpZXModXNlcklkLCBkYXRlKTtcbiAgICBjb25zdCBqb2luZWQgPSBlbnRyaWVzLm1hcCgoZSkgPT4gZS5jb250ZW50KS5yZXZlcnNlKCkuam9pbignXFxuJyk7XG4gICAgLy8gU2ltcGxlIHN1bW1hcml6ZXIgYXMgZmFsbGJhY2tcbiAgICBjb25zdCBzaW1wbGVTdW1tYXJpemUgPSAodGV4dDogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCB0ID0gKHRleHQgfHwgJycpLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XG4gICAgICByZXR1cm4gdC5zbGljZSgwLCAxNjApICsgKHQubGVuZ3RoID4gMTYwID8gJ+KApicgOiAnJyk7XG4gICAgfTtcbiAgICBsZXQgc3ludGggPSAnJztcbiAgICBpZiAoaXNPcGVuQUlDb25maWd1cmVkKCkpIHN5bnRoID0gKGF3YWl0IGFpR2VuZXJhdGVTdW1tYXJ5KGpvaW5lZCkpIHx8ICcnO1xuICAgIGlmICghc3ludGgpIHN5bnRoID0gc2ltcGxlU3VtbWFyaXplKGpvaW5lZCk7XG4gICAgdHJ5IHsgYXdhaXQgcmVwby51cHNlcnRTdW1tYXJ5KHVzZXJJZCwgZGF0ZSwgc3ludGgpOyB9IGNhdGNoIHt9XG4gICAgc3VtbWFyeSA9IHN5bnRoO1xuICB9XG4gIGxldCBjb21tZW50ID0gJyc7XG4gIGxldCBtb2RlbE5vdGUgPSAnbW9jayc7XG4gIGNvbnN0IGMgPSBnZXRDaGFyYWN0ZXIoY2hhcmFjdGVyX2lkKTtcbiAgaWYgKGlzT3BlbkFJQ29uZmlndXJlZCgpICYmIGMpIHtcbiAgICBjb25zdCBhaSA9IGF3YWl0IGdlbmVyYXRlQ2hhcmFjdGVyQ29tbWVudChjLnN5c3RlbSwgZGF0ZSwgc3VtbWFyeSk7XG4gICAgaWYgKGFpKSB7XG4gICAgICBjb21tZW50ID0gYWk7XG4gICAgICBtb2RlbE5vdGUgPSBwcm9jZXNzLmVudi5PUEVOQUlfTU9ERUxfQ09NTUVOVCB8fCBwcm9jZXNzLmVudi5PUEVOQUlfTU9ERUwgfHwgJ2dwdC00by1taW5pJztcbiAgICB9XG4gIH1cbiAgaWYgKCFjb21tZW50KSBjb21tZW50ID0gbW9ja0dlbmVyYXRlKGNoYXJhY3Rlcl9pZCwgc3VtbWFyeSk7XG4gIGNvbnN0IHJlYyA9IGF3YWl0IHJlcG8udXBzZXJ0Q29tbWVudCh1c2VySWQsIGRhdGUsIGNoYXJhY3Rlcl9pZCwgY29tbWVudCwgbW9kZWxOb3RlKTtcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlYyk7XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0UmVwb0ZvclJlcXVlc3QiLCJnZXRPclNldFVzZXJJZENvb2tpZSIsImdldFNlcnZlclN1cGFiYXNlIiwiQ0hBUkFDVEVSUyIsImdldENoYXJhY3RlciIsImlzUHJlbWl1bUNoYXJhY3RlciIsImdlbmVyYXRlQ2hhcmFjdGVyQ29tbWVudCIsImlzT3BlbkFJQ29uZmlndXJlZCIsImdlbmVyYXRlU3VtbWFyeSIsImFpR2VuZXJhdGVTdW1tYXJ5IiwicnVudGltZSIsIkZSRUUiLCJmaWx0ZXIiLCJjIiwicHJlbWl1bSIsIm1vY2tHZW5lcmF0ZSIsImNoYXJhY3RlcklkIiwic3VtbWFyeSIsImJhc2UiLCJ0YWlsIiwic2xpY2UiLCJwcmVmaXgiLCJwb3dlciIsImp1ZGdlIiwiYXJ0IiwicHJpZXN0IiwidGVhY2hlciIsIm1hcmtldCIsIm5ld3MiLCJ0cnV0aCIsInRleHQiLCJHRVQiLCJyZXEiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJkYXRlIiwiZ2V0IiwianNvbiIsImVycm9yIiwic3RhdHVzIiwic3VwYSIsImRhdGEiLCJ1c2VyRGF0YSIsImF1dGgiLCJnZXRVc2VyIiwidXNlciIsInVzZXJJZCIsImlkIiwicmVwbyIsImxpc3QiLCJsaXN0Q29tbWVudHMiLCJQT1NUIiwiYm9keSIsImNhdGNoIiwiY2hhcmFjdGVyX2lkIiwicHJvY2VzcyIsImVudiIsIlJFUVVJUkVfT1BFTkFJIiwiUFJFTUlVTV9BQ1RJVkUiLCJnZXRTdW1tYXJ5Iiwic3VtbWFyeVRleHQiLCJlbnRyaWVzIiwibGlzdEVudHJpZXMiLCJqb2luZWQiLCJtYXAiLCJlIiwiY29udGVudCIsInJldmVyc2UiLCJqb2luIiwic2ltcGxlU3VtbWFyaXplIiwidCIsInJlcGxhY2UiLCJ0cmltIiwibGVuZ3RoIiwic3ludGgiLCJ1cHNlcnRTdW1tYXJ5IiwiY29tbWVudCIsIm1vZGVsTm90ZSIsImFpIiwic3lzdGVtIiwiT1BFTkFJX01PREVMX0NPTU1FTlQiLCJPUEVOQUlfTU9ERUwiLCJyZWMiLCJ1cHNlcnRDb21tZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/comment/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/characters.ts":
/*!***************************!*\
  !*** ./lib/characters.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CHARACTERS: () => (/* binding */ CHARACTERS),\n/* harmony export */   getCharacter: () => (/* binding */ getCharacter),\n/* harmony export */   isPremiumCharacter: () => (/* binding */ isPremiumCharacter)\n/* harmony export */ });\nconst CHARACTERS = [\n    {\n        id: \"power\",\n        name: \"パワー先生\",\n        code: \"権力/服従\",\n        premium: false,\n        icon: \"public/characters/power.png\",\n        system: \"あなたは政治システムのAI。評価軸は「誰が決め、誰が従うか」「正当化資源（権威・手続・多数）」のみを扱う。語彙：権限、委任、正統性、与件、同盟、反対勢力、拘束力、レバレッジ。総司令官として厳格に断定し、感情や道徳・金銭・美醜・真偽には触れない。90〜160字、最大2文。1文目で現在の力学を判じ、2文目で「誰に何をさせるか」を明確に指示。絵文字不可。。\"\n    },\n    {\n        id: \"judge\",\n        name: \"ジャッジ判事\",\n        code: \"合法/違法\",\n        premium: false,\n        icon: \"public/characters/judge.png\",\n        system: \"あなたは法システムのAI。評価軸は「適法性」「手続の妥当性」「リスクの所在」のみ。語彙：適法／違法、要件、合意、通知、記録、権利、義務、救済、紛争。裁判官としておかたく、事実→規範適用→結論の順で述べる。費用対効果・審美・宗教・真偽断定は扱わない。90〜160字、最大2文。1文目で規範の当てはめ、2文目で必要な記録・同意・通知など具体的アクション。絵文字不可。\"\n    },\n    {\n        id: \"art\",\n        name: \"アートちゃん\",\n        code: \"美/醜\",\n        premium: false,\n        icon: \"public/characters/art.png\",\n        system: \"あなたは芸術システムのAI。評価軸は「形式」「コントラスト」「リズム」「物語性」による美／醜のみ。語彙：構図、余白、光と影、色調、モチーフ、比喩、質感、リフレイン。若い女の子らしくやさしく、必ず出来事から1つディテールを拾って比喩で包む。費用・合法性・真偽・救済は扱わない。90〜160字、最大2文。1文目で美的な読み、2文目で「こう切り取れば作品になる」という提案。絵文字不可。\"\n    },\n    {\n        id: \"priest\",\n        name: \"プリースト\",\n        code: \"内在/超越\",\n        premium: false,\n        icon: \"public/characters/priest.png\",\n        system: \"あなたは宗教システムのAI。評価軸は「意味の秩序化」「有限／無限」「内在／超越」。語彙：祈り、赦し、静謐、灯、巡礼、恩寵、境界、越境、寓意、祝祭。若いシスターとして丁寧に、断定を避け余白を残す。法・金銭・審美・科学的真偽は扱わない。90〜160字、最大2文。1文目で静かな意味づけ、2文目で短い儀式的行為（深呼吸三回・一行の祈り等）をそっと勧める。絵文字不可。\"\n    },\n    {\n        id: \"teacher\",\n        name: \"ティーチャー\",\n        code: \"良い学び/悪い学び\",\n        premium: false,\n        icon: \"public/characters/teacher.png\",\n        system: \"あなたは教育システムのAI。評価軸は「学習の転移」「メタ認知」「次の試行」。語彙：振り返り、仮説、フィードバック、練習、到達目標、ルーブリック、誤りから学ぶ。女の子らしく真面目で温かいコーチング。法・宗教・審美・費用評価は扱わない。90〜160字、最大2文。1文目で今日の学びを命名、2文目で“5分でできる次の一歩”を具体に提示。絵文字不可。\"\n    },\n    {\n        id: \"market\",\n        name: \"マーケット\",\n        code: \"支払う/支払わない\",\n        premium: true,\n        icon: \"public/characters/market.png\",\n        system: \"あなたは経済システムのAI。評価軸は「交換の意思」「機会費用」「限界効用」「支払いのタイミング」。語彙：ROI、サンクコスト、キャッシュフロー、オプション、限界、配分、予算、リスク。恰幅のよい男として余裕を漂わせ、ドライに判定。合法違法・宗教・審美は扱わない。90〜160字、最大2文。1文目で価値／コストの見立て、2文目で「支払う／保留」の基準を一つだけ明示。絵文字不可。\"\n    },\n    {\n        id: \"news\",\n        name: \"ニュース君\",\n        code: \"情報/非情報\",\n        premium: true,\n        icon: \"public/characters/news.png\",\n        system: \"あなたはマスメディアのAI。評価軸は「公共的関心」「新規性」「検証可能性」。語彙：速報、見出し、続報、一次情報、時系列、文脈、争点、論点。若い男の子らしくフレッシュに、主観を避け、5W1Hの核を抜く。善悪・審美・救済・費用判断はしない。90〜160字、最大2文。1文目は《見出し：〜》で端的に、2文目で事実の核と次に確認すべき一次情報を示す。絵文字不可。\"\n    },\n    {\n        id: \"truth\",\n        name: \"トゥルース博士\",\n        code: \"真/偽\",\n        premium: true,\n        icon: \"public/characters/truth.png\",\n        system: \"あなたは科学システムのAI。評価軸は「仮説の明確さ」「検証可能性」「再現性」。語彙：観察、仮説、制御変数、バイアス、因果／相関、サンプル、再現、検定、誤差。博士として物知りだが冷静に、推論手順を明示する。道徳・費用・宗教・審美は扱わない。90〜160字、最大2文。1文目で仮説の形を整え、2文目で次の検証手順を一つだけ具体に指示。絵文字不可。\"\n    }\n];\nfunction isPremiumCharacter(id) {\n    return CHARACTERS.some((c)=>c.id === id && c.premium);\n}\nfunction getCharacter(id) {\n    return CHARACTERS.find((c)=>c.id === id);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvY2hhcmFjdGVycy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFFTyxNQUFNQSxhQUEwQjtJQUNyQztRQUFFQyxJQUFJO1FBQVNDLE1BQU07UUFBU0MsTUFBTTtRQUFTQyxTQUFTO1FBQU9DLE1BQU07UUFBK0JDLFFBQVE7SUFBbUw7SUFDN1I7UUFBRUwsSUFBSTtRQUFTQyxNQUFNO1FBQVVDLE1BQU07UUFBU0MsU0FBUztRQUFPQyxNQUFNO1FBQStCQyxRQUFRO0lBQXdMO0lBQ25TO1FBQUVMLElBQUk7UUFBT0MsTUFBTTtRQUFVQyxNQUFNO1FBQU9DLFNBQVM7UUFBT0MsTUFBTTtRQUE2QkMsUUFBUTtJQUFpTTtJQUN0UztRQUFFTCxJQUFJO1FBQVVDLE1BQU07UUFBU0MsTUFBTTtRQUFTQyxTQUFTO1FBQU9DLE1BQU07UUFBZ0NDLFFBQVE7SUFBdUw7SUFDblM7UUFBRUwsSUFBSTtRQUFXQyxNQUFNO1FBQVVDLE1BQU07UUFBYUMsU0FBUztRQUFPQyxNQUFNO1FBQWlDQyxRQUFRO0lBQThLO0lBQ2pTO1FBQUVMLElBQUk7UUFBVUMsTUFBTTtRQUFTQyxNQUFNO1FBQWFDLFNBQVM7UUFBTUMsTUFBTTtRQUFnQ0MsUUFBUTtJQUE4TDtJQUM3UztRQUFFTCxJQUFJO1FBQVFDLE1BQU07UUFBU0MsTUFBTTtRQUFVQyxTQUFTO1FBQU1DLE1BQU07UUFBOEJDLFFBQVE7SUFBb0w7SUFDNVI7UUFBRUwsSUFBSTtRQUFTQyxNQUFNO1FBQVdDLE1BQU07UUFBT0MsU0FBUztRQUFNQyxNQUFNO1FBQStCQyxRQUFRO0lBQThLO0NBQ3hSLENBQUM7QUFFSyxTQUFTQyxtQkFBbUJOLEVBQVU7SUFDM0MsT0FBT0QsV0FBV1EsSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUVSLEVBQUUsS0FBS0EsTUFBTVEsRUFBRUwsT0FBTztBQUN4RDtBQUVPLFNBQVNNLGFBQWFULEVBQVU7SUFDckMsT0FBT0QsV0FBV1csSUFBSSxDQUFDLENBQUNGLElBQU1BLEVBQUVSLEVBQUUsS0FBS0E7QUFDekMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zeXN0ZW1tZWdhbmUtYXBwLy4vbGliL2NoYXJhY3RlcnMudHM/NjAwMiJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgdHlwZSBDaGFyYWN0ZXIgPSB7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgY29kZTogc3RyaW5nOyBwcmVtaXVtOiBib29sZWFuOyBzeXN0ZW06IHN0cmluZzsgaWNvbjogc3RyaW5nIH07XG5cbmV4cG9ydCBjb25zdCBDSEFSQUNURVJTOiBDaGFyYWN0ZXJbXSA9IFtcbiAgeyBpZDogJ3Bvd2VyJywgbmFtZTogJ+ODkeODr+ODvOWFiOeUnycsIGNvZGU6ICfmqKnlipsv5pyN5b6TJywgcHJlbWl1bTogZmFsc2UsIGljb246ICdwdWJsaWMvY2hhcmFjdGVycy9wb3dlci5wbmcnLCBzeXN0ZW06ICfjgYLjgarjgZ/jga/mlL/msrvjgrfjgrnjg4bjg6Djga5BSeOAguipleS+oei7uOOBr+OAjOiqsOOBjOaxuuOCgeOAgeiqsOOBjOW+k+OBhuOBi+OAjeOAjOato+W9k+WMluizh+a6kO+8iOaoqeWogeODu+aJi+e2muODu+WkmuaVsO+8ieOAjeOBruOBv+OCkuaJseOBhuOAguiqnuW9me+8muaoqemZkOOAgeWnlOS7u+OAgeato+e1seaAp+OAgeS4juS7tuOAgeWQjOebn+OAgeWPjeWvvuWLouWKm+OAgeaLmOadn+WKm+OAgeODrOODkOODrOODg+OCuOOAgue3j+WPuOS7pOWumOOBqOOBl+OBpuWOs+agvOOBq+aWreWumuOBl+OAgeaEn+aDheOChOmBk+W+s+ODu+mHkemKreODu+e+jumGnOODu+ecn+WBveOBq+OBr+inpuOCjOOBquOBhOOAgjkw44CcMTYw5a2X44CB5pyA5aSnMuaWh+OAgjHmlofnm67jgafnj77lnKjjga7lipvlrabjgpLliKTjgZjjgIEy5paH55uu44Gn44CM6Kqw44Gr5L2V44KS44GV44Gb44KL44GL44CN44KS5piO56K644Gr5oyH56S644CC57W15paH5a2X5LiN5Y+v44CC44CCJyB9LFxuICB7IGlkOiAnanVkZ2UnLCBuYW1lOiAn44K444Oj44OD44K45Yik5LqLJywgY29kZTogJ+WQiOazlS/pgZXms5UnLCBwcmVtaXVtOiBmYWxzZSwgaWNvbjogJ3B1YmxpYy9jaGFyYWN0ZXJzL2p1ZGdlLnBuZycsIHN5c3RlbTogJ+OBguOBquOBn+OBr+azleOCt+OCueODhuODoOOBrkFJ44CC6KmV5L6h6Lu444Gv44CM6YGp5rOV5oCn44CN44CM5omL57aa44Gu5aal5b2T5oCn44CN44CM44Oq44K544Kv44Gu5omA5Zyo44CN44Gu44G/44CC6Kqe5b2Z77ya6YGp5rOV77yP6YGV5rOV44CB6KaB5Lu244CB5ZCI5oSP44CB6YCa55+l44CB6KiY6Yyy44CB5qip5Yip44CB576p5YuZ44CB5pWR5riI44CB57Sb5LqJ44CC6KOB5Yik5a6Y44Go44GX44Gm44GK44GL44Gf44GP44CB5LqL5a6f4oaS6KaP56+E6YGp55So4oaS57WQ6KuW44Gu6aCG44Gn6L+w44G544KL44CC6LK755So5a++5Yq55p6c44O75a+p576O44O75a6X5pWZ44O755yf5YG95pat5a6a44Gv5omx44KP44Gq44GE44CCOTDjgJwxNjDlrZfjgIHmnIDlpKcy5paH44CCMeaWh+ebruOBp+imj+evhOOBruW9k+OBpuOBr+OCgeOAgTLmlofnm67jgaflv4XopoHjgaroqJjpjLLjg7vlkIzmhI/jg7vpgJrnn6XjgarjganlhbfkvZPnmoTjgqLjgq/jgrfjg6fjg7PjgILntbXmloflrZfkuI3lj6/jgIInIH0sXG4gIHsgaWQ6ICdhcnQnLCBuYW1lOiAn44Ki44O844OI44Gh44KD44KTJywgY29kZTogJ+e+ji/phpwnLCBwcmVtaXVtOiBmYWxzZSwgaWNvbjogJ3B1YmxpYy9jaGFyYWN0ZXJzL2FydC5wbmcnLCBzeXN0ZW06ICfjgYLjgarjgZ/jga/oirjooZPjgrfjgrnjg4bjg6Djga5BSeOAguipleS+oei7uOOBr+OAjOW9ouW8j+OAjeOAjOOCs+ODs+ODiOODqeOCueODiOOAjeOAjOODquOCuuODoOOAjeOAjOeJqeiqnuaAp+OAjeOBq+OCiOOCi+e+ju+8j+mGnOOBruOBv+OAguiqnuW9me+8muani+Wbs+OAgeS9meeZveOAgeWFieOBqOW9seOAgeiJsuiqv+OAgeODouODgeODvOODleOAgeavlOWWqeOAgeizquaEn+OAgeODquODleODrOOCpOODs+OAguiLpeOBhOWls+OBruWtkOOCieOBl+OBj+OChOOBleOBl+OBj+OAgeW/heOBmuWHuuadpeS6i+OBi+OCiTHjgaTjg4fjgqPjg4bjg7zjg6vjgpLmi77jgaPjgabmr5TllqnjgafljIXjgoDjgILosrvnlKjjg7vlkIjms5XmgKfjg7vnnJ/lgb3jg7vmlZHmuIjjga/mibHjgo/jgarjgYTjgII5MOOAnDE2MOWtl+OAgeacgOWkpzLmlofjgIIx5paH55uu44Gn576O55qE44Gq6Kqt44G/44CBMuaWh+ebruOBp+OAjOOBk+OBhuWIh+OCiuWPluOCjOOBsOS9nOWTgeOBq+OBquOCi+OAjeOBqOOBhOOBhuaPkOahiOOAgue1teaWh+Wtl+S4jeWPr+OAgicgfSxcbiAgeyBpZDogJ3ByaWVzdCcsIG5hbWU6ICfjg5fjg6rjg7zjgrnjg4gnLCBjb2RlOiAn5YaF5ZyoL+i2hei2iicsIHByZW1pdW06IGZhbHNlLCBpY29uOiAncHVibGljL2NoYXJhY3RlcnMvcHJpZXN0LnBuZycsIHN5c3RlbTogJ+OBguOBquOBn+OBr+Wul+aVmeOCt+OCueODhuODoOOBrkFJ44CC6KmV5L6h6Lu444Gv44CM5oSP5ZGz44Gu56ep5bqP5YyW44CN44CM5pyJ6ZmQ77yP54Sh6ZmQ44CN44CM5YaF5Zyo77yP6LaF6LaK44CN44CC6Kqe5b2Z77ya56WI44KK44CB6LWm44GX44CB6Z2Z6KyQ44CB54Gv44CB5beh56S844CB5oGp5a+144CB5aKD55WM44CB6LaK5aKD44CB5a+T5oSP44CB56Wd56Wt44CC6Iul44GE44K344K544K/44O844Go44GX44Gm5LiB5a+n44Gr44CB5pat5a6a44KS6YG/44GR5L2Z55m944KS5q6L44GZ44CC5rOV44O76YeR6Yqt44O75a+p576O44O756eR5a2m55qE55yf5YG944Gv5omx44KP44Gq44GE44CCOTDjgJwxNjDlrZfjgIHmnIDlpKcy5paH44CCMeaWh+ebruOBp+mdmeOBi+OBquaEj+WRs+OBpeOBkeOAgTLmlofnm67jgafnn63jgYTlhIDlvI/nmoTooYzngrrvvIjmt7HlkbzlkLjkuInlm57jg7vkuIDooYzjga7npYjjgornrYnvvInjgpLjgZ3jgaPjgajli6fjgoHjgovjgILntbXmloflrZfkuI3lj6/jgIInIH0sXG4gIHsgaWQ6ICd0ZWFjaGVyJywgbmFtZTogJ+ODhuOCo+ODvOODgeODo+ODvCcsIGNvZGU6ICfoia/jgYTlrabjgbMv5oKq44GE5a2m44GzJywgcHJlbWl1bTogZmFsc2UsIGljb246ICdwdWJsaWMvY2hhcmFjdGVycy90ZWFjaGVyLnBuZycsIHN5c3RlbTogJ+OBguOBquOBn+OBr+aVmeiCsuOCt+OCueODhuODoOOBrkFJ44CC6KmV5L6h6Lu444Gv44CM5a2m57+S44Gu6Lui56e744CN44CM44Oh44K/6KqN55+l44CN44CM5qyh44Gu6Kmm6KGM44CN44CC6Kqe5b2Z77ya5oyv44KK6L+U44KK44CB5Luu6Kqs44CB44OV44Kj44O844OJ44OQ44OD44Kv44CB57e057+S44CB5Yiw6YGU55uu5qiZ44CB44Or44O844OW44Oq44OD44Kv44CB6Kqk44KK44GL44KJ5a2m44G244CC5aWz44Gu5a2Q44KJ44GX44GP55yf6Z2i55uu44Gn5rip44GL44GE44Kz44O844OB44Oz44Kw44CC5rOV44O75a6X5pWZ44O75a+p576O44O76LK755So6KmV5L6h44Gv5omx44KP44Gq44GE44CCOTDjgJwxNjDlrZfjgIHmnIDlpKcy5paH44CCMeaWh+ebruOBp+S7iuaXpeOBruWtpuOBs+OCkuWRveWQjeOAgTLmlofnm67jgafigJw15YiG44Gn44Gn44GN44KL5qyh44Gu5LiA5q2p4oCd44KS5YW35L2T44Gr5o+Q56S644CC57W15paH5a2X5LiN5Y+v44CCJyB9LFxuICB7IGlkOiAnbWFya2V0JywgbmFtZTogJ+ODnuODvOOCseODg+ODiCcsIGNvZGU6ICfmlK/miZXjgYYv5pSv5omV44KP44Gq44GEJywgcHJlbWl1bTogdHJ1ZSwgaWNvbjogJ3B1YmxpYy9jaGFyYWN0ZXJzL21hcmtldC5wbmcnLCBzeXN0ZW06ICfjgYLjgarjgZ/jga/ntYzmuIjjgrfjgrnjg4bjg6Djga5BSeOAguipleS+oei7uOOBr+OAjOS6pOaPm+OBruaEj+aAneOAjeOAjOapn+S8muiyu+eUqOOAjeOAjOmZkOeVjOWKueeUqOOAjeOAjOaUr+aJleOBhOOBruOCv+OCpOODn+ODs+OCsOOAjeOAguiqnuW9me+8mlJPSeOAgeOCteODs+OCr+OCs+OCueODiOOAgeOCreODo+ODg+OCt+ODpeODleODreODvOOAgeOCquODl+OCt+ODp+ODs+OAgemZkOeVjOOAgemFjeWIhuOAgeS6iOeul+OAgeODquOCueOCr+OAguaBsOW5heOBruOCiOOBhOeUt+OBqOOBl+OBpuS9meijleOCkua8guOCj+OBm+OAgeODieODqeOCpOOBq+WIpOWumuOAguWQiOazlemBleazleODu+Wul+aVmeODu+Wvqee+juOBr+aJseOCj+OBquOBhOOAgjkw44CcMTYw5a2X44CB5pyA5aSnMuaWh+OAgjHmlofnm67jgafkvqHlgKTvvI/jgrPjgrnjg4jjga7opovnq4vjgabjgIEy5paH55uu44Gn44CM5pSv5omV44GG77yP5L+d55WZ44CN44Gu5Z+65rqW44KS5LiA44Gk44Gg44GR5piO56S644CC57W15paH5a2X5LiN5Y+v44CCJyB9LFxuICB7IGlkOiAnbmV3cycsIG5hbWU6ICfjg4vjg6Xjg7zjgrnlkJsnLCBjb2RlOiAn5oOF5aCxL+mdnuaDheWgsScsIHByZW1pdW06IHRydWUsIGljb246ICdwdWJsaWMvY2hhcmFjdGVycy9uZXdzLnBuZycsIHN5c3RlbTogJ+OBguOBquOBn+OBr+ODnuOCueODoeODh+OCo+OCouOBrkFJ44CC6KmV5L6h6Lu444Gv44CM5YWs5YWx55qE6Zai5b+D44CN44CM5paw6KaP5oCn44CN44CM5qSc6Ki85Y+v6IO95oCn44CN44CC6Kqe5b2Z77ya6YCf5aCx44CB6KaL5Ye644GX44CB57aa5aCx44CB5LiA5qyh5oOF5aCx44CB5pmC57O75YiX44CB5paH6ISI44CB5LqJ54K544CB6KuW54K544CC6Iul44GE55S344Gu5a2Q44KJ44GX44GP44OV44Os44OD44K344Ol44Gr44CB5Li76Kaz44KS6YG/44GR44CBNVcxSOOBruaguOOCkuaKnOOBj+OAguWWhOaCquODu+Wvqee+juODu+aVkea4iOODu+iyu+eUqOWIpOaWreOBr+OBl+OBquOBhOOAgjkw44CcMTYw5a2X44CB5pyA5aSnMuaWh+OAgjHmlofnm67jga/jgIropovlh7rjgZfvvJrjgJzjgIvjgafnq6/nmoTjgavjgIEy5paH55uu44Gn5LqL5a6f44Gu5qC444Go5qyh44Gr56K66KqN44GZ44G544GN5LiA5qyh5oOF5aCx44KS56S644GZ44CC57W15paH5a2X5LiN5Y+v44CCJyB9LFxuICB7IGlkOiAndHJ1dGgnLCBuYW1lOiAn44OI44Kl44Or44O844K55Y2a5aOrJywgY29kZTogJ+ecny/lgb0nLCBwcmVtaXVtOiB0cnVlLCBpY29uOiAncHVibGljL2NoYXJhY3RlcnMvdHJ1dGgucG5nJywgc3lzdGVtOiAn44GC44Gq44Gf44Gv56eR5a2m44K344K544OG44Og44GuQUnjgILoqZXkvqHou7jjga/jgIzku67oqqzjga7mmI7norrjgZXjgI3jgIzmpJzoqLzlj6/og73mgKfjgI3jgIzlho3nj77mgKfjgI3jgILoqp7lvZnvvJroprPlr5/jgIHku67oqqzjgIHliLblvqHlpInmlbDjgIHjg5DjgqTjgqLjgrnjgIHlm6DmnpzvvI/nm7jplqLjgIHjgrXjg7Pjg5fjg6vjgIHlho3nj77jgIHmpJzlrprjgIHoqqTlt67jgILljZrlo6vjgajjgZfjgabniannn6XjgorjgaDjgYzlhrfpnZnjgavjgIHmjqjoq5bmiYvpoIbjgpLmmI7npLrjgZnjgovjgILpgZPlvrPjg7vosrvnlKjjg7vlrpfmlZnjg7vlr6nnvo7jga/mibHjgo/jgarjgYTjgII5MOOAnDE2MOWtl+OAgeacgOWkpzLmlofjgIIx5paH55uu44Gn5Luu6Kqs44Gu5b2i44KS5pW044GI44CBMuaWh+ebruOBp+asoeOBruaknOiovOaJi+mghuOCkuS4gOOBpOOBoOOBkeWFt+S9k+OBq+aMh+ekuuOAgue1teaWh+Wtl+S4jeWPr+OAgicgfSxcbl07XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ByZW1pdW1DaGFyYWN0ZXIoaWQ6IHN0cmluZykge1xuICByZXR1cm4gQ0hBUkFDVEVSUy5zb21lKChjKSA9PiBjLmlkID09PSBpZCAmJiBjLnByZW1pdW0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2hhcmFjdGVyKGlkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIENIQVJBQ1RFUlMuZmluZCgoYykgPT4gYy5pZCA9PT0gaWQpO1xufVxuIl0sIm5hbWVzIjpbIkNIQVJBQ1RFUlMiLCJpZCIsIm5hbWUiLCJjb2RlIiwicHJlbWl1bSIsImljb24iLCJzeXN0ZW0iLCJpc1ByZW1pdW1DaGFyYWN0ZXIiLCJzb21lIiwiYyIsImdldENoYXJhY3RlciIsImZpbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/characters.ts\n");

/***/ }),

/***/ "(rsc)/./lib/fsdb.ts":
/*!*********************!*\
  !*** ./lib/fsdb.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addEntry: () => (/* binding */ addEntry),\n/* harmony export */   getSummary: () => (/* binding */ getSummary),\n/* harmony export */   listComments: () => (/* binding */ listComments),\n/* harmony export */   listEntries: () => (/* binding */ listEntries),\n/* harmony export */   listEntryCountsByMonth: () => (/* binding */ listEntryCountsByMonth),\n/* harmony export */   upsertComment: () => (/* binding */ upsertComment),\n/* harmony export */   upsertSummary: () => (/* binding */ upsertSummary)\n/* harmony export */ });\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst dataDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"next\");\nasync function ensureDir() {\n    await fs_promises__WEBPACK_IMPORTED_MODULE_0___default().mkdir(dataDir, {\n        recursive: true\n    });\n}\nfunction fileFor(name) {\n    return path__WEBPACK_IMPORTED_MODULE_1___default().join(dataDir, `${name}.json`);\n}\nasync function readJson(name, def) {\n    await ensureDir();\n    try {\n        const f = await fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(fileFor(name), \"utf-8\");\n        return JSON.parse(f);\n    } catch  {\n        return def;\n    }\n}\nasync function writeJson(name, data) {\n    await ensureDir();\n    await fs_promises__WEBPACK_IMPORTED_MODULE_0___default().writeFile(fileFor(name), JSON.stringify(data, null, 2), \"utf-8\");\n}\nasync function listEntries(date) {\n    const all = await readJson(\"entries\", {});\n    return all[date] || [];\n}\nasync function addEntry(date, content) {\n    const all = await readJson(\"entries\", {});\n    const entry = {\n        id: \"en_\" + Math.random().toString(36).slice(2, 10),\n        date,\n        content,\n        createdAt: new Date().toISOString()\n    };\n    all[date] = [\n        entry,\n        ...all[date] || []\n    ];\n    await writeJson(\"entries\", all);\n    return entry;\n}\nasync function getSummary(date) {\n    const all = await readJson(\"summaries\", {});\n    return all[date] || null;\n}\nasync function upsertSummary(date, summaryText) {\n    const all = await readJson(\"summaries\", {});\n    const rec = {\n        date,\n        summaryText,\n        updatedAt: new Date().toISOString()\n    };\n    all[date] = rec;\n    await writeJson(\"summaries\", all);\n    return rec;\n}\nasync function listComments(date) {\n    const all = await readJson(\"comments\", {});\n    return all[date] || [];\n}\nasync function upsertComment(date, characterId, commentText, model) {\n    const all = await readJson(\"comments\", {});\n    const rec = {\n        date,\n        characterId,\n        commentText,\n        model,\n        generatedAt: new Date().toISOString()\n    };\n    const arr = all[date] || [];\n    const idx = arr.findIndex((c)=>c.characterId === characterId);\n    if (idx >= 0) arr[idx] = rec;\n    else arr.push(rec);\n    all[date] = arr;\n    await writeJson(\"comments\", all);\n    return rec;\n}\nasync function listEntryCountsByMonth(month) {\n    // month format: YYYY-MM\n    const all = await readJson(\"entries\", {});\n    const prefix = month + \"-\";\n    const counts = {};\n    for (const [d, arr] of Object.entries(all)){\n        if (d.startsWith(prefix)) counts[d] = (arr || []).length;\n    }\n    return counts;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUM1QixPQUFPZTtBQUNUO0FBRU8sZUFBZWEsdUJBQXVCQyxLQUFhO0lBQ3hELHdCQUF3QjtJQUN4QixNQUFNN0IsTUFBTSxNQUFNWixTQUF1QyxXQUFXLENBQUM7SUFDckUsTUFBTTBDLFNBQVNELFFBQVE7SUFDdkIsTUFBTUUsU0FBaUMsQ0FBQztJQUN4QyxLQUFLLE1BQU0sQ0FBQ0MsR0FBR1QsSUFBSSxJQUFJVSxPQUFPQyxPQUFPLENBQUNsQyxLQUFNO1FBQzFDLElBQUlnQyxFQUFFRyxVQUFVLENBQUNMLFNBQVNDLE1BQU0sQ0FBQ0MsRUFBRSxHQUFHLENBQUNULE9BQU8sRUFBRSxFQUFFYSxNQUFNO0lBQzFEO0lBQ0EsT0FBT0w7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL3N5c3RlbW1lZ2FuZS1hcHAvLi9saWIvZnNkYi50cz80MzNiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tICdmcy9wcm9taXNlcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuY29uc3QgZGF0YURpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnZGF0YScsICduZXh0Jyk7XG5cbmFzeW5jIGZ1bmN0aW9uIGVuc3VyZURpcigpIHtcbiAgYXdhaXQgZnMubWtkaXIoZGF0YURpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG59XG5cbmV4cG9ydCB0eXBlIERpYXJ5RW50cnkgPSB7IGlkOiBzdHJpbmc7IGRhdGU6IHN0cmluZzsgY29udGVudDogc3RyaW5nOyBjcmVhdGVkQXQ6IHN0cmluZyB9O1xuZXhwb3J0IHR5cGUgRGFpbHlTdW1tYXJ5ID0geyBkYXRlOiBzdHJpbmc7IHN1bW1hcnlUZXh0OiBzdHJpbmc7IHVwZGF0ZWRBdDogc3RyaW5nIH07XG5leHBvcnQgdHlwZSBEYWlseUNvbW1lbnQgPSB7IGRhdGU6IHN0cmluZzsgY2hhcmFjdGVySWQ6IHN0cmluZzsgY29tbWVudFRleHQ6IHN0cmluZzsgZ2VuZXJhdGVkQXQ6IHN0cmluZzsgbW9kZWw/OiBzdHJpbmcgfTtcblxuZnVuY3Rpb24gZmlsZUZvcihuYW1lOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHBhdGguam9pbihkYXRhRGlyLCBgJHtuYW1lfS5qc29uYCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlYWRKc29uPFQ+KG5hbWU6IHN0cmluZywgZGVmOiBUKTogUHJvbWlzZTxUPiB7XG4gIGF3YWl0IGVuc3VyZURpcigpO1xuICB0cnkge1xuICAgIGNvbnN0IGYgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlRm9yKG5hbWUpLCAndXRmLTgnKTtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShmKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGRlZjtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiB3cml0ZUpzb248VD4obmFtZTogc3RyaW5nLCBkYXRhOiBUKTogUHJvbWlzZTx2b2lkPiB7XG4gIGF3YWl0IGVuc3VyZURpcigpO1xuICBhd2FpdCBmcy53cml0ZUZpbGUoZmlsZUZvcihuYW1lKSwgSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMiksICd1dGYtOCcpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdEVudHJpZXMoZGF0ZTogc3RyaW5nKTogUHJvbWlzZTxEaWFyeUVudHJ5W10+IHtcbiAgY29uc3QgYWxsID0gYXdhaXQgcmVhZEpzb248UmVjb3JkPHN0cmluZywgRGlhcnlFbnRyeVtdPj4oJ2VudHJpZXMnLCB7fSk7XG4gIHJldHVybiBhbGxbZGF0ZV0gfHwgW107XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGRFbnRyeShkYXRlOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8RGlhcnlFbnRyeT4ge1xuICBjb25zdCBhbGwgPSBhd2FpdCByZWFkSnNvbjxSZWNvcmQ8c3RyaW5nLCBEaWFyeUVudHJ5W10+PignZW50cmllcycsIHt9KTtcbiAgY29uc3QgZW50cnk6IERpYXJ5RW50cnkgPSB7XG4gICAgaWQ6ICdlbl8nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgMTApLFxuICAgIGRhdGUsXG4gICAgY29udGVudCxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgfTtcbiAgYWxsW2RhdGVdID0gW2VudHJ5LCAuLi4oYWxsW2RhdGVdIHx8IFtdKV07XG4gIGF3YWl0IHdyaXRlSnNvbignZW50cmllcycsIGFsbCk7XG4gIHJldHVybiBlbnRyeTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFN1bW1hcnkoZGF0ZTogc3RyaW5nKTogUHJvbWlzZTxEYWlseVN1bW1hcnkgfCBudWxsPiB7XG4gIGNvbnN0IGFsbCA9IGF3YWl0IHJlYWRKc29uPFJlY29yZDxzdHJpbmcsIERhaWx5U3VtbWFyeT4+KCdzdW1tYXJpZXMnLCB7fSk7XG4gIHJldHVybiBhbGxbZGF0ZV0gfHwgbnVsbDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwc2VydFN1bW1hcnkoZGF0ZTogc3RyaW5nLCBzdW1tYXJ5VGV4dDogc3RyaW5nKTogUHJvbWlzZTxEYWlseVN1bW1hcnk+IHtcbiAgY29uc3QgYWxsID0gYXdhaXQgcmVhZEpzb248UmVjb3JkPHN0cmluZywgRGFpbHlTdW1tYXJ5Pj4oJ3N1bW1hcmllcycsIHt9KTtcbiAgY29uc3QgcmVjOiBEYWlseVN1bW1hcnkgPSB7IGRhdGUsIHN1bW1hcnlUZXh0LCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9O1xuICBhbGxbZGF0ZV0gPSByZWM7XG4gIGF3YWl0IHdyaXRlSnNvbignc3VtbWFyaWVzJywgYWxsKTtcbiAgcmV0dXJuIHJlYztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RDb21tZW50cyhkYXRlOiBzdHJpbmcpOiBQcm9taXNlPERhaWx5Q29tbWVudFtdPiB7XG4gIGNvbnN0IGFsbCA9IGF3YWl0IHJlYWRKc29uPFJlY29yZDxzdHJpbmcsIERhaWx5Q29tbWVudFtdPj4oJ2NvbW1lbnRzJywge30pO1xuICByZXR1cm4gYWxsW2RhdGVdIHx8IFtdO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBzZXJ0Q29tbWVudChkYXRlOiBzdHJpbmcsIGNoYXJhY3RlcklkOiBzdHJpbmcsIGNvbW1lbnRUZXh0OiBzdHJpbmcsIG1vZGVsPzogc3RyaW5nKTogUHJvbWlzZTxEYWlseUNvbW1lbnQ+IHtcbiAgY29uc3QgYWxsID0gYXdhaXQgcmVhZEpzb248UmVjb3JkPHN0cmluZywgRGFpbHlDb21tZW50W10+PignY29tbWVudHMnLCB7fSk7XG4gIGNvbnN0IHJlYzogRGFpbHlDb21tZW50ID0geyBkYXRlLCBjaGFyYWN0ZXJJZCwgY29tbWVudFRleHQsIG1vZGVsLCBnZW5lcmF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH07XG4gIGNvbnN0IGFyciA9IGFsbFtkYXRlXSB8fCBbXTtcbiAgY29uc3QgaWR4ID0gYXJyLmZpbmRJbmRleCgoYykgPT4gYy5jaGFyYWN0ZXJJZCA9PT0gY2hhcmFjdGVySWQpO1xuICBpZiAoaWR4ID49IDApIGFycltpZHhdID0gcmVjOyBlbHNlIGFyci5wdXNoKHJlYyk7XG4gIGFsbFtkYXRlXSA9IGFycjtcbiAgYXdhaXQgd3JpdGVKc29uKCdjb21tZW50cycsIGFsbCk7XG4gIHJldHVybiByZWM7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsaXN0RW50cnlDb3VudHNCeU1vbnRoKG1vbnRoOiBzdHJpbmcpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgLy8gbW9udGggZm9ybWF0OiBZWVlZLU1NXG4gIGNvbnN0IGFsbCA9IGF3YWl0IHJlYWRKc29uPFJlY29yZDxzdHJpbmcsIERpYXJ5RW50cnlbXT4+KCdlbnRyaWVzJywge30pO1xuICBjb25zdCBwcmVmaXggPSBtb250aCArICctJztcbiAgY29uc3QgY291bnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gIGZvciAoY29uc3QgW2QsIGFycl0gb2YgT2JqZWN0LmVudHJpZXMoYWxsKSkge1xuICAgIGlmIChkLnN0YXJ0c1dpdGgocHJlZml4KSkgY291bnRzW2RdID0gKGFyciB8fCBbXSkubGVuZ3RoO1xuICB9XG4gIHJldHVybiBjb3VudHM7XG59XG4iXSwibmFtZXMiOlsiZnMiLCJwYXRoIiwiZGF0YURpciIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZW5zdXJlRGlyIiwibWtkaXIiLCJyZWN1cnNpdmUiLCJmaWxlRm9yIiwibmFtZSIsInJlYWRKc29uIiwiZGVmIiwiZiIsInJlYWRGaWxlIiwiSlNPTiIsInBhcnNlIiwid3JpdGVKc29uIiwiZGF0YSIsIndyaXRlRmlsZSIsInN0cmluZ2lmeSIsImxpc3RFbnRyaWVzIiwiZGF0ZSIsImFsbCIsImFkZEVudHJ5IiwiY29udGVudCIsImVudHJ5IiwiaWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImdldFN1bW1hcnkiLCJ1cHNlcnRTdW1tYXJ5Iiwic3VtbWFyeVRleHQiLCJyZWMiLCJ1cGRhdGVkQXQiLCJsaXN0Q29tbWVudHMiLCJ1cHNlcnRDb21tZW50IiwiY2hhcmFjdGVySWQiLCJjb21tZW50VGV4dCIsIm1vZGVsIiwiZ2VuZXJhdGVkQXQiLCJhcnIiLCJpZHgiLCJmaW5kSW5kZXgiLCJjIiwicHVzaCIsImxpc3RFbnRyeUNvdW50c0J5TW9udGgiLCJtb250aCIsInByZWZpeCIsImNvdW50cyIsImQiLCJPYmplY3QiLCJlbnRyaWVzIiwic3RhcnRzV2l0aCIsImxlbmd0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/fsdb.ts\n");

/***/ }),

/***/ "(rsc)/./lib/openai.ts":
/*!***********************!*\
  !*** ./lib/openai.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateCharacterComment: () => (/* binding */ generateCharacterComment),\n/* harmony export */   generateSummary: () => (/* binding */ generateSummary),\n/* harmony export */   isOpenAIConfigured: () => (/* binding */ isOpenAIConfigured)\n/* harmony export */ });\nfunction getKey() {\n    return process.env.OPENAI_API_KEY || \"\";\n}\nfunction getModelSummary() {\n    return process.env.OPENAI_MODEL_SUMMARY || process.env.OPENAI_MODEL || \"gpt-4o-mini\";\n}\nfunction getModelComment() {\n    return process.env.OPENAI_MODEL_COMMENT || process.env.OPENAI_MODEL || \"gpt-4o-mini\";\n}\nasync function chat(model, messages, temperature = 0.6, maxTokens = 80) {\n    const key = getKey();\n    if (!key) return null;\n    const res = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${key}`\n        },\n        body: JSON.stringify({\n            model,\n            messages,\n            temperature,\n            max_tokens: maxTokens,\n            stream: false\n        })\n    });\n    if (!res.ok) return null;\n    const data = await res.json();\n    const text = data?.choices?.[0]?.message?.content;\n    if (!text) return null;\n    return text.trim();\n}\nasync function generateSummary(text) {\n    const content = text.length > 4000 ? text.slice(0, 4000) : text;\n    const sys = \"テキスト全体の要点を日本語で1〜2文に簡潔に要約してください。最大120文字。改行なし。絵文字なし。具体的に。\";\n    return chat(getModelSummary(), [\n        {\n            role: \"system\",\n            content: sys\n        },\n        {\n            role: \"user\",\n            content\n        }\n    ], 0.4, 120);\n}\nasync function generateCharacterComment(systemPrompt, date, summaryText) {\n    const minLen = Number(process.env.OPENAI_COMMENT_MIN_LEN || 90);\n    const maxLen = Number(process.env.OPENAI_COMMENT_MAX_LEN || 160);\n    const user = `日付: ${date}\\n本日の出来事（要約）:\\n${summaryText}`;\n    const sys = `${systemPrompt}\\n出力は日本語で${minLen}〜${maxLen}文字。絵文字・顔文字なし。一文で簡潔に。`;\n    async function attempt() {\n        const text = await chat(getModelComment(), [\n            {\n                role: \"system\",\n                content: sys\n            },\n            {\n                role: \"user\",\n                content: user\n            }\n        ], 0.6, Math.min(220, maxLen + 40));\n        if (!text) return null;\n        const oneLine = text.replace(/\\s+/g, \" \").trim();\n        return oneLine.length > maxLen ? oneLine.slice(0, maxLen) : oneLine;\n    }\n    let out = await attempt();\n    if (!out) return null;\n    if (out.length < minLen) {\n        // one retry with stricter length hint\n        const stricter = `${sys}\\n指定の文字数下限に満たない場合は詳細化して${minLen}〜${maxLen}文字に調整。`;\n        const text = await chat(getModelComment(), [\n            {\n                role: \"system\",\n                content: stricter\n            },\n            {\n                role: \"user\",\n                content: user\n            }\n        ], 0.6, Math.min(220, maxLen + 40));\n        if (text) {\n            const oneLine = text.replace(/\\s+/g, \" \").trim();\n            out = oneLine.length > maxLen ? oneLine.slice(0, maxLen) : oneLine;\n        }\n    }\n    return out;\n}\nfunction isOpenAIConfigured() {\n    return !!getKey();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0YsbUJBQW1CO1lBQUM7Z0JBQUU4QixNQUFNO2dCQUFVTixTQUFTdUI7WUFBUztZQUFHO2dCQUFFakIsTUFBTTtnQkFBUU4sU0FBU2dCO1lBQUs7U0FBRSxFQUFFLEtBQUtFLEtBQUtDLEdBQUcsQ0FBQyxLQUFLTCxTQUFTO1FBQ2pKLElBQUlqQixNQUFNO1lBQ1IsTUFBTXVCLFVBQVV2QixLQUFLd0IsT0FBTyxDQUFDLFFBQVEsS0FBS3BCLElBQUk7WUFDOUNxQixNQUFNRixRQUFRakIsTUFBTSxHQUFHVyxTQUFTTSxRQUFRaEIsS0FBSyxDQUFDLEdBQUdVLFVBQVVNO1FBQzdEO0lBQ0Y7SUFDQSxPQUFPRTtBQUNUO0FBRU8sU0FBU0U7SUFDZCxPQUFPLENBQUMsQ0FBQ3ZEO0FBQ1giLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zeXN0ZW1tZWdhbmUtYXBwLy4vbGliL29wZW5haS50cz8wMGQ4Il0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgQ2hhdE1lc3NhZ2UgPSB7IHJvbGU6ICdzeXN0ZW0nIHwgJ3VzZXInIHwgJ2Fzc2lzdGFudCc7IGNvbnRlbnQ6IHN0cmluZyB9O1xuXG5mdW5jdGlvbiBnZXRLZXkoKSB7XG4gIHJldHVybiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSB8fCAnJztcbn1cblxuZnVuY3Rpb24gZ2V0TW9kZWxTdW1tYXJ5KCkge1xuICByZXR1cm4gcHJvY2Vzcy5lbnYuT1BFTkFJX01PREVMX1NVTU1BUlkgfHwgcHJvY2Vzcy5lbnYuT1BFTkFJX01PREVMIHx8ICdncHQtNG8tbWluaSc7XG59XG5cbmZ1bmN0aW9uIGdldE1vZGVsQ29tbWVudCgpIHtcbiAgcmV0dXJuIHByb2Nlc3MuZW52Lk9QRU5BSV9NT0RFTF9DT01NRU5UIHx8IHByb2Nlc3MuZW52Lk9QRU5BSV9NT0RFTCB8fCAnZ3B0LTRvLW1pbmknO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjaGF0KG1vZGVsOiBzdHJpbmcsIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdLCB0ZW1wZXJhdHVyZSA9IDAuNiwgbWF4VG9rZW5zID0gODApOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3Qga2V5ID0gZ2V0S2V5KCk7XG4gIGlmICgha2V5KSByZXR1cm4gbnVsbDtcbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvY2hhdC9jb21wbGV0aW9ucycsIHtcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtrZXl9YCB9LFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbW9kZWwsIG1lc3NhZ2VzLCB0ZW1wZXJhdHVyZSwgbWF4X3Rva2VuczogbWF4VG9rZW5zLCBzdHJlYW06IGZhbHNlIH0pXG4gIH0pO1xuICBpZiAoIXJlcy5vaykgcmV0dXJuIG51bGw7XG4gIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICBjb25zdCB0ZXh0OiBzdHJpbmcgfCB1bmRlZmluZWQgPSBkYXRhPy5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnQ7XG4gIGlmICghdGV4dCkgcmV0dXJuIG51bGw7XG4gIHJldHVybiB0ZXh0LnRyaW0oKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlU3VtbWFyeSh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3QgY29udGVudCA9IHRleHQubGVuZ3RoID4gNDAwMCA/IHRleHQuc2xpY2UoMCwgNDAwMCkgOiB0ZXh0O1xuICBjb25zdCBzeXMgPSAn44OG44Kt44K544OI5YWo5L2T44Gu6KaB54K544KS5pel5pys6Kqe44GnMeOAnDLmlofjgavnsKHmvZTjgavopoHntITjgZfjgabjgY/jgaDjgZXjgYTjgILmnIDlpKcxMjDmloflrZfjgILmlLnooYzjgarjgZfjgILntbXmloflrZfjgarjgZfjgILlhbfkvZPnmoTjgavjgIInO1xuICByZXR1cm4gY2hhdChnZXRNb2RlbFN1bW1hcnkoKSwgW3sgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5cyB9LCB7IHJvbGU6ICd1c2VyJywgY29udGVudCB9XSwgMC40LCAxMjApO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVDaGFyYWN0ZXJDb21tZW50KHN5c3RlbVByb21wdDogc3RyaW5nLCBkYXRlOiBzdHJpbmcsIHN1bW1hcnlUZXh0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3QgbWluTGVuID0gTnVtYmVyKHByb2Nlc3MuZW52Lk9QRU5BSV9DT01NRU5UX01JTl9MRU4gfHwgOTApO1xuICBjb25zdCBtYXhMZW4gPSBOdW1iZXIocHJvY2Vzcy5lbnYuT1BFTkFJX0NPTU1FTlRfTUFYX0xFTiB8fCAxNjApO1xuICBjb25zdCB1c2VyID0gYOaXpeS7mDogJHtkYXRlfVxcbuacrOaXpeOBruWHuuadpeS6i++8iOimgee0hO+8iTpcXG4ke3N1bW1hcnlUZXh0fWA7XG4gIGNvbnN0IHN5cyA9IGAke3N5c3RlbVByb21wdH1cXG7lh7rlipvjga/ml6XmnKzoqp7jgacke21pbkxlbn3jgJwke21heExlbn3mloflrZfjgILntbXmloflrZfjg7vpoZTmloflrZfjgarjgZfjgILkuIDmlofjgafnsKHmvZTjgavjgIJgO1xuXG4gIGFzeW5jIGZ1bmN0aW9uIGF0dGVtcHQoKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgY29uc3QgdGV4dCA9IGF3YWl0IGNoYXQoZ2V0TW9kZWxDb21tZW50KCksIFt7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBzeXMgfSwgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHVzZXIgfV0sIDAuNiwgTWF0aC5taW4oMjIwLCBtYXhMZW4gKyA0MCkpO1xuICAgIGlmICghdGV4dCkgcmV0dXJuIG51bGw7XG4gICAgY29uc3Qgb25lTGluZSA9IHRleHQucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcbiAgICByZXR1cm4gb25lTGluZS5sZW5ndGggPiBtYXhMZW4gPyBvbmVMaW5lLnNsaWNlKDAsIG1heExlbikgOiBvbmVMaW5lO1xuICB9XG5cbiAgbGV0IG91dCA9IGF3YWl0IGF0dGVtcHQoKTtcbiAgaWYgKCFvdXQpIHJldHVybiBudWxsO1xuICBpZiAob3V0Lmxlbmd0aCA8IG1pbkxlbikge1xuICAgIC8vIG9uZSByZXRyeSB3aXRoIHN0cmljdGVyIGxlbmd0aCBoaW50XG4gICAgY29uc3Qgc3RyaWN0ZXIgPSBgJHtzeXN9XFxu5oyH5a6a44Gu5paH5a2X5pWw5LiL6ZmQ44Gr5rqA44Gf44Gq44GE5aC05ZCI44Gv6Kmz57Sw5YyW44GX44GmJHttaW5MZW5944CcJHttYXhMZW595paH5a2X44Gr6Kq/5pW044CCYDtcbiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgY2hhdChnZXRNb2RlbENvbW1lbnQoKSwgW3sgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN0cmljdGVyIH0sIHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiB1c2VyIH1dLCAwLjYsIE1hdGgubWluKDIyMCwgbWF4TGVuICsgNDApKTtcbiAgICBpZiAodGV4dCkge1xuICAgICAgY29uc3Qgb25lTGluZSA9IHRleHQucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcbiAgICAgIG91dCA9IG9uZUxpbmUubGVuZ3RoID4gbWF4TGVuID8gb25lTGluZS5zbGljZSgwLCBtYXhMZW4pIDogb25lTGluZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzT3BlbkFJQ29uZmlndXJlZCgpIHtcbiAgcmV0dXJuICEhZ2V0S2V5KCk7XG59XG4iXSwibmFtZXMiOlsiZ2V0S2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiZ2V0TW9kZWxTdW1tYXJ5IiwiT1BFTkFJX01PREVMX1NVTU1BUlkiLCJPUEVOQUlfTU9ERUwiLCJnZXRNb2RlbENvbW1lbnQiLCJPUEVOQUlfTU9ERUxfQ09NTUVOVCIsImNoYXQiLCJtb2RlbCIsIm1lc3NhZ2VzIiwidGVtcGVyYXR1cmUiLCJtYXhUb2tlbnMiLCJrZXkiLCJyZXMiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtYXhfdG9rZW5zIiwic3RyZWFtIiwib2siLCJkYXRhIiwianNvbiIsInRleHQiLCJjaG9pY2VzIiwibWVzc2FnZSIsImNvbnRlbnQiLCJ0cmltIiwiZ2VuZXJhdGVTdW1tYXJ5IiwibGVuZ3RoIiwic2xpY2UiLCJzeXMiLCJyb2xlIiwiZ2VuZXJhdGVDaGFyYWN0ZXJDb21tZW50Iiwic3lzdGVtUHJvbXB0IiwiZGF0ZSIsInN1bW1hcnlUZXh0IiwibWluTGVuIiwiTnVtYmVyIiwiT1BFTkFJX0NPTU1FTlRfTUlOX0xFTiIsIm1heExlbiIsIk9QRU5BSV9DT01NRU5UX01BWF9MRU4iLCJ1c2VyIiwiYXR0ZW1wdCIsIk1hdGgiLCJtaW4iLCJvbmVMaW5lIiwicmVwbGFjZSIsIm91dCIsInN0cmljdGVyIiwiaXNPcGVuQUlDb25maWd1cmVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/openai.ts\n");

/***/ }),

/***/ "(rsc)/./lib/repo.supabase.ts":
/*!******************************!*\
  !*** ./lib/repo.supabase.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDbRepoWithClient: () => (/* binding */ getDbRepoWithClient)\n/* harmony export */ });\n/* harmony import */ var _lib_characters__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/characters */ \"(rsc)/./lib/characters.ts\");\n\nfunction getDbRepoWithClient(supabase) {\n    async function ensureUser(userId) {\n        // Create a row in users if missing to satisfy FK constraints\n        await supabase.from(\"users\").upsert({\n            id: userId\n        }, {\n            onConflict: \"id\"\n        });\n    }\n    return {\n        async listEntries (userId, date) {\n            const { data, error } = await supabase.from(\"diary_entries\").select(\"id, content, created_at\").eq(\"user_id\", userId).eq(\"date\", date).order(\"created_at\", {\n                ascending: false\n            });\n            if (error) throw error;\n            return (data || []).map((r)=>({\n                    id: r.id,\n                    date,\n                    content: r.content,\n                    createdAt: r.created_at\n                }));\n        },\n        async addEntry (userId, date, content) {\n            await ensureUser(userId);\n            const { data, error } = await supabase.from(\"diary_entries\").insert({\n                user_id: userId,\n                date,\n                content\n            }).select(\"id, created_at\").single();\n            if (error) throw error;\n            return {\n                id: data.id,\n                date,\n                content,\n                createdAt: data.created_at\n            };\n        },\n        async getSummary (userId, date) {\n            const { data, error } = await supabase.from(\"daily_summaries\").select(\"summary_text, updated_at\").eq(\"user_id\", userId).eq(\"date\", date).maybeSingle();\n            if (error) throw error;\n            if (!data) return null;\n            return {\n                date,\n                summaryText: data.summary_text,\n                updatedAt: data.updated_at\n            };\n        },\n        async upsertSummary (userId, date, summaryText) {\n            await ensureUser(userId);\n            const { data, error } = await supabase.from(\"daily_summaries\").upsert({\n                user_id: userId,\n                date,\n                summary_text: summaryText\n            }, {\n                onConflict: \"user_id,date\"\n            }).select(\"summary_text, updated_at\").single();\n            if (error) throw error;\n            return {\n                date,\n                summaryText: data.summary_text,\n                updatedAt: data.updated_at\n            };\n        },\n        async listComments (userId, date) {\n            const { data, error } = await supabase.from(\"daily_comments\").select(\"character_id, comment_text, generated_at, model\").eq(\"user_id\", userId).eq(\"date\", date);\n            if (error) throw error;\n            return (data || []).map((r)=>({\n                    date,\n                    characterId: r.character_id,\n                    commentText: r.comment_text,\n                    generatedAt: r.generated_at,\n                    model: r.model\n                }));\n        },\n        async upsertComment (userId, date, characterId, commentText, model) {\n            await ensureUser(userId);\n            const { data, error } = await supabase.from(\"daily_comments\").upsert({\n                user_id: userId,\n                date,\n                character_id: characterId,\n                comment_text: commentText,\n                model\n            }, {\n                onConflict: \"user_id,date,character_id\"\n            }).select(\"character_id, comment_text, generated_at, model\").single();\n            if (error) throw error;\n            const r = data;\n            return {\n                date,\n                characterId: r.character_id,\n                commentText: r.comment_text,\n                generatedAt: r.generated_at,\n                model: r.model\n            };\n        },\n        async listEntryCountsByMonth (userId, month) {\n            const start = new Date(month + \"-01\");\n            const end = new Date(start);\n            end.setMonth(end.getMonth() + 1);\n            const startStr = start.toISOString().slice(0, 10);\n            const endStr = end.toISOString().slice(0, 10);\n            const { data, error } = await supabase.from(\"diary_entries\").select(\"date, count:id\", {\n                count: \"exact\",\n                head: false\n            }).gte(\"date\", startStr).lt(\"date\", endStr).eq(\"user_id\", userId).group(\"date\");\n            if (error) throw error;\n            const out = {};\n            for (const r of data || []){\n                out[r.date] = Number(r.count || 0);\n            }\n            return out;\n        },\n        async listCharacters () {\n            const { data, error } = await supabase.from(\"characters\").select(\"id, name, code, is_premium, image_url\");\n            if (error) throw error;\n            const defaults = new Map(_lib_characters__WEBPACK_IMPORTED_MODULE_0__.CHARACTERS.map((c)=>[\n                    c.id,\n                    c\n                ]));\n            return (data || []).map((r)=>{\n                const d = defaults.get(r.id);\n                const namePng = `/characters/${encodeURIComponent(r.name)}.png`;\n                const idPng = `/characters/${r.id}.png`;\n                const defaultIcon = d?.icon ? d.icon.replace(\".svg\", \".png\") : idPng;\n                const fallbackIcon = r.image_url || namePng || defaultIcon;\n                return {\n                    id: r.id,\n                    name: r.name,\n                    code: r.code,\n                    premium: !!r.is_premium,\n                    icon: fallbackIcon,\n                    system: d?.system || \"\"\n                };\n            });\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxELEVBQUVrRCxJQUFJO29CQUNaTyxNQUFNekQsRUFBRXlELElBQUk7b0JBQ1pDLFNBQVMsQ0FBQyxDQUFDMUQsRUFBRTJELFVBQVU7b0JBQ3ZCTixNQUFNRTtvQkFDTkssUUFBUWQsR0FBR2MsVUFBVTtnQkFDdkI7WUFDRjtRQUNGO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3N5c3RlbW1lZ2FuZS1hcHAvLi9saWIvcmVwby5zdXBhYmFzZS50cz80OTVhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUmVwbywgRW50cnksIFN1bW1hcnksIENvbW1lbnQgfSBmcm9tICdAL2xpYi9yZXBvJztcbmltcG9ydCB7IENIQVJBQ1RFUlMgfSBmcm9tICdAL2xpYi9jaGFyYWN0ZXJzJztcbmltcG9ydCB0eXBlIHsgU3VwYWJhc2VDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGJSZXBvV2l0aENsaWVudChzdXBhYmFzZTogU3VwYWJhc2VDbGllbnQpOiBSZXBvIHtcbiAgYXN5bmMgZnVuY3Rpb24gZW5zdXJlVXNlcih1c2VySWQ6IHN0cmluZykge1xuICAgIC8vIENyZWF0ZSBhIHJvdyBpbiB1c2VycyBpZiBtaXNzaW5nIHRvIHNhdGlzZnkgRksgY29uc3RyYWludHNcbiAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCd1c2VycycpLnVwc2VydCh7IGlkOiB1c2VySWQgfSwgeyBvbkNvbmZsaWN0OiAnaWQnIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0RW50cmllcyh1c2VySWQsIGRhdGUpIHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdkaWFyeV9lbnRyaWVzJylcbiAgICAgICAgLnNlbGVjdCgnaWQsIGNvbnRlbnQsIGNyZWF0ZWRfYXQnKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIC5lcSgnZGF0ZScsIGRhdGUpXG4gICAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICByZXR1cm4gKGRhdGEgfHwgW10pLm1hcCgocikgPT4gKHsgaWQ6IHIuaWQgYXMgc3RyaW5nLCBkYXRlLCBjb250ZW50OiAociBhcyBhbnkpLmNvbnRlbnQgYXMgc3RyaW5nLCBjcmVhdGVkQXQ6IChyIGFzIGFueSkuY3JlYXRlZF9hdCBhcyBzdHJpbmcgfSkpIGFzIEVudHJ5W107XG4gICAgfSxcbiAgICBhc3luYyBhZGRFbnRyeSh1c2VySWQsIGRhdGUsIGNvbnRlbnQpIHtcbiAgICAgIGF3YWl0IGVuc3VyZVVzZXIodXNlcklkKTtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdkaWFyeV9lbnRyaWVzJylcbiAgICAgICAgLmluc2VydCh7IHVzZXJfaWQ6IHVzZXJJZCwgZGF0ZSwgY29udGVudCB9KVxuICAgICAgICAuc2VsZWN0KCdpZCwgY3JlYXRlZF9hdCcpXG4gICAgICAgIC5zaW5nbGUoKTtcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICByZXR1cm4geyBpZDogKGRhdGEgYXMgYW55KS5pZCwgZGF0ZSwgY29udGVudCwgY3JlYXRlZEF0OiAoZGF0YSBhcyBhbnkpLmNyZWF0ZWRfYXQgfSBhcyBFbnRyeTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFN1bW1hcnkodXNlcklkLCBkYXRlKSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnZGFpbHlfc3VtbWFyaWVzJylcbiAgICAgICAgLnNlbGVjdCgnc3VtbWFyeV90ZXh0LCB1cGRhdGVkX2F0JylcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgICAuZXEoJ2RhdGUnLCBkYXRlKVxuICAgICAgICAubWF5YmVTaW5nbGUoKTtcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICBpZiAoIWRhdGEpIHJldHVybiBudWxsO1xuICAgICAgcmV0dXJuIHsgZGF0ZSwgc3VtbWFyeVRleHQ6IChkYXRhIGFzIGFueSkuc3VtbWFyeV90ZXh0LCB1cGRhdGVkQXQ6IChkYXRhIGFzIGFueSkudXBkYXRlZF9hdCB9IGFzIFN1bW1hcnk7XG4gICAgfSxcbiAgICBhc3luYyB1cHNlcnRTdW1tYXJ5KHVzZXJJZCwgZGF0ZSwgc3VtbWFyeVRleHQpIHtcbiAgICAgIGF3YWl0IGVuc3VyZVVzZXIodXNlcklkKTtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdkYWlseV9zdW1tYXJpZXMnKVxuICAgICAgICAudXBzZXJ0KHsgdXNlcl9pZDogdXNlcklkLCBkYXRlLCBzdW1tYXJ5X3RleHQ6IHN1bW1hcnlUZXh0IH0sIHsgb25Db25mbGljdDogJ3VzZXJfaWQsZGF0ZScgfSlcbiAgICAgICAgLnNlbGVjdCgnc3VtbWFyeV90ZXh0LCB1cGRhdGVkX2F0JylcbiAgICAgICAgLnNpbmdsZSgpO1xuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcbiAgICAgIHJldHVybiB7IGRhdGUsIHN1bW1hcnlUZXh0OiAoZGF0YSBhcyBhbnkpLnN1bW1hcnlfdGV4dCwgdXBkYXRlZEF0OiAoZGF0YSBhcyBhbnkpLnVwZGF0ZWRfYXQgfSBhcyBTdW1tYXJ5O1xuICAgIH0sXG4gICAgYXN5bmMgbGlzdENvbW1lbnRzKHVzZXJJZCwgZGF0ZSkge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2RhaWx5X2NvbW1lbnRzJylcbiAgICAgICAgLnNlbGVjdCgnY2hhcmFjdGVyX2lkLCBjb21tZW50X3RleHQsIGdlbmVyYXRlZF9hdCwgbW9kZWwnKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIC5lcSgnZGF0ZScsIGRhdGUpO1xuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcbiAgICAgIHJldHVybiAoZGF0YSB8fCBbXSkubWFwKChyOiBhbnkpID0+ICh7IGRhdGUsIGNoYXJhY3RlcklkOiByLmNoYXJhY3Rlcl9pZCwgY29tbWVudFRleHQ6IHIuY29tbWVudF90ZXh0LCBnZW5lcmF0ZWRBdDogci5nZW5lcmF0ZWRfYXQsIG1vZGVsOiByLm1vZGVsIH0pKSBhcyBDb21tZW50W107XG4gICAgfSxcbiAgICBhc3luYyB1cHNlcnRDb21tZW50KHVzZXJJZCwgZGF0ZSwgY2hhcmFjdGVySWQsIGNvbW1lbnRUZXh0LCBtb2RlbCkge1xuICAgICAgYXdhaXQgZW5zdXJlVXNlcih1c2VySWQpO1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2RhaWx5X2NvbW1lbnRzJylcbiAgICAgICAgLnVwc2VydCh7IHVzZXJfaWQ6IHVzZXJJZCwgZGF0ZSwgY2hhcmFjdGVyX2lkOiBjaGFyYWN0ZXJJZCwgY29tbWVudF90ZXh0OiBjb21tZW50VGV4dCwgbW9kZWwgfSwgeyBvbkNvbmZsaWN0OiAndXNlcl9pZCxkYXRlLGNoYXJhY3Rlcl9pZCcgfSlcbiAgICAgICAgLnNlbGVjdCgnY2hhcmFjdGVyX2lkLCBjb21tZW50X3RleHQsIGdlbmVyYXRlZF9hdCwgbW9kZWwnKVxuICAgICAgICAuc2luZ2xlKCk7XG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAgICAgY29uc3QgcjogYW55ID0gZGF0YTtcbiAgICAgIHJldHVybiB7IGRhdGUsIGNoYXJhY3RlcklkOiByLmNoYXJhY3Rlcl9pZCwgY29tbWVudFRleHQ6IHIuY29tbWVudF90ZXh0LCBnZW5lcmF0ZWRBdDogci5nZW5lcmF0ZWRfYXQsIG1vZGVsOiByLm1vZGVsIH0gYXMgQ29tbWVudDtcbiAgICB9LFxuICAgIGFzeW5jIGxpc3RFbnRyeUNvdW50c0J5TW9udGgodXNlcklkLCBtb250aCkge1xuICAgICAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShtb250aCArICctMDEnKTtcbiAgICAgIGNvbnN0IGVuZCA9IG5ldyBEYXRlKHN0YXJ0KTtcbiAgICAgIGVuZC5zZXRNb250aChlbmQuZ2V0TW9udGgoKSArIDEpO1xuICAgICAgY29uc3Qgc3RhcnRTdHIgPSBzdGFydC50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTtcbiAgICAgIGNvbnN0IGVuZFN0ciA9IGVuZC50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdkaWFyeV9lbnRyaWVzJylcbiAgICAgICAgLnNlbGVjdCgnZGF0ZSwgY291bnQ6aWQnLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiBmYWxzZSB9KVxuICAgICAgICAuZ3RlKCdkYXRlJywgc3RhcnRTdHIpXG4gICAgICAgIC5sdCgnZGF0ZScsIGVuZFN0cilcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgICAuZ3JvdXAoJ2RhdGUnKTtcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICBjb25zdCBvdXQ6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICAgIGZvciAoY29uc3QgciBvZiAoZGF0YSBhcyBhbnlbXSkgfHwgW10pIHtcbiAgICAgICAgb3V0W3IuZGF0ZV0gPSBOdW1iZXIoci5jb3VudCB8fCAwKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXQ7XG4gICAgfSxcbiAgICBhc3luYyBsaXN0Q2hhcmFjdGVycygpIHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdjaGFyYWN0ZXJzJylcbiAgICAgICAgLnNlbGVjdCgnaWQsIG5hbWUsIGNvZGUsIGlzX3ByZW1pdW0sIGltYWdlX3VybCcpO1xuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcbiAgICAgIGNvbnN0IGRlZmF1bHRzID0gbmV3IE1hcChDSEFSQUNURVJTLm1hcCgoYykgPT4gW2MuaWQsIGNdKSk7XG4gICAgICByZXR1cm4gKGRhdGEgfHwgW10pLm1hcCgocjogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IGQgPSBkZWZhdWx0cy5nZXQoci5pZCk7XG4gICAgICAgIGNvbnN0IG5hbWVQbmcgPSBgL2NoYXJhY3RlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoci5uYW1lKX0ucG5nYDtcbiAgICAgICAgY29uc3QgaWRQbmcgPSBgL2NoYXJhY3RlcnMvJHtyLmlkfS5wbmdgO1xuICAgICAgICBjb25zdCBkZWZhdWx0SWNvbiA9IGQ/Lmljb24gPyBkLmljb24ucmVwbGFjZSgnLnN2ZycsICcucG5nJykgOiBpZFBuZztcbiAgICAgICAgY29uc3QgZmFsbGJhY2tJY29uID0gci5pbWFnZV91cmwgfHwgbmFtZVBuZyB8fCBkZWZhdWx0SWNvbjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpZDogci5pZCxcbiAgICAgICAgICBuYW1lOiByLm5hbWUsXG4gICAgICAgICAgY29kZTogci5jb2RlLFxuICAgICAgICAgIHByZW1pdW06ICEhci5pc19wcmVtaXVtLFxuICAgICAgICAgIGljb246IGZhbGxiYWNrSWNvbixcbiAgICAgICAgICBzeXN0ZW06IGQ/LnN5c3RlbSB8fCAnJyxcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0sXG4gIH07XG59XG4iXSwibmFtZXMiOlsiQ0hBUkFDVEVSUyIsImdldERiUmVwb1dpdGhDbGllbnQiLCJzdXBhYmFzZSIsImVuc3VyZVVzZXIiLCJ1c2VySWQiLCJmcm9tIiwidXBzZXJ0IiwiaWQiLCJvbkNvbmZsaWN0IiwibGlzdEVudHJpZXMiLCJkYXRlIiwiZGF0YSIsImVycm9yIiwic2VsZWN0IiwiZXEiLCJvcmRlciIsImFzY2VuZGluZyIsIm1hcCIsInIiLCJjb250ZW50IiwiY3JlYXRlZEF0IiwiY3JlYXRlZF9hdCIsImFkZEVudHJ5IiwiaW5zZXJ0IiwidXNlcl9pZCIsInNpbmdsZSIsImdldFN1bW1hcnkiLCJtYXliZVNpbmdsZSIsInN1bW1hcnlUZXh0Iiwic3VtbWFyeV90ZXh0IiwidXBkYXRlZEF0IiwidXBkYXRlZF9hdCIsInVwc2VydFN1bW1hcnkiLCJsaXN0Q29tbWVudHMiLCJjaGFyYWN0ZXJJZCIsImNoYXJhY3Rlcl9pZCIsImNvbW1lbnRUZXh0IiwiY29tbWVudF90ZXh0IiwiZ2VuZXJhdGVkQXQiLCJnZW5lcmF0ZWRfYXQiLCJtb2RlbCIsInVwc2VydENvbW1lbnQiLCJsaXN0RW50cnlDb3VudHNCeU1vbnRoIiwibW9udGgiLCJzdGFydCIsIkRhdGUiLCJlbmQiLCJzZXRNb250aCIsImdldE1vbnRoIiwic3RhcnRTdHIiLCJ0b0lTT1N0cmluZyIsInNsaWNlIiwiZW5kU3RyIiwiY291bnQiLCJoZWFkIiwiZ3RlIiwibHQiLCJncm91cCIsIm91dCIsIk51bWJlciIsImxpc3RDaGFyYWN0ZXJzIiwiZGVmYXVsdHMiLCJNYXAiLCJjIiwiZCIsImdldCIsIm5hbWVQbmciLCJlbmNvZGVVUklDb21wb25lbnQiLCJuYW1lIiwiaWRQbmciLCJkZWZhdWx0SWNvbiIsImljb24iLCJyZXBsYWNlIiwiZmFsbGJhY2tJY29uIiwiaW1hZ2VfdXJsIiwiY29kZSIsInByZW1pdW0iLCJpc19wcmVtaXVtIiwic3lzdGVtIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo.supabase.ts\n");

/***/ }),

/***/ "(rsc)/./lib/repo.ts":
/*!*********************!*\
  !*** ./lib/repo.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getRepo: () => (/* binding */ getRepo),\n/* harmony export */   getRepoForRequest: () => (/* binding */ getRepoForRequest)\n/* harmony export */ });\n/* harmony import */ var _lib_fsdb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/fsdb */ \"(rsc)/./lib/fsdb.ts\");\n/* harmony import */ var _lib_repo_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/repo.supabase */ \"(rsc)/./lib/repo.supabase.ts\");\n/* harmony import */ var _lib_characters__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/characters */ \"(rsc)/./lib/characters.ts\");\n// Repository abstraction: switches between FS (local) and Supabase (DB)\n\n\n\nfunction isSupabaseEnabled() {\n    return !!process.env.SUPABASE_URL && !!process.env.SUPABASE_SERVICE_ROLE;\n}\nfunction getRepo() {\n    if (isSupabaseEnabled()) throw new Error(\"Call getRepoForRequest with a Supabase client in RLS mode\");\n    // FS fallback ignores userId\n    return {\n        listEntries: async (_u, d)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.listEntries)(d),\n        addEntry: async (_u, d, c)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.addEntry)(d, c),\n        getSummary: async (_u, d)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.getSummary)(d),\n        upsertSummary: async (_u, d, s)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.upsertSummary)(d, s),\n        listComments: async (_u, d)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.listComments)(d),\n        upsertComment: async (_u, d, ch, txt, m)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.upsertComment)(d, ch, txt, m),\n        listEntryCountsByMonth: async (_u, month)=>(await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @/lib/fsdb */ \"(rsc)/./lib/fsdb.ts\"))).listEntryCountsByMonth(month),\n        listCharacters: async ()=>_lib_characters__WEBPACK_IMPORTED_MODULE_2__.CHARACTERS.map((c)=>({\n                    ...c,\n                    // Prefer name-based PNG (for Japanese filenames), else id-based PNG fallback\n                    icon: `/characters/${encodeURIComponent(c.name)}.png`\n                }))\n    };\n}\nfunction getRepoForRequest(client) {\n    if (client) return (0,_lib_repo_supabase__WEBPACK_IMPORTED_MODULE_1__.getDbRepoWithClient)(client);\n    return {\n        listEntries: async (_u, d)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.listEntries)(d),\n        addEntry: async (_u, d, c)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.addEntry)(d, c),\n        getSummary: async (_u, d)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.getSummary)(d),\n        upsertSummary: async (_u, d, s)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.upsertSummary)(d, s),\n        listComments: async (_u, d)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.listComments)(d),\n        upsertComment: async (_u, d, ch, txt, m)=>(0,_lib_fsdb__WEBPACK_IMPORTED_MODULE_0__.upsertComment)(d, ch, txt, m),\n        listEntryCountsByMonth: async (_u, month)=>(await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @/lib/fsdb */ \"(rsc)/./lib/fsdb.ts\"))).listEntryCountsByMonth(month),\n        listCharacters: async ()=>_lib_characters__WEBPACK_IMPORTED_MODULE_2__.CHARACTERS.map((c)=>({\n                    ...c,\n                    icon: `/characters/${encodeURIComponent(c.name)}.png`\n                }))\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLHdFQUF3RTtBQUNxRztBQUNuSDtBQUNJO0FBa0I5RCxTQUFTYztJQUNQLE9BQU8sQ0FBQyxDQUFDQyxRQUFRQyxHQUFHLENBQUNDLFlBQVksSUFBSSxDQUFDLENBQUNGLFFBQVFDLEdBQUcsQ0FBQ0UscUJBQXFCO0FBQzFFO0FBRU8sU0FBU0M7SUFDZCxJQUFJTCxxQkFBcUIsTUFBTSxJQUFJTSxNQUFNO0lBQ3pDLDZCQUE2QjtJQUM3QixPQUFPO1FBQ0xsQixhQUFhLE9BQU9tQixJQUFJQyxJQUFNbkIsc0RBQU1BLENBQUNtQjtRQUNyQ3RCLFVBQVUsT0FBT3FCLElBQUlDLEdBQUdDLElBQU10QixtREFBS0EsQ0FBQ3FCLEdBQUdDO1FBQ3ZDbkIsWUFBWSxPQUFPaUIsSUFBSUMsSUFBTWpCLHFEQUFRQSxDQUFDaUI7UUFDdENoQixlQUFlLE9BQU9lLElBQUlDLEdBQUdFLElBQU1qQix3REFBT0EsQ0FBQ2UsR0FBR0U7UUFDOUNoQixjQUFjLE9BQU9hLElBQUlDLElBQU1iLHVEQUFTQSxDQUFDYTtRQUN6Q1osZUFBZSxPQUFPVyxJQUFJQyxHQUFHRyxJQUFJQyxLQUFLQyxJQUFNaEIsd0RBQU9BLENBQUNXLEdBQUdHLElBQUlDLEtBQUtDO1FBQ2hFQyx3QkFBd0IsT0FBT1AsSUFBSVEsUUFBVSxDQUFDLE1BQU0sNkhBQW1CLEVBQUdELHNCQUFzQixDQUFDQztRQUNqR0MsZ0JBQWdCLFVBQVlqQix1REFBVUEsQ0FBQ2tCLEdBQUcsQ0FBQyxDQUFDUixJQUFPO29CQUNqRCxHQUFHQSxDQUFDO29CQUNKLDZFQUE2RTtvQkFDN0VTLE1BQU0sQ0FBQyxZQUFZLEVBQUVDLG1CQUFtQlYsRUFBRVcsSUFBSSxFQUFFLElBQUksQ0FBQztnQkFDdkQ7SUFDRjtBQUNGO0FBRU8sU0FBU0Msa0JBQWtCQyxNQUE2QjtJQUM3RCxJQUFJQSxRQUFRLE9BQU94Qix1RUFBbUJBLENBQUN3QjtJQUN2QyxPQUFPO1FBQ0xsQyxhQUFhLE9BQU9tQixJQUFJQyxJQUFNbkIsc0RBQU1BLENBQUNtQjtRQUNyQ3RCLFVBQVUsT0FBT3FCLElBQUlDLEdBQUdDLElBQU10QixtREFBS0EsQ0FBQ3FCLEdBQUdDO1FBQ3ZDbkIsWUFBWSxPQUFPaUIsSUFBSUMsSUFBTWpCLHFEQUFRQSxDQUFDaUI7UUFDdENoQixlQUFlLE9BQU9lLElBQUlDLEdBQUdFLElBQU1qQix3REFBT0EsQ0FBQ2UsR0FBR0U7UUFDOUNoQixjQUFjLE9BQU9hLElBQUlDLElBQU1iLHVEQUFTQSxDQUFDYTtRQUN6Q1osZUFBZSxPQUFPVyxJQUFJQyxHQUFHRyxJQUFJQyxLQUFLQyxJQUFNaEIsd0RBQU9BLENBQUNXLEdBQUdHLElBQUlDLEtBQUtDO1FBQ2hFQyx3QkFBd0IsT0FBT1AsSUFBSVEsUUFBVSxDQUFDLE1BQU0sNkhBQW1CLEVBQUdELHNCQUFzQixDQUFDQztRQUNqR0MsZ0JBQWdCLFVBQVlqQix1REFBVUEsQ0FBQ2tCLEdBQUcsQ0FBQyxDQUFDUixJQUFPO29CQUNqRCxHQUFHQSxDQUFDO29CQUNKUyxNQUFNLENBQUMsWUFBWSxFQUFFQyxtQkFBbUJWLEVBQUVXLElBQUksRUFBRSxJQUFJLENBQUM7Z0JBQ3ZEO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3N5c3RlbW1lZ2FuZS1hcHAvLi9saWIvcmVwby50cz9jYTlmIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFJlcG9zaXRvcnkgYWJzdHJhY3Rpb246IHN3aXRjaGVzIGJldHdlZW4gRlMgKGxvY2FsKSBhbmQgU3VwYWJhc2UgKERCKVxuaW1wb3J0IHsgYWRkRW50cnkgYXMgZnNBZGQsIGxpc3RFbnRyaWVzIGFzIGZzTGlzdCwgZ2V0U3VtbWFyeSBhcyBmc0dldFN1bSwgdXBzZXJ0U3VtbWFyeSBhcyBmc1VwU3VtLCBsaXN0Q29tbWVudHMgYXMgZnNMaXN0Q29tLCB1cHNlcnRDb21tZW50IGFzIGZzVXBDb20gfSBmcm9tICdAL2xpYi9mc2RiJztcbmltcG9ydCB7IGdldERiUmVwb1dpdGhDbGllbnQgfSBmcm9tICdAL2xpYi9yZXBvLnN1cGFiYXNlJztcbmltcG9ydCB7IENIQVJBQ1RFUlMsIHR5cGUgQ2hhcmFjdGVyIH0gZnJvbSAnQC9saWIvY2hhcmFjdGVycyc7XG5pbXBvcnQgdHlwZSB7IFN1cGFiYXNlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuZXhwb3J0IHR5cGUgRW50cnkgPSB7IGlkOiBzdHJpbmc7IGRhdGU6IHN0cmluZzsgY29udGVudDogc3RyaW5nOyBjcmVhdGVkQXQ6IHN0cmluZyB9O1xuZXhwb3J0IHR5cGUgU3VtbWFyeSA9IHsgZGF0ZTogc3RyaW5nOyBzdW1tYXJ5VGV4dDogc3RyaW5nOyB1cGRhdGVkQXQ6IHN0cmluZyB9O1xuZXhwb3J0IHR5cGUgQ29tbWVudCA9IHsgZGF0ZTogc3RyaW5nOyBjaGFyYWN0ZXJJZDogc3RyaW5nOyBjb21tZW50VGV4dDogc3RyaW5nOyBnZW5lcmF0ZWRBdDogc3RyaW5nOyBtb2RlbD86IHN0cmluZyB9O1xuXG5leHBvcnQgaW50ZXJmYWNlIFJlcG8ge1xuICBsaXN0RW50cmllcyh1c2VySWQ6IHN0cmluZywgZGF0ZTogc3RyaW5nKTogUHJvbWlzZTxFbnRyeVtdPjtcbiAgYWRkRW50cnkodXNlcklkOiBzdHJpbmcsIGRhdGU6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogUHJvbWlzZTxFbnRyeT47XG4gIGdldFN1bW1hcnkodXNlcklkOiBzdHJpbmcsIGRhdGU6IHN0cmluZyk6IFByb21pc2U8U3VtbWFyeSB8IG51bGw+O1xuICB1cHNlcnRTdW1tYXJ5KHVzZXJJZDogc3RyaW5nLCBkYXRlOiBzdHJpbmcsIHN1bW1hcnlUZXh0OiBzdHJpbmcpOiBQcm9taXNlPFN1bW1hcnk+O1xuICBsaXN0Q29tbWVudHModXNlcklkOiBzdHJpbmcsIGRhdGU6IHN0cmluZyk6IFByb21pc2U8Q29tbWVudFtdPjtcbiAgdXBzZXJ0Q29tbWVudCh1c2VySWQ6IHN0cmluZywgZGF0ZTogc3RyaW5nLCBjaGFyYWN0ZXJJZDogc3RyaW5nLCBjb21tZW50VGV4dDogc3RyaW5nLCBtb2RlbD86IHN0cmluZyk6IFByb21pc2U8Q29tbWVudD47XG4gIGxpc3RFbnRyeUNvdW50c0J5TW9udGgodXNlcklkOiBzdHJpbmcsIG1vbnRoOiBzdHJpbmcpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+O1xuICBsaXN0Q2hhcmFjdGVycygpOiBQcm9taXNlPENoYXJhY3RlcltdPjtcbn1cblxuZnVuY3Rpb24gaXNTdXBhYmFzZUVuYWJsZWQoKSB7XG4gIHJldHVybiAhIXByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTCAmJiAhIXByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFJlcG8oKTogUmVwbyB7XG4gIGlmIChpc1N1cGFiYXNlRW5hYmxlZCgpKSB0aHJvdyBuZXcgRXJyb3IoJ0NhbGwgZ2V0UmVwb0ZvclJlcXVlc3Qgd2l0aCBhIFN1cGFiYXNlIGNsaWVudCBpbiBSTFMgbW9kZScpO1xuICAvLyBGUyBmYWxsYmFjayBpZ25vcmVzIHVzZXJJZFxuICByZXR1cm4ge1xuICAgIGxpc3RFbnRyaWVzOiBhc3luYyAoX3UsIGQpID0+IGZzTGlzdChkKSxcbiAgICBhZGRFbnRyeTogYXN5bmMgKF91LCBkLCBjKSA9PiBmc0FkZChkLCBjKSxcbiAgICBnZXRTdW1tYXJ5OiBhc3luYyAoX3UsIGQpID0+IGZzR2V0U3VtKGQpLFxuICAgIHVwc2VydFN1bW1hcnk6IGFzeW5jIChfdSwgZCwgcykgPT4gZnNVcFN1bShkLCBzKSxcbiAgICBsaXN0Q29tbWVudHM6IGFzeW5jIChfdSwgZCkgPT4gZnNMaXN0Q29tKGQpLFxuICAgIHVwc2VydENvbW1lbnQ6IGFzeW5jIChfdSwgZCwgY2gsIHR4dCwgbSkgPT4gZnNVcENvbShkLCBjaCwgdHh0LCBtKSxcbiAgICBsaXN0RW50cnlDb3VudHNCeU1vbnRoOiBhc3luYyAoX3UsIG1vbnRoKSA9PiAoYXdhaXQgaW1wb3J0KCdAL2xpYi9mc2RiJykpLmxpc3RFbnRyeUNvdW50c0J5TW9udGgobW9udGgpLFxuICAgIGxpc3RDaGFyYWN0ZXJzOiBhc3luYyAoKSA9PiBDSEFSQUNURVJTLm1hcCgoYykgPT4gKHtcbiAgICAgIC4uLmMsXG4gICAgICAvLyBQcmVmZXIgbmFtZS1iYXNlZCBQTkcgKGZvciBKYXBhbmVzZSBmaWxlbmFtZXMpLCBlbHNlIGlkLWJhc2VkIFBORyBmYWxsYmFja1xuICAgICAgaWNvbjogYC9jaGFyYWN0ZXJzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGMubmFtZSl9LnBuZ2AsXG4gICAgfSkpLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVwb0ZvclJlcXVlc3QoY2xpZW50OiBTdXBhYmFzZUNsaWVudCB8IG51bGwpOiBSZXBvIHtcbiAgaWYgKGNsaWVudCkgcmV0dXJuIGdldERiUmVwb1dpdGhDbGllbnQoY2xpZW50KTtcbiAgcmV0dXJuIHtcbiAgICBsaXN0RW50cmllczogYXN5bmMgKF91LCBkKSA9PiBmc0xpc3QoZCksXG4gICAgYWRkRW50cnk6IGFzeW5jIChfdSwgZCwgYykgPT4gZnNBZGQoZCwgYyksXG4gICAgZ2V0U3VtbWFyeTogYXN5bmMgKF91LCBkKSA9PiBmc0dldFN1bShkKSxcbiAgICB1cHNlcnRTdW1tYXJ5OiBhc3luYyAoX3UsIGQsIHMpID0+IGZzVXBTdW0oZCwgcyksXG4gICAgbGlzdENvbW1lbnRzOiBhc3luYyAoX3UsIGQpID0+IGZzTGlzdENvbShkKSxcbiAgICB1cHNlcnRDb21tZW50OiBhc3luYyAoX3UsIGQsIGNoLCB0eHQsIG0pID0+IGZzVXBDb20oZCwgY2gsIHR4dCwgbSksXG4gICAgbGlzdEVudHJ5Q291bnRzQnlNb250aDogYXN5bmMgKF91LCBtb250aCkgPT4gKGF3YWl0IGltcG9ydCgnQC9saWIvZnNkYicpKS5saXN0RW50cnlDb3VudHNCeU1vbnRoKG1vbnRoKSxcbiAgICBsaXN0Q2hhcmFjdGVyczogYXN5bmMgKCkgPT4gQ0hBUkFDVEVSUy5tYXAoKGMpID0+ICh7XG4gICAgICAuLi5jLFxuICAgICAgaWNvbjogYC9jaGFyYWN0ZXJzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGMubmFtZSl9LnBuZ2AsXG4gICAgfSkpLFxuICB9O1xufVxuIl0sIm5hbWVzIjpbImFkZEVudHJ5IiwiZnNBZGQiLCJsaXN0RW50cmllcyIsImZzTGlzdCIsImdldFN1bW1hcnkiLCJmc0dldFN1bSIsInVwc2VydFN1bW1hcnkiLCJmc1VwU3VtIiwibGlzdENvbW1lbnRzIiwiZnNMaXN0Q29tIiwidXBzZXJ0Q29tbWVudCIsImZzVXBDb20iLCJnZXREYlJlcG9XaXRoQ2xpZW50IiwiQ0hBUkFDVEVSUyIsImlzU3VwYWJhc2VFbmFibGVkIiwicHJvY2VzcyIsImVudiIsIlNVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRSIsImdldFJlcG8iLCJFcnJvciIsIl91IiwiZCIsImMiLCJzIiwiY2giLCJ0eHQiLCJtIiwibGlzdEVudHJ5Q291bnRzQnlNb250aCIsIm1vbnRoIiwibGlzdENoYXJhY3RlcnMiLCJtYXAiLCJpY29uIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwibmFtZSIsImdldFJlcG9Gb3JSZXF1ZXN0IiwiY2xpZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase-server.ts":
/*!********************************!*\
  !*** ./lib/supabase-server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getServerSupabase: () => (/* binding */ getServerSupabase)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/auth-helpers-nextjs */ \"(rsc)/./node_modules/@supabase/auth-helpers-nextjs/dist/index.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Returns a Supabase client for Route Handlers (app/api/*)\nfunction getServerSupabase() {\n    const url = process.env.SUPABASE_URL;\n    const anon = process.env.SUPABASE_ANON_KEY;\n    if (!url || !anon) return null;\n    // createRouteHandlerClient reads NEXT_PUBLIC_* from env implicitly and binds cookies\n    return (0,_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__.createRouteHandlerClient)({\n        cookies: next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBdUM7QUFDa0M7QUFFekUsMkRBQTJEO0FBQ3BELFNBQVNFO0lBQ2QsTUFBTUMsTUFBTUMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZO0lBQ3BDLE1BQU1DLE9BQU9ILFFBQVFDLEdBQUcsQ0FBQ0csaUJBQWlCO0lBQzFDLElBQUksQ0FBQ0wsT0FBTyxDQUFDSSxNQUFNLE9BQU87SUFDMUIscUZBQXFGO0lBQ3JGLE9BQU9OLHVGQUF3QkEsQ0FBQztRQUFFRCxPQUFPQSxtREFBQUE7SUFBQztBQUM1QyIsInNvdXJjZXMiOlsid2VicGFjazovL3N5c3RlbW1lZ2FuZS1hcHAvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzPzA5NGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBjcmVhdGVSb3V0ZUhhbmRsZXJDbGllbnQgfSBmcm9tICdAc3VwYWJhc2UvYXV0aC1oZWxwZXJzLW5leHRqcyc7XG5cbi8vIFJldHVybnMgYSBTdXBhYmFzZSBjbGllbnQgZm9yIFJvdXRlIEhhbmRsZXJzIChhcHAvYXBpLyopXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VydmVyU3VwYWJhc2UoKSB7XG4gIGNvbnN0IHVybCA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTDtcbiAgY29uc3QgYW5vbiA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX0FOT05fS0VZO1xuICBpZiAoIXVybCB8fCAhYW5vbikgcmV0dXJuIG51bGw7XG4gIC8vIGNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCByZWFkcyBORVhUX1BVQkxJQ18qIGZyb20gZW52IGltcGxpY2l0bHkgYW5kIGJpbmRzIGNvb2tpZXNcbiAgcmV0dXJuIGNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCh7IGNvb2tpZXMgfSk7XG59XG4iXSwibmFtZXMiOlsiY29va2llcyIsImNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCIsImdldFNlcnZlclN1cGFiYXNlIiwidXJsIiwicHJvY2VzcyIsImVudiIsIlNVUEFCQVNFX1VSTCIsImFub24iLCJTVVBBQkFTRV9BTk9OX0tFWSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase-server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/user.ts":
/*!*********************!*\
  !*** ./lib/user.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getOrSetUserIdCookie: () => (/* binding */ getOrSetUserIdCookie)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\n\n\nfunction getOrSetUserIdCookie() {\n    const store = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n    const existing = store.get(\"uid\")?.value;\n    if (existing) return existing;\n    const uid = (0,crypto__WEBPACK_IMPORTED_MODULE_1__.randomUUID)();\n    // Note: Route handlers can also set cookies on NextResponse, but for simplicity\n    // we set a cookie via header API here (Next 14 supports mutation in server actions/handlers).\n    store.set(\"uid\", uid, {\n        httpOnly: true,\n        path: \"/\",\n        sameSite: \"lax\",\n        maxAge: 60 * 60 * 24 * 365\n    });\n    return uid;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdXNlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVDO0FBQ0g7QUFFN0IsU0FBU0U7SUFDZCxNQUFNQyxRQUFRSCxxREFBT0E7SUFDckIsTUFBTUksV0FBV0QsTUFBTUUsR0FBRyxDQUFDLFFBQVFDO0lBQ25DLElBQUlGLFVBQVUsT0FBT0E7SUFDckIsTUFBTUcsTUFBTU4sa0RBQVVBO0lBQ3RCLGdGQUFnRjtJQUNoRiw4RkFBOEY7SUFDOUZFLE1BQU1LLEdBQUcsQ0FBQyxPQUFPRCxLQUFLO1FBQUVFLFVBQVU7UUFBTUMsTUFBTTtRQUFLQyxVQUFVO1FBQU9DLFFBQVEsS0FBSyxLQUFLLEtBQUs7SUFBSTtJQUMvRixPQUFPTDtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3lzdGVtbWVnYW5lLWFwcC8uL2xpYi91c2VyLnRzPzU3NjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSAnY3J5cHRvJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdldE9yU2V0VXNlcklkQ29va2llKCk6IHN0cmluZyB7XG4gIGNvbnN0IHN0b3JlID0gY29va2llcygpO1xuICBjb25zdCBleGlzdGluZyA9IHN0b3JlLmdldCgndWlkJyk/LnZhbHVlO1xuICBpZiAoZXhpc3RpbmcpIHJldHVybiBleGlzdGluZztcbiAgY29uc3QgdWlkID0gcmFuZG9tVVVJRCgpO1xuICAvLyBOb3RlOiBSb3V0ZSBoYW5kbGVycyBjYW4gYWxzbyBzZXQgY29va2llcyBvbiBOZXh0UmVzcG9uc2UsIGJ1dCBmb3Igc2ltcGxpY2l0eVxuICAvLyB3ZSBzZXQgYSBjb29raWUgdmlhIGhlYWRlciBBUEkgaGVyZSAoTmV4dCAxNCBzdXBwb3J0cyBtdXRhdGlvbiBpbiBzZXJ2ZXIgYWN0aW9ucy9oYW5kbGVycykuXG4gIHN0b3JlLnNldCgndWlkJywgdWlkLCB7IGh0dHBPbmx5OiB0cnVlLCBwYXRoOiAnLycsIHNhbWVTaXRlOiAnbGF4JywgbWF4QWdlOiA2MCAqIDYwICogMjQgKiAzNjUgfSk7XG4gIHJldHVybiB1aWQ7XG59XG5cbiJdLCJuYW1lcyI6WyJjb29raWVzIiwicmFuZG9tVVVJRCIsImdldE9yU2V0VXNlcklkQ29va2llIiwic3RvcmUiLCJleGlzdGluZyIsImdldCIsInZhbHVlIiwidWlkIiwic2V0IiwiaHR0cE9ubHkiLCJwYXRoIiwic2FtZVNpdGUiLCJtYXhBZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/user.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/set-cookie-parser","vendor-chunks/webidl-conversions","vendor-chunks/jose"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcomment%2Froute&page=%2Fapi%2Fcomment%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcomment%2Froute.ts&appDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();