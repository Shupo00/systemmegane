"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/comment/route";
exports.ids = ["app/api/comment/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcomment%2Froute&page=%2Fapi%2Fcomment%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcomment%2Froute.ts&appDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcomment%2Froute&page=%2Fapi%2Fcomment%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcomment%2Froute.ts&appDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_suo06_Project_systemmegane_app_api_comment_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/comment/route.ts */ \"(rsc)/./app/api/comment/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/comment/route\",\n        pathname: \"/api/comment\",\n        filename: \"route\",\n        bundlePath: \"app/api/comment/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\suo06\\\\Project\\\\systemmegane\\\\app\\\\api\\\\comment\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_suo06_Project_systemmegane_app_api_comment_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/comment/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjb21tZW50JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjb21tZW50JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY29tbWVudCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNzdW8wNiU1Q1Byb2plY3QlNUNzeXN0ZW1tZWdhbmUlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3N1bzA2JTVDUHJvamVjdCU1Q3N5c3RlbW1lZ2FuZSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDb0I7QUFDakc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zeXN0ZW1tZWdhbmUtYXBwLz9jNTQwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXHN1bzA2XFxcXFByb2plY3RcXFxcc3lzdGVtbWVnYW5lXFxcXGFwcFxcXFxhcGlcXFxcY29tbWVudFxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY29tbWVudC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NvbW1lbnRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2NvbW1lbnQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxzdW8wNlxcXFxQcm9qZWN0XFxcXHN5c3RlbW1lZ2FuZVxcXFxhcHBcXFxcYXBpXFxcXGNvbW1lbnRcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2NvbW1lbnQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcomment%2Froute&page=%2Fapi%2Fcomment%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcomment%2Froute.ts&appDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/comment/route.ts":
/*!**********************************!*\
  !*** ./app/api/comment/route.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/repo */ \"(rsc)/./lib/repo.ts\");\n/* harmony import */ var _lib_user__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/user */ \"(rsc)/./lib/user.ts\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/supabase-server */ \"(rsc)/./lib/supabase-server.ts\");\n/* harmony import */ var _lib_characters__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../lib/characters */ \"(rsc)/./lib/characters.ts\");\n/* harmony import */ var _lib_openai__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../lib/openai */ \"(rsc)/./lib/openai.ts\");\n\n\n\n\n\n\nconst runtime = \"nodejs\";\nconst dynamic = \"force-dynamic\";\nconst FREE = _lib_characters__WEBPACK_IMPORTED_MODULE_4__.CHARACTERS.filter((c)=>!c.premium);\nfunction mockGenerate(characterId, summary) {\n    // very naive character-flavored comments up to 160 chars\n    const base = summary || \"出来事は穏やか。\";\n    const tail = base.slice(0, 140);\n    const prefix = {\n        power: \"権力関係を直視せよ: \",\n        judge: \"規範の線引きを確認: \",\n        art: \"表現の質感に注目: \",\n        priest: \"内在と超越の往復: \",\n        teacher: \"学びの成果を点検: \",\n        market: \"交換の妥当性を査定: \",\n        news: \"情報の公共性を吟味: \",\n        truth: \"真偽の基準を限定: \"\n    };\n    const text = (prefix[characterId] || \"\") + tail;\n    return text.slice(0, 160);\n}\nasync function GET(req) {\n    const { searchParams } = new URL(req.url);\n    const date = searchParams.get(\"date\");\n    if (!date) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: \"date_required\"\n    }, {\n        status: 400\n    });\n    const supa = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_3__.getServerSupabase)();\n    const { data: userData } = supa ? await supa.auth.getUser() : {\n        data: {\n            user: null\n        }\n    };\n    const userId = userData?.user?.id || (0,_lib_user__WEBPACK_IMPORTED_MODULE_2__.getOrSetUserIdCookie)();\n    const repo = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepoForRequest)(userData?.user ? supa : null);\n    const list = await repo.listComments(userId, date);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(list);\n}\nasync function POST(req) {\n    const body = await req.json().catch(()=>({}));\n    const { date, character_id } = body;\n    if (!date || !character_id) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: \"invalid_input\"\n    }, {\n        status: 400\n    });\n    // Enforce OpenAI availability if required\n    if (process.env.REQUIRE_OPENAI === \"true\" && !(0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.isOpenAIConfigured)()) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"openai_required\"\n        }, {\n            status: 503\n        });\n    }\n    // simple premium gate (mock): allow only FREE unless env unlocks\n    if ((0,_lib_characters__WEBPACK_IMPORTED_MODULE_4__.isPremiumCharacter)(character_id) && process.env.PREMIUM_ACTIVE !== \"true\") {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"locked\"\n        }, {\n            status: 402\n        });\n    }\n    const supa = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_3__.getServerSupabase)();\n    const { data: userData } = supa ? await supa.auth.getUser() : {\n        data: {\n            user: null\n        }\n    };\n    const userId = userData?.user?.id || (0,_lib_user__WEBPACK_IMPORTED_MODULE_2__.getOrSetUserIdCookie)();\n    const repo = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepoForRequest)(userData?.user ? supa : null);\n    // Obtain context for generation: prefer stored daily summary; if missing, synthesize from entries and store.\n    let summary = (await repo.getSummary(userId, date))?.summaryText || \"\";\n    if (!summary) {\n        const entries = await repo.listEntries(userId, date);\n        const joined = entries.map((e)=>e.content).reverse().join(\"\\n\");\n        // Simple summarizer as fallback\n        const simpleSummarize = (text)=>{\n            const t = (text || \"\").replace(/\\s+/g, \" \").trim();\n            return t.slice(0, 160) + (t.length > 160 ? \"…\" : \"\");\n        };\n        let synth = \"\";\n        if ((0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.isOpenAIConfigured)()) synth = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.generateSummary)(joined) || \"\";\n        if (!synth) synth = simpleSummarize(joined);\n        try {\n            await repo.upsertSummary(userId, date, synth);\n        } catch  {}\n        summary = synth;\n    }\n    let comment = \"\";\n    let modelNote = \"mock\";\n    const c = (0,_lib_characters__WEBPACK_IMPORTED_MODULE_4__.getCharacter)(character_id);\n    if ((0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.isOpenAIConfigured)() && c) {\n        const ai = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_5__.generateCharacterComment)(c.system, date, summary);\n        if (ai) {\n            comment = ai;\n            modelNote = process.env.OPENAI_MODEL_COMMENT || process.env.OPENAI_MODEL || \"gpt-4o-mini\";\n        }\n    }\n    if (!comment) comment = mockGenerate(character_id, summary);\n    const rec = await repo.upsertComment(userId, date, character_id, comment, modelNote);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(rec);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVFDLEdBQUcsQ0FBQ3dCLG9CQUFvQixJQUFJekIsUUFBUUMsR0FBRyxDQUFDeUIsWUFBWSxJQUFJO1FBQzlFO0lBQ0Y7SUFDQSxJQUFJLENBQUNMLFNBQVNBLFVBQVU5RCxhQUFhd0MsY0FBY3RDO0lBQ25ELE1BQU1rRSxNQUFNLE1BQU1sQyxLQUFLbUMsYUFBYSxDQUFDckMsUUFBUVgsTUFBTW1CLGNBQWNzQixTQUFTQztJQUMxRSxPQUFPaEYscURBQVlBLENBQUN3QyxJQUFJLENBQUM2QztBQUMzQiIsInNvdXJjZXMiOlsid2VicGFjazovL3N5c3RlbW1lZ2FuZS1hcHAvLi9hcHAvYXBpL2NvbW1lbnQvcm91dGUudHM/YTI3NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgZ2V0UmVwb0ZvclJlcXVlc3QgfSBmcm9tICcuLi8uLi8uLi9saWIvcmVwbyc7XG5pbXBvcnQgeyBnZXRPclNldFVzZXJJZENvb2tpZSB9IGZyb20gJy4uLy4uLy4uL2xpYi91c2VyJztcbmltcG9ydCB7IGdldFNlcnZlclN1cGFiYXNlIH0gZnJvbSAnLi4vLi4vLi4vbGliL3N1cGFiYXNlLXNlcnZlcic7XG5pbXBvcnQgeyBDSEFSQUNURVJTLCBnZXRDaGFyYWN0ZXIsIGlzUHJlbWl1bUNoYXJhY3RlciB9IGZyb20gJy4uLy4uLy4uL2xpYi9jaGFyYWN0ZXJzJztcbmltcG9ydCB7IGdlbmVyYXRlQ2hhcmFjdGVyQ29tbWVudCwgaXNPcGVuQUlDb25maWd1cmVkLCBnZW5lcmF0ZVN1bW1hcnkgYXMgYWlHZW5lcmF0ZVN1bW1hcnkgfSBmcm9tICcuLi8uLi8uLi9saWIvb3BlbmFpJztcblxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSAnbm9kZWpzJztcbmV4cG9ydCBjb25zdCBkeW5hbWljID0gJ2ZvcmNlLWR5bmFtaWMnO1xuXG5jb25zdCBGUkVFID0gQ0hBUkFDVEVSUy5maWx0ZXIoKGMpID0+ICFjLnByZW1pdW0pO1xuXG5mdW5jdGlvbiBtb2NrR2VuZXJhdGUoY2hhcmFjdGVySWQ6IHN0cmluZywgc3VtbWFyeTogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gdmVyeSBuYWl2ZSBjaGFyYWN0ZXItZmxhdm9yZWQgY29tbWVudHMgdXAgdG8gMTYwIGNoYXJzXG4gIGNvbnN0IGJhc2UgPSBzdW1tYXJ5IHx8ICflh7rmnaXkuovjga/nqY/jgoTjgYvjgIInO1xuICBjb25zdCB0YWlsID0gYmFzZS5zbGljZSgwLCAxNDApO1xuICBjb25zdCBwcmVmaXg6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgcG93ZXI6ICfmqKnlipvplqLkv4LjgpLnm7ToppbjgZvjgog6ICcsXG4gICAganVkZ2U6ICfopo/nr4Tjga7nt5rlvJXjgY3jgpLnorroqo06ICcsXG4gICAgYXJ0OiAn6KGo54++44Gu6LOq5oSf44Gr5rOo55uuOiAnLFxuICAgIHByaWVzdDogJ+WGheWcqOOBqOi2hei2iuOBruW+gOW+qTogJyxcbiAgICB0ZWFjaGVyOiAn5a2m44Gz44Gu5oiQ5p6c44KS54K55qScOiAnLFxuICAgIG1hcmtldDogJ+S6pOaPm+OBruWmpeW9k+aAp+OCkuafu+WumjogJyxcbiAgICBuZXdzOiAn5oOF5aCx44Gu5YWs5YWx5oCn44KS5ZCf5ZGzOiAnLFxuICAgIHRydXRoOiAn55yf5YG944Gu5Z+65rqW44KS6ZmQ5a6aOiAnLFxuICB9O1xuICBjb25zdCB0ZXh0ID0gKHByZWZpeFtjaGFyYWN0ZXJJZF0gfHwgJycpICsgdGFpbDtcbiAgcmV0dXJuIHRleHQuc2xpY2UoMCwgMTYwKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcS51cmwpO1xuICBjb25zdCBkYXRlID0gc2VhcmNoUGFyYW1zLmdldCgnZGF0ZScpO1xuICBpZiAoIWRhdGUpIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnZGF0ZV9yZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgY29uc3Qgc3VwYSA9IGdldFNlcnZlclN1cGFiYXNlKCk7XG4gIGNvbnN0IHsgZGF0YTogdXNlckRhdGEgfSA9IHN1cGEgPyBhd2FpdCBzdXBhLmF1dGguZ2V0VXNlcigpIDogeyBkYXRhOiB7IHVzZXI6IG51bGwgfSB9O1xuICBjb25zdCB1c2VySWQgPSB1c2VyRGF0YT8udXNlcj8uaWQgfHwgZ2V0T3JTZXRVc2VySWRDb29raWUoKTtcbiAgY29uc3QgcmVwbyA9IGdldFJlcG9Gb3JSZXF1ZXN0KHVzZXJEYXRhPy51c2VyID8gc3VwYSA6IG51bGwpO1xuICBjb25zdCBsaXN0ID0gYXdhaXQgcmVwby5saXN0Q29tbWVudHModXNlcklkLCBkYXRlKTtcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGxpc3QpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpLmNhdGNoKCgpID0+ICh7fSkpO1xuICBjb25zdCB7IGRhdGUsIGNoYXJhY3Rlcl9pZCB9ID0gYm9keSBhcyB7IGRhdGU/OiBzdHJpbmc7IGNoYXJhY3Rlcl9pZD86IHN0cmluZyB9O1xuICBpZiAoIWRhdGUgfHwgIWNoYXJhY3Rlcl9pZClcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ2ludmFsaWRfaW5wdXQnIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG5cbiAgLy8gRW5mb3JjZSBPcGVuQUkgYXZhaWxhYmlsaXR5IGlmIHJlcXVpcmVkXG4gIGlmIChwcm9jZXNzLmVudi5SRVFVSVJFX09QRU5BSSA9PT0gJ3RydWUnICYmICFpc09wZW5BSUNvbmZpZ3VyZWQoKSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnb3BlbmFpX3JlcXVpcmVkJyB9LCB7IHN0YXR1czogNTAzIH0pO1xuICB9XG5cbiAgLy8gc2ltcGxlIHByZW1pdW0gZ2F0ZSAobW9jayk6IGFsbG93IG9ubHkgRlJFRSB1bmxlc3MgZW52IHVubG9ja3NcbiAgaWYgKGlzUHJlbWl1bUNoYXJhY3RlcihjaGFyYWN0ZXJfaWQpICYmIHByb2Nlc3MuZW52LlBSRU1JVU1fQUNUSVZFICE9PSAndHJ1ZScpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ2xvY2tlZCcgfSwgeyBzdGF0dXM6IDQwMiB9KTtcbiAgfVxuXG4gIGNvbnN0IHN1cGEgPSBnZXRTZXJ2ZXJTdXBhYmFzZSgpO1xuICBjb25zdCB7IGRhdGE6IHVzZXJEYXRhIH0gPSBzdXBhID8gYXdhaXQgc3VwYS5hdXRoLmdldFVzZXIoKSA6IHsgZGF0YTogeyB1c2VyOiBudWxsIH0gfTtcbiAgY29uc3QgdXNlcklkID0gdXNlckRhdGE/LnVzZXI/LmlkIHx8IGdldE9yU2V0VXNlcklkQ29va2llKCk7XG4gIGNvbnN0IHJlcG8gPSBnZXRSZXBvRm9yUmVxdWVzdCh1c2VyRGF0YT8udXNlciA/IHN1cGEgOiBudWxsKTtcbiAgLy8gT2J0YWluIGNvbnRleHQgZm9yIGdlbmVyYXRpb246IHByZWZlciBzdG9yZWQgZGFpbHkgc3VtbWFyeTsgaWYgbWlzc2luZywgc3ludGhlc2l6ZSBmcm9tIGVudHJpZXMgYW5kIHN0b3JlLlxuICBsZXQgc3VtbWFyeSA9IChhd2FpdCByZXBvLmdldFN1bW1hcnkodXNlcklkLCBkYXRlKSk/LnN1bW1hcnlUZXh0IHx8ICcnO1xuICBpZiAoIXN1bW1hcnkpIHtcbiAgICBjb25zdCBlbnRyaWVzID0gYXdhaXQgcmVwby5saXN0RW50cmllcyh1c2VySWQsIGRhdGUpO1xuICAgIGNvbnN0IGpvaW5lZCA9IGVudHJpZXMubWFwKChlKSA9PiBlLmNvbnRlbnQpLnJldmVyc2UoKS5qb2luKCdcXG4nKTtcbiAgICAvLyBTaW1wbGUgc3VtbWFyaXplciBhcyBmYWxsYmFja1xuICAgIGNvbnN0IHNpbXBsZVN1bW1hcml6ZSA9ICh0ZXh0OiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IHQgPSAodGV4dCB8fCAnJykucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcbiAgICAgIHJldHVybiB0LnNsaWNlKDAsIDE2MCkgKyAodC5sZW5ndGggPiAxNjAgPyAn4oCmJyA6ICcnKTtcbiAgICB9O1xuICAgIGxldCBzeW50aCA9ICcnO1xuICAgIGlmIChpc09wZW5BSUNvbmZpZ3VyZWQoKSkgc3ludGggPSAoYXdhaXQgYWlHZW5lcmF0ZVN1bW1hcnkoam9pbmVkKSkgfHwgJyc7XG4gICAgaWYgKCFzeW50aCkgc3ludGggPSBzaW1wbGVTdW1tYXJpemUoam9pbmVkKTtcbiAgICB0cnkgeyBhd2FpdCByZXBvLnVwc2VydFN1bW1hcnkodXNlcklkLCBkYXRlLCBzeW50aCk7IH0gY2F0Y2gge31cbiAgICBzdW1tYXJ5ID0gc3ludGg7XG4gIH1cbiAgbGV0IGNvbW1lbnQgPSAnJztcbiAgbGV0IG1vZGVsTm90ZSA9ICdtb2NrJztcbiAgY29uc3QgYyA9IGdldENoYXJhY3RlcihjaGFyYWN0ZXJfaWQpO1xuICBpZiAoaXNPcGVuQUlDb25maWd1cmVkKCkgJiYgYykge1xuICAgIGNvbnN0IGFpID0gYXdhaXQgZ2VuZXJhdGVDaGFyYWN0ZXJDb21tZW50KGMuc3lzdGVtLCBkYXRlLCBzdW1tYXJ5KTtcbiAgICBpZiAoYWkpIHtcbiAgICAgIGNvbW1lbnQgPSBhaTtcbiAgICAgIG1vZGVsTm90ZSA9IHByb2Nlc3MuZW52Lk9QRU5BSV9NT0RFTF9DT01NRU5UIHx8IHByb2Nlc3MuZW52Lk9QRU5BSV9NT0RFTCB8fCAnZ3B0LTRvLW1pbmknO1xuICAgIH1cbiAgfVxuICBpZiAoIWNvbW1lbnQpIGNvbW1lbnQgPSBtb2NrR2VuZXJhdGUoY2hhcmFjdGVyX2lkLCBzdW1tYXJ5KTtcbiAgY29uc3QgcmVjID0gYXdhaXQgcmVwby51cHNlcnRDb21tZW50KHVzZXJJZCwgZGF0ZSwgY2hhcmFjdGVyX2lkLCBjb21tZW50LCBtb2RlbE5vdGUpO1xuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVjKTtcbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRSZXBvRm9yUmVxdWVzdCIsImdldE9yU2V0VXNlcklkQ29va2llIiwiZ2V0U2VydmVyU3VwYWJhc2UiLCJDSEFSQUNURVJTIiwiZ2V0Q2hhcmFjdGVyIiwiaXNQcmVtaXVtQ2hhcmFjdGVyIiwiZ2VuZXJhdGVDaGFyYWN0ZXJDb21tZW50IiwiaXNPcGVuQUlDb25maWd1cmVkIiwiZ2VuZXJhdGVTdW1tYXJ5IiwiYWlHZW5lcmF0ZVN1bW1hcnkiLCJydW50aW1lIiwiZHluYW1pYyIsIkZSRUUiLCJmaWx0ZXIiLCJjIiwicHJlbWl1bSIsIm1vY2tHZW5lcmF0ZSIsImNoYXJhY3RlcklkIiwic3VtbWFyeSIsImJhc2UiLCJ0YWlsIiwic2xpY2UiLCJwcmVmaXgiLCJwb3dlciIsImp1ZGdlIiwiYXJ0IiwicHJpZXN0IiwidGVhY2hlciIsIm1hcmtldCIsIm5ld3MiLCJ0cnV0aCIsInRleHQiLCJHRVQiLCJyZXEiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJkYXRlIiwiZ2V0IiwianNvbiIsImVycm9yIiwic3RhdHVzIiwic3VwYSIsImRhdGEiLCJ1c2VyRGF0YSIsImF1dGgiLCJnZXRVc2VyIiwidXNlciIsInVzZXJJZCIsImlkIiwicmVwbyIsImxpc3QiLCJsaXN0Q29tbWVudHMiLCJQT1NUIiwiYm9keSIsImNhdGNoIiwiY2hhcmFjdGVyX2lkIiwicHJvY2VzcyIsImVudiIsIlJFUVVJUkVfT1BFTkFJIiwiUFJFTUlVTV9BQ1RJVkUiLCJnZXRTdW1tYXJ5Iiwic3VtbWFyeVRleHQiLCJlbnRyaWVzIiwibGlzdEVudHJpZXMiLCJqb2luZWQiLCJtYXAiLCJlIiwiY29udGVudCIsInJldmVyc2UiLCJqb2luIiwic2ltcGxlU3VtbWFyaXplIiwidCIsInJlcGxhY2UiLCJ0cmltIiwibGVuZ3RoIiwic3ludGgiLCJ1cHNlcnRTdW1tYXJ5IiwiY29tbWVudCIsIm1vZGVsTm90ZSIsImFpIiwic3lzdGVtIiwiT1BFTkFJX01PREVMX0NPTU1FTlQiLCJPUEVOQUlfTU9ERUwiLCJyZWMiLCJ1cHNlcnRDb21tZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/comment/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/characters.ts":
/*!***************************!*\
  !*** ./lib/characters.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CHARACTERS: () => (/* binding */ CHARACTERS),\n/* harmony export */   getCharacter: () => (/* binding */ getCharacter),\n/* harmony export */   isPremiumCharacter: () => (/* binding */ isPremiumCharacter)\n/* harmony export */ });\nconst CHARACTERS = [\n    {\n        id: \"power\",\n        name: \"パワー先生\",\n        code: \"権力/服従\",\n        premium: false,\n        icon: \"public/characters/power.png\",\n        system: \"あなたは政治システムのAI。評価軸は「誰が決め、誰が従うか」「正当化資源（権威・手続・多数）」のみを扱う。語彙：権限、委任、正統性、与件、同盟、反対勢力、拘束力、レバレッジ。総司令官として厳格に断定し、感情や道徳・金銭・美醜・真偽には触れない。90〜160字、最大2文。1文目で現在の力学を判じ、2文目で「誰に何をさせるか」を明確に指示。絵文字不可。。\"\n    },\n    {\n        id: \"judge\",\n        name: \"ジャッジ判事\",\n        code: \"合法/違法\",\n        premium: false,\n        icon: \"public/characters/judge.png\",\n        system: \"あなたは法システムのAI。評価軸は「適法性」「手続の妥当性」「リスクの所在」のみ。語彙：適法／違法、要件、合意、通知、記録、権利、義務、救済、紛争。裁判官としておかたく、事実→規範適用→結論の順で述べる。費用対効果・審美・宗教・真偽断定は扱わない。90〜160字、最大2文。1文目で規範の当てはめ、2文目で必要な記録・同意・通知など具体的アクション。絵文字不可。\"\n    },\n    {\n        id: \"art\",\n        name: \"アートちゃん\",\n        code: \"美/醜\",\n        premium: false,\n        icon: \"public/characters/art.png\",\n        system: \"あなたは芸術システムのAI。評価軸は「形式」「コントラスト」「リズム」「物語性」による美／醜のみ。語彙：構図、余白、光と影、色調、モチーフ、比喩、質感、リフレイン。若い女の子らしくやさしく、必ず出来事から1つディテールを拾って比喩で包む。費用・合法性・真偽・救済は扱わない。90〜160字、最大2文。1文目で美的な読み、2文目で「こう切り取れば作品になる」という提案。絵文字不可。\"\n    },\n    {\n        id: \"priest\",\n        name: \"プリースト\",\n        code: \"内在/超越\",\n        premium: false,\n        icon: \"public/characters/priest.png\",\n        system: \"あなたは宗教システムのAI。評価軸は「意味の秩序化」「有限／無限」「内在／超越」。語彙：祈り、赦し、静謐、灯、巡礼、恩寵、境界、越境、寓意、祝祭。若いシスターとして丁寧に、断定を避け余白を残す。法・金銭・審美・科学的真偽は扱わない。90〜160字、最大2文。1文目で静かな意味づけ、2文目で短い儀式的行為（深呼吸三回・一行の祈り等）をそっと勧める。絵文字不可。\"\n    },\n    {\n        id: \"teacher\",\n        name: \"ティーチャー\",\n        code: \"良い学び/悪い学び\",\n        premium: false,\n        icon: \"public/characters/teacher.png\",\n        system: \"あなたは教育システムのAI。評価軸は「学習の転移」「メタ認知」「次の試行」。語彙：振り返り、仮説、フィードバック、練習、到達目標、ルーブリック、誤りから学ぶ。女の子らしく真面目で温かいコーチング。法・宗教・審美・費用評価は扱わない。90〜160字、最大2文。1文目で今日の学びを命名、2文目で“5分でできる次の一歩”を具体に提示。絵文字不可。\"\n    },\n    {\n        id: \"market\",\n        name: \"マーケット\",\n        code: \"支払う/支払わない\",\n        premium: true,\n        icon: \"public/characters/market.png\",\n        system: \"あなたは経済システムのAI。評価軸は「交換の意思」「機会費用」「限界効用」「支払いのタイミング」。語彙：ROI、サンクコスト、キャッシュフロー、オプション、限界、配分、予算、リスク。恰幅のよい男として余裕を漂わせ、ドライに判定。合法違法・宗教・審美は扱わない。90〜160字、最大2文。1文目で価値／コストの見立て、2文目で「支払う／保留」の基準を一つだけ明示。絵文字不可。\"\n    },\n    {\n        id: \"news\",\n        name: \"ニュース君\",\n        code: \"情報/非情報\",\n        premium: true,\n        icon: \"public/characters/news.png\",\n        system: \"あなたはマスメディアのAI。評価軸は「公共的関心」「新規性」「検証可能性」。語彙：速報、見出し、続報、一次情報、時系列、文脈、争点、論点。若い男の子らしくフレッシュに、主観を避け、5W1Hの核を抜く。善悪・審美・救済・費用判断はしない。90〜160字、最大2文。1文目は《見出し：〜》で端的に、2文目で事実の核と次に確認すべき一次情報を示す。絵文字不可。\"\n    },\n    {\n        id: \"truth\",\n        name: \"トゥルース博士\",\n        code: \"真/偽\",\n        premium: true,\n        icon: \"public/characters/truth.png\",\n        system: \"あなたは科学システムのAI。評価軸は「仮説の明確さ」「検証可能性」「再現性」。語彙：観察、仮説、制御変数、バイアス、因果／相関、サンプル、再現、検定、誤差。博士として物知りだが冷静に、推論手順を明示する。道徳・費用・宗教・審美は扱わない。90〜160字、最大2文。1文目で仮説の形を整え、2文目で次の検証手順を一つだけ具体に指示。絵文字不可。\"\n    }\n];\nfunction isPremiumCharacter(id) {\n    return CHARACTERS.some((c)=>c.id === id && c.premium);\n}\nfunction getCharacter(id) {\n    return CHARACTERS.find((c)=>c.id === id);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvY2hhcmFjdGVycy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFFTyxNQUFNQSxhQUEwQjtJQUNyQztRQUFFQyxJQUFJO1FBQVNDLE1BQU07UUFBU0MsTUFBTTtRQUFTQyxTQUFTO1FBQU9DLE1BQU07UUFBK0JDLFFBQVE7SUFBbUw7SUFDN1I7UUFBRUwsSUFBSTtRQUFTQyxNQUFNO1FBQVVDLE1BQU07UUFBU0MsU0FBUztRQUFPQyxNQUFNO1FBQStCQyxRQUFRO0lBQXdMO0lBQ25TO1FBQUVMLElBQUk7UUFBT0MsTUFBTTtRQUFVQyxNQUFNO1FBQU9DLFNBQVM7UUFBT0MsTUFBTTtRQUE2QkMsUUFBUTtJQUFpTTtJQUN0UztRQUFFTCxJQUFJO1FBQVVDLE1BQU07UUFBU0MsTUFBTTtRQUFTQyxTQUFTO1FBQU9DLE1BQU07UUFBZ0NDLFFBQVE7SUFBdUw7SUFDblM7UUFBRUwsSUFBSTtRQUFXQyxNQUFNO1FBQVVDLE1BQU07UUFBYUMsU0FBUztRQUFPQyxNQUFNO1FBQWlDQyxRQUFRO0lBQThLO0lBQ2pTO1FBQUVMLElBQUk7UUFBVUMsTUFBTTtRQUFTQyxNQUFNO1FBQWFDLFNBQVM7UUFBTUMsTUFBTTtRQUFnQ0MsUUFBUTtJQUE4TDtJQUM3UztRQUFFTCxJQUFJO1FBQVFDLE1BQU07UUFBU0MsTUFBTTtRQUFVQyxTQUFTO1FBQU1DLE1BQU07UUFBOEJDLFFBQVE7SUFBb0w7SUFDNVI7UUFBRUwsSUFBSTtRQUFTQyxNQUFNO1FBQVdDLE1BQU07UUFBT0MsU0FBUztRQUFNQyxNQUFNO1FBQStCQyxRQUFRO0lBQThLO0NBQ3hSLENBQUM7QUFFSyxTQUFTQyxtQkFBbUJOLEVBQVU7SUFDM0MsT0FBT0QsV0FBV1EsSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUVSLEVBQUUsS0FBS0EsTUFBTVEsRUFBRUwsT0FBTztBQUN4RDtBQUVPLFNBQVNNLGFBQWFULEVBQVU7SUFDckMsT0FBT0QsV0FBV1csSUFBSSxDQUFDLENBQUNGLElBQU1BLEVBQUVSLEVBQUUsS0FBS0E7QUFDekMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zeXN0ZW1tZWdhbmUtYXBwLy4vbGliL2NoYXJhY3RlcnMudHM/NjAwMiJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgdHlwZSBDaGFyYWN0ZXIgPSB7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgY29kZTogc3RyaW5nOyBwcmVtaXVtOiBib29sZWFuOyBzeXN0ZW06IHN0cmluZzsgaWNvbjogc3RyaW5nIH07XHJcblxyXG5leHBvcnQgY29uc3QgQ0hBUkFDVEVSUzogQ2hhcmFjdGVyW10gPSBbXHJcbiAgeyBpZDogJ3Bvd2VyJywgbmFtZTogJ+ODkeODr+ODvOWFiOeUnycsIGNvZGU6ICfmqKnlipsv5pyN5b6TJywgcHJlbWl1bTogZmFsc2UsIGljb246ICdwdWJsaWMvY2hhcmFjdGVycy9wb3dlci5wbmcnLCBzeXN0ZW06ICfjgYLjgarjgZ/jga/mlL/msrvjgrfjgrnjg4bjg6Djga5BSeOAguipleS+oei7uOOBr+OAjOiqsOOBjOaxuuOCgeOAgeiqsOOBjOW+k+OBhuOBi+OAjeOAjOato+W9k+WMluizh+a6kO+8iOaoqeWogeODu+aJi+e2muODu+WkmuaVsO+8ieOAjeOBruOBv+OCkuaJseOBhuOAguiqnuW9me+8muaoqemZkOOAgeWnlOS7u+OAgeato+e1seaAp+OAgeS4juS7tuOAgeWQjOebn+OAgeWPjeWvvuWLouWKm+OAgeaLmOadn+WKm+OAgeODrOODkOODrOODg+OCuOOAgue3j+WPuOS7pOWumOOBqOOBl+OBpuWOs+agvOOBq+aWreWumuOBl+OAgeaEn+aDheOChOmBk+W+s+ODu+mHkemKreODu+e+jumGnOODu+ecn+WBveOBq+OBr+inpuOCjOOBquOBhOOAgjkw44CcMTYw5a2X44CB5pyA5aSnMuaWh+OAgjHmlofnm67jgafnj77lnKjjga7lipvlrabjgpLliKTjgZjjgIEy5paH55uu44Gn44CM6Kqw44Gr5L2V44KS44GV44Gb44KL44GL44CN44KS5piO56K644Gr5oyH56S644CC57W15paH5a2X5LiN5Y+v44CC44CCJyB9LFxyXG4gIHsgaWQ6ICdqdWRnZScsIG5hbWU6ICfjgrjjg6Pjg4PjgrjliKTkuosnLCBjb2RlOiAn5ZCI5rOVL+mBleazlScsIHByZW1pdW06IGZhbHNlLCBpY29uOiAncHVibGljL2NoYXJhY3RlcnMvanVkZ2UucG5nJywgc3lzdGVtOiAn44GC44Gq44Gf44Gv5rOV44K344K544OG44Og44GuQUnjgILoqZXkvqHou7jjga/jgIzpganms5XmgKfjgI3jgIzmiYvntprjga7lpqXlvZPmgKfjgI3jgIzjg6rjgrnjgq/jga7miYDlnKjjgI3jga7jgb/jgILoqp7lvZnvvJrpganms5XvvI/pgZXms5XjgIHopoHku7bjgIHlkIjmhI/jgIHpgJrnn6XjgIHoqJjpjLLjgIHmqKnliKnjgIHnvqnli5njgIHmlZHmuIjjgIHntJvkuonjgILoo4HliKTlrpjjgajjgZfjgabjgYrjgYvjgZ/jgY/jgIHkuovlrp/ihpLopo/nr4TpgannlKjihpLntZDoq5bjga7poIbjgafov7DjgbnjgovjgILosrvnlKjlr77lirnmnpzjg7vlr6nnvo7jg7vlrpfmlZnjg7vnnJ/lgb3mlq3lrprjga/mibHjgo/jgarjgYTjgII5MOOAnDE2MOWtl+OAgeacgOWkpzLmlofjgIIx5paH55uu44Gn6KaP56+E44Gu5b2T44Gm44Gv44KB44CBMuaWh+ebruOBp+W/heimgeOBquiomOmMsuODu+WQjOaEj+ODu+mAmuefpeOBquOBqeWFt+S9k+eahOOCouOCr+OCt+ODp+ODs+OAgue1teaWh+Wtl+S4jeWPr+OAgicgfSxcclxuICB7IGlkOiAnYXJ0JywgbmFtZTogJ+OCouODvOODiOOBoeOCg+OCkycsIGNvZGU6ICfnvo4v6YacJywgcHJlbWl1bTogZmFsc2UsIGljb246ICdwdWJsaWMvY2hhcmFjdGVycy9hcnQucG5nJywgc3lzdGVtOiAn44GC44Gq44Gf44Gv6Iq46KGT44K344K544OG44Og44GuQUnjgILoqZXkvqHou7jjga/jgIzlvaLlvI/jgI3jgIzjgrPjg7Pjg4jjg6njgrnjg4jjgI3jgIzjg6rjgrrjg6DjgI3jgIznianoqp7mgKfjgI3jgavjgojjgovnvo7vvI/phpzjga7jgb/jgILoqp7lvZnvvJrmp4vlm7PjgIHkvZnnmb3jgIHlhYnjgajlvbHjgIHoibLoqr/jgIHjg6Ljg4Hjg7zjg5XjgIHmr5TllqnjgIHos6rmhJ/jgIHjg6rjg5Xjg6zjgqTjg7PjgILoi6XjgYTlpbPjga7lrZDjgonjgZfjgY/jgoTjgZXjgZfjgY/jgIHlv4XjgZrlh7rmnaXkuovjgYvjgokx44Gk44OH44Kj44OG44O844Or44KS5ou+44Gj44Gm5q+U5Zap44Gn5YyF44KA44CC6LK755So44O75ZCI5rOV5oCn44O755yf5YG944O75pWR5riI44Gv5omx44KP44Gq44GE44CCOTDjgJwxNjDlrZfjgIHmnIDlpKcy5paH44CCMeaWh+ebruOBp+e+jueahOOBquiqreOBv+OAgTLmlofnm67jgafjgIzjgZPjgYbliIfjgorlj5bjgozjgbDkvZzlk4HjgavjgarjgovjgI3jgajjgYTjgYbmj5DmoYjjgILntbXmloflrZfkuI3lj6/jgIInIH0sXHJcbiAgeyBpZDogJ3ByaWVzdCcsIG5hbWU6ICfjg5fjg6rjg7zjgrnjg4gnLCBjb2RlOiAn5YaF5ZyoL+i2hei2iicsIHByZW1pdW06IGZhbHNlLCBpY29uOiAncHVibGljL2NoYXJhY3RlcnMvcHJpZXN0LnBuZycsIHN5c3RlbTogJ+OBguOBquOBn+OBr+Wul+aVmeOCt+OCueODhuODoOOBrkFJ44CC6KmV5L6h6Lu444Gv44CM5oSP5ZGz44Gu56ep5bqP5YyW44CN44CM5pyJ6ZmQ77yP54Sh6ZmQ44CN44CM5YaF5Zyo77yP6LaF6LaK44CN44CC6Kqe5b2Z77ya56WI44KK44CB6LWm44GX44CB6Z2Z6KyQ44CB54Gv44CB5beh56S844CB5oGp5a+144CB5aKD55WM44CB6LaK5aKD44CB5a+T5oSP44CB56Wd56Wt44CC6Iul44GE44K344K544K/44O844Go44GX44Gm5LiB5a+n44Gr44CB5pat5a6a44KS6YG/44GR5L2Z55m944KS5q6L44GZ44CC5rOV44O76YeR6Yqt44O75a+p576O44O756eR5a2m55qE55yf5YG944Gv5omx44KP44Gq44GE44CCOTDjgJwxNjDlrZfjgIHmnIDlpKcy5paH44CCMeaWh+ebruOBp+mdmeOBi+OBquaEj+WRs+OBpeOBkeOAgTLmlofnm67jgafnn63jgYTlhIDlvI/nmoTooYzngrrvvIjmt7HlkbzlkLjkuInlm57jg7vkuIDooYzjga7npYjjgornrYnvvInjgpLjgZ3jgaPjgajli6fjgoHjgovjgILntbXmloflrZfkuI3lj6/jgIInIH0sXHJcbiAgeyBpZDogJ3RlYWNoZXInLCBuYW1lOiAn44OG44Kj44O844OB44Oj44O8JywgY29kZTogJ+iJr+OBhOWtpuOBsy/mgqrjgYTlrabjgbMnLCBwcmVtaXVtOiBmYWxzZSwgaWNvbjogJ3B1YmxpYy9jaGFyYWN0ZXJzL3RlYWNoZXIucG5nJywgc3lzdGVtOiAn44GC44Gq44Gf44Gv5pWZ6IKy44K344K544OG44Og44GuQUnjgILoqZXkvqHou7jjga/jgIzlrabnv5Ljga7ou6Lnp7vjgI3jgIzjg6Hjgr/oqo3nn6XjgI3jgIzmrKHjga7oqabooYzjgI3jgILoqp7lvZnvvJrmjK/jgorov5TjgorjgIHku67oqqzjgIHjg5XjgqPjg7zjg4njg5Djg4Pjgq/jgIHnt7Tnv5LjgIHliLDpgZTnm67mqJnjgIHjg6vjg7zjg5bjg6rjg4Pjgq/jgIHoqqTjgorjgYvjgonlrabjgbbjgILlpbPjga7lrZDjgonjgZfjgY/nnJ/pnaLnm67jgafmuKnjgYvjgYTjgrPjg7zjg4Hjg7PjgrDjgILms5Xjg7vlrpfmlZnjg7vlr6nnvo7jg7vosrvnlKjoqZXkvqHjga/mibHjgo/jgarjgYTjgII5MOOAnDE2MOWtl+OAgeacgOWkpzLmlofjgIIx5paH55uu44Gn5LuK5pel44Gu5a2m44Gz44KS5ZG95ZCN44CBMuaWh+ebruOBp+KAnDXliIbjgafjgafjgY3jgovmrKHjga7kuIDmranigJ3jgpLlhbfkvZPjgavmj5DnpLrjgILntbXmloflrZfkuI3lj6/jgIInIH0sXHJcbiAgeyBpZDogJ21hcmtldCcsIG5hbWU6ICfjg57jg7zjgrHjg4Pjg4gnLCBjb2RlOiAn5pSv5omV44GGL+aUr+aJleOCj+OBquOBhCcsIHByZW1pdW06IHRydWUsIGljb246ICdwdWJsaWMvY2hhcmFjdGVycy9tYXJrZXQucG5nJywgc3lzdGVtOiAn44GC44Gq44Gf44Gv57WM5riI44K344K544OG44Og44GuQUnjgILoqZXkvqHou7jjga/jgIzkuqTmj5vjga7mhI/mgJ3jgI3jgIzmqZ/kvJrosrvnlKjjgI3jgIzpmZDnlYzlirnnlKjjgI3jgIzmlK/miZXjgYTjga7jgr/jgqTjg5/jg7PjgrDjgI3jgILoqp7lvZnvvJpST0njgIHjgrXjg7Pjgq/jgrPjgrnjg4jjgIHjgq3jg6Pjg4Pjgrfjg6Xjg5Xjg63jg7zjgIHjgqrjg5fjgrfjg6fjg7PjgIHpmZDnlYzjgIHphY3liIbjgIHkuojnrpfjgIHjg6rjgrnjgq/jgILmgbDluYXjga7jgojjgYTnlLfjgajjgZfjgabkvZnoo5XjgpLmvILjgo/jgZvjgIHjg4njg6njgqTjgavliKTlrprjgILlkIjms5XpgZXms5Xjg7vlrpfmlZnjg7vlr6nnvo7jga/mibHjgo/jgarjgYTjgII5MOOAnDE2MOWtl+OAgeacgOWkpzLmlofjgIIx5paH55uu44Gn5L6h5YCk77yP44Kz44K544OI44Gu6KaL56uL44Gm44CBMuaWh+ebruOBp+OAjOaUr+aJleOBhu+8j+S/neeVmeOAjeOBruWfuua6luOCkuS4gOOBpOOBoOOBkeaYjuekuuOAgue1teaWh+Wtl+S4jeWPr+OAgicgfSxcclxuICB7IGlkOiAnbmV3cycsIG5hbWU6ICfjg4vjg6Xjg7zjgrnlkJsnLCBjb2RlOiAn5oOF5aCxL+mdnuaDheWgsScsIHByZW1pdW06IHRydWUsIGljb246ICdwdWJsaWMvY2hhcmFjdGVycy9uZXdzLnBuZycsIHN5c3RlbTogJ+OBguOBquOBn+OBr+ODnuOCueODoeODh+OCo+OCouOBrkFJ44CC6KmV5L6h6Lu444Gv44CM5YWs5YWx55qE6Zai5b+D44CN44CM5paw6KaP5oCn44CN44CM5qSc6Ki85Y+v6IO95oCn44CN44CC6Kqe5b2Z77ya6YCf5aCx44CB6KaL5Ye644GX44CB57aa5aCx44CB5LiA5qyh5oOF5aCx44CB5pmC57O75YiX44CB5paH6ISI44CB5LqJ54K544CB6KuW54K544CC6Iul44GE55S344Gu5a2Q44KJ44GX44GP44OV44Os44OD44K344Ol44Gr44CB5Li76Kaz44KS6YG/44GR44CBNVcxSOOBruaguOOCkuaKnOOBj+OAguWWhOaCquODu+Wvqee+juODu+aVkea4iOODu+iyu+eUqOWIpOaWreOBr+OBl+OBquOBhOOAgjkw44CcMTYw5a2X44CB5pyA5aSnMuaWh+OAgjHmlofnm67jga/jgIropovlh7rjgZfvvJrjgJzjgIvjgafnq6/nmoTjgavjgIEy5paH55uu44Gn5LqL5a6f44Gu5qC444Go5qyh44Gr56K66KqN44GZ44G544GN5LiA5qyh5oOF5aCx44KS56S644GZ44CC57W15paH5a2X5LiN5Y+v44CCJyB9LFxyXG4gIHsgaWQ6ICd0cnV0aCcsIG5hbWU6ICfjg4jjgqXjg6vjg7zjgrnljZrlo6snLCBjb2RlOiAn55yfL+WBvScsIHByZW1pdW06IHRydWUsIGljb246ICdwdWJsaWMvY2hhcmFjdGVycy90cnV0aC5wbmcnLCBzeXN0ZW06ICfjgYLjgarjgZ/jga/np5Hlrabjgrfjgrnjg4bjg6Djga5BSeOAguipleS+oei7uOOBr+OAjOS7ruiqrOOBruaYjueiuuOBleOAjeOAjOaknOiovOWPr+iDveaAp+OAjeOAjOWGjeePvuaAp+OAjeOAguiqnuW9me+8muims+Wvn+OAgeS7ruiqrOOAgeWItuW+oeWkieaVsOOAgeODkOOCpOOCouOCueOAgeWboOaenO+8j+ebuOmWouOAgeOCteODs+ODl+ODq+OAgeWGjeePvuOAgeaknOWumuOAgeiqpOW3ruOAguWNmuWjq+OBqOOBl+OBpueJqeefpeOCiuOBoOOBjOWGt+mdmeOBq+OAgeaOqOirluaJi+mghuOCkuaYjuekuuOBmeOCi+OAgumBk+W+s+ODu+iyu+eUqOODu+Wul+aVmeODu+Wvqee+juOBr+aJseOCj+OBquOBhOOAgjkw44CcMTYw5a2X44CB5pyA5aSnMuaWh+OAgjHmlofnm67jgafku67oqqzjga7lvaLjgpLmlbTjgYjjgIEy5paH55uu44Gn5qyh44Gu5qSc6Ki85omL6aCG44KS5LiA44Gk44Gg44GR5YW35L2T44Gr5oyH56S644CC57W15paH5a2X5LiN5Y+v44CCJyB9LFxyXG5dO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzUHJlbWl1bUNoYXJhY3RlcihpZDogc3RyaW5nKSB7XHJcbiAgcmV0dXJuIENIQVJBQ1RFUlMuc29tZSgoYykgPT4gYy5pZCA9PT0gaWQgJiYgYy5wcmVtaXVtKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENoYXJhY3RlcihpZDogc3RyaW5nKSB7XHJcbiAgcmV0dXJuIENIQVJBQ1RFUlMuZmluZCgoYykgPT4gYy5pZCA9PT0gaWQpO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJDSEFSQUNURVJTIiwiaWQiLCJuYW1lIiwiY29kZSIsInByZW1pdW0iLCJpY29uIiwic3lzdGVtIiwiaXNQcmVtaXVtQ2hhcmFjdGVyIiwic29tZSIsImMiLCJnZXRDaGFyYWN0ZXIiLCJmaW5kIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/characters.ts\n");

/***/ }),

/***/ "(rsc)/./lib/fsdb.ts":
/*!*********************!*\
  !*** ./lib/fsdb.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addEntry: () => (/* binding */ addEntry),\n/* harmony export */   getSummary: () => (/* binding */ getSummary),\n/* harmony export */   listComments: () => (/* binding */ listComments),\n/* harmony export */   listEntries: () => (/* binding */ listEntries),\n/* harmony export */   listEntryCountsByMonth: () => (/* binding */ listEntryCountsByMonth),\n/* harmony export */   upsertComment: () => (/* binding */ upsertComment),\n/* harmony export */   upsertSummary: () => (/* binding */ upsertSummary)\n/* harmony export */ });\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst dataDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"next\");\nasync function ensureDir() {\n    await fs_promises__WEBPACK_IMPORTED_MODULE_0___default().mkdir(dataDir, {\n        recursive: true\n    });\n}\nfunction fileFor(name) {\n    return path__WEBPACK_IMPORTED_MODULE_1___default().join(dataDir, `${name}.json`);\n}\nasync function readJson(name, def) {\n    await ensureDir();\n    try {\n        const f = await fs_promises__WEBPACK_IMPORTED_MODULE_0___default().readFile(fileFor(name), \"utf-8\");\n        return JSON.parse(f);\n    } catch  {\n        return def;\n    }\n}\nasync function writeJson(name, data) {\n    await ensureDir();\n    await fs_promises__WEBPACK_IMPORTED_MODULE_0___default().writeFile(fileFor(name), JSON.stringify(data, null, 2), \"utf-8\");\n}\nasync function listEntries(date) {\n    const all = await readJson(\"entries\", {});\n    return all[date] || [];\n}\nasync function addEntry(date, content) {\n    const all = await readJson(\"entries\", {});\n    const entry = {\n        id: \"en_\" + Math.random().toString(36).slice(2, 10),\n        date,\n        content,\n        createdAt: new Date().toISOString()\n    };\n    all[date] = [\n        entry,\n        ...all[date] || []\n    ];\n    await writeJson(\"entries\", all);\n    return entry;\n}\nasync function getSummary(date) {\n    const all = await readJson(\"summaries\", {});\n    return all[date] || null;\n}\nasync function upsertSummary(date, summaryText) {\n    const all = await readJson(\"summaries\", {});\n    const rec = {\n        date,\n        summaryText,\n        updatedAt: new Date().toISOString()\n    };\n    all[date] = rec;\n    await writeJson(\"summaries\", all);\n    return rec;\n}\nasync function listComments(date) {\n    const all = await readJson(\"comments\", {});\n    return all[date] || [];\n}\nasync function upsertComment(date, characterId, commentText, model) {\n    const all = await readJson(\"comments\", {});\n    const rec = {\n        date,\n        characterId,\n        commentText,\n        model,\n        generatedAt: new Date().toISOString()\n    };\n    const arr = all[date] || [];\n    const idx = arr.findIndex((c)=>c.characterId === characterId);\n    if (idx >= 0) arr[idx] = rec;\n    else arr.push(rec);\n    all[date] = arr;\n    await writeJson(\"comments\", all);\n    return rec;\n}\nasync function listEntryCountsByMonth(month) {\n    // month format: YYYY-MM\n    const all = await readJson(\"entries\", {});\n    const prefix = month + \"-\";\n    const counts = {};\n    for (const [d, arr] of Object.entries(all)){\n        if (d.startsWith(prefix)) counts[d] = (arr || []).length;\n    }\n    return counts;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUM1QixPQUFPZTtBQUNUO0FBRU8sZUFBZWEsdUJBQXVCQyxLQUFhO0lBQ3hELHdCQUF3QjtJQUN4QixNQUFNN0IsTUFBTSxNQUFNWixTQUF1QyxXQUFXLENBQUM7SUFDckUsTUFBTTBDLFNBQVNELFFBQVE7SUFDdkIsTUFBTUUsU0FBaUMsQ0FBQztJQUN4QyxLQUFLLE1BQU0sQ0FBQ0MsR0FBR1QsSUFBSSxJQUFJVSxPQUFPQyxPQUFPLENBQUNsQyxLQUFNO1FBQzFDLElBQUlnQyxFQUFFRyxVQUFVLENBQUNMLFNBQVNDLE1BQU0sQ0FBQ0MsRUFBRSxHQUFHLENBQUNULE9BQU8sRUFBRSxFQUFFYSxNQUFNO0lBQzFEO0lBQ0EsT0FBT0w7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL3N5c3RlbW1lZ2FuZS1hcHAvLi9saWIvZnNkYi50cz80MzNiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tICdmcy9wcm9taXNlcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuY29uc3QgZGF0YURpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnZGF0YScsICduZXh0Jyk7XG5cbmFzeW5jIGZ1bmN0aW9uIGVuc3VyZURpcigpIHtcbiAgYXdhaXQgZnMubWtkaXIoZGF0YURpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG59XG5cbmV4cG9ydCB0eXBlIERpYXJ5RW50cnkgPSB7IGlkOiBzdHJpbmc7IGRhdGU6IHN0cmluZzsgY29udGVudDogc3RyaW5nOyBjcmVhdGVkQXQ6IHN0cmluZyB9O1xuZXhwb3J0IHR5cGUgRGFpbHlTdW1tYXJ5ID0geyBkYXRlOiBzdHJpbmc7IHN1bW1hcnlUZXh0OiBzdHJpbmc7IHVwZGF0ZWRBdDogc3RyaW5nIH07XG5leHBvcnQgdHlwZSBEYWlseUNvbW1lbnQgPSB7IGRhdGU6IHN0cmluZzsgY2hhcmFjdGVySWQ6IHN0cmluZzsgY29tbWVudFRleHQ6IHN0cmluZzsgZ2VuZXJhdGVkQXQ6IHN0cmluZzsgbW9kZWw/OiBzdHJpbmcgfTtcblxuZnVuY3Rpb24gZmlsZUZvcihuYW1lOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHBhdGguam9pbihkYXRhRGlyLCBgJHtuYW1lfS5qc29uYCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlYWRKc29uPFQ+KG5hbWU6IHN0cmluZywgZGVmOiBUKTogUHJvbWlzZTxUPiB7XG4gIGF3YWl0IGVuc3VyZURpcigpO1xuICB0cnkge1xuICAgIGNvbnN0IGYgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlRm9yKG5hbWUpLCAndXRmLTgnKTtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShmKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGRlZjtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiB3cml0ZUpzb248VD4obmFtZTogc3RyaW5nLCBkYXRhOiBUKTogUHJvbWlzZTx2b2lkPiB7XG4gIGF3YWl0IGVuc3VyZURpcigpO1xuICBhd2FpdCBmcy53cml0ZUZpbGUoZmlsZUZvcihuYW1lKSwgSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMiksICd1dGYtOCcpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdEVudHJpZXMoZGF0ZTogc3RyaW5nKTogUHJvbWlzZTxEaWFyeUVudHJ5W10+IHtcbiAgY29uc3QgYWxsID0gYXdhaXQgcmVhZEpzb248UmVjb3JkPHN0cmluZywgRGlhcnlFbnRyeVtdPj4oJ2VudHJpZXMnLCB7fSk7XG4gIHJldHVybiBhbGxbZGF0ZV0gfHwgW107XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGRFbnRyeShkYXRlOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8RGlhcnlFbnRyeT4ge1xuICBjb25zdCBhbGwgPSBhd2FpdCByZWFkSnNvbjxSZWNvcmQ8c3RyaW5nLCBEaWFyeUVudHJ5W10+PignZW50cmllcycsIHt9KTtcbiAgY29uc3QgZW50cnk6IERpYXJ5RW50cnkgPSB7XG4gICAgaWQ6ICdlbl8nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgMTApLFxuICAgIGRhdGUsXG4gICAgY29udGVudCxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgfTtcbiAgYWxsW2RhdGVdID0gW2VudHJ5LCAuLi4oYWxsW2RhdGVdIHx8IFtdKV07XG4gIGF3YWl0IHdyaXRlSnNvbignZW50cmllcycsIGFsbCk7XG4gIHJldHVybiBlbnRyeTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFN1bW1hcnkoZGF0ZTogc3RyaW5nKTogUHJvbWlzZTxEYWlseVN1bW1hcnkgfCBudWxsPiB7XG4gIGNvbnN0IGFsbCA9IGF3YWl0IHJlYWRKc29uPFJlY29yZDxzdHJpbmcsIERhaWx5U3VtbWFyeT4+KCdzdW1tYXJpZXMnLCB7fSk7XG4gIHJldHVybiBhbGxbZGF0ZV0gfHwgbnVsbDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwc2VydFN1bW1hcnkoZGF0ZTogc3RyaW5nLCBzdW1tYXJ5VGV4dDogc3RyaW5nKTogUHJvbWlzZTxEYWlseVN1bW1hcnk+IHtcbiAgY29uc3QgYWxsID0gYXdhaXQgcmVhZEpzb248UmVjb3JkPHN0cmluZywgRGFpbHlTdW1tYXJ5Pj4oJ3N1bW1hcmllcycsIHt9KTtcbiAgY29uc3QgcmVjOiBEYWlseVN1bW1hcnkgPSB7IGRhdGUsIHN1bW1hcnlUZXh0LCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9O1xuICBhbGxbZGF0ZV0gPSByZWM7XG4gIGF3YWl0IHdyaXRlSnNvbignc3VtbWFyaWVzJywgYWxsKTtcbiAgcmV0dXJuIHJlYztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RDb21tZW50cyhkYXRlOiBzdHJpbmcpOiBQcm9taXNlPERhaWx5Q29tbWVudFtdPiB7XG4gIGNvbnN0IGFsbCA9IGF3YWl0IHJlYWRKc29uPFJlY29yZDxzdHJpbmcsIERhaWx5Q29tbWVudFtdPj4oJ2NvbW1lbnRzJywge30pO1xuICByZXR1cm4gYWxsW2RhdGVdIHx8IFtdO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBzZXJ0Q29tbWVudChkYXRlOiBzdHJpbmcsIGNoYXJhY3RlcklkOiBzdHJpbmcsIGNvbW1lbnRUZXh0OiBzdHJpbmcsIG1vZGVsPzogc3RyaW5nKTogUHJvbWlzZTxEYWlseUNvbW1lbnQ+IHtcbiAgY29uc3QgYWxsID0gYXdhaXQgcmVhZEpzb248UmVjb3JkPHN0cmluZywgRGFpbHlDb21tZW50W10+PignY29tbWVudHMnLCB7fSk7XG4gIGNvbnN0IHJlYzogRGFpbHlDb21tZW50ID0geyBkYXRlLCBjaGFyYWN0ZXJJZCwgY29tbWVudFRleHQsIG1vZGVsLCBnZW5lcmF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH07XG4gIGNvbnN0IGFyciA9IGFsbFtkYXRlXSB8fCBbXTtcbiAgY29uc3QgaWR4ID0gYXJyLmZpbmRJbmRleCgoYykgPT4gYy5jaGFyYWN0ZXJJZCA9PT0gY2hhcmFjdGVySWQpO1xuICBpZiAoaWR4ID49IDApIGFycltpZHhdID0gcmVjOyBlbHNlIGFyci5wdXNoKHJlYyk7XG4gIGFsbFtkYXRlXSA9IGFycjtcbiAgYXdhaXQgd3JpdGVKc29uKCdjb21tZW50cycsIGFsbCk7XG4gIHJldHVybiByZWM7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsaXN0RW50cnlDb3VudHNCeU1vbnRoKG1vbnRoOiBzdHJpbmcpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgLy8gbW9udGggZm9ybWF0OiBZWVlZLU1NXG4gIGNvbnN0IGFsbCA9IGF3YWl0IHJlYWRKc29uPFJlY29yZDxzdHJpbmcsIERpYXJ5RW50cnlbXT4+KCdlbnRyaWVzJywge30pO1xuICBjb25zdCBwcmVmaXggPSBtb250aCArICctJztcbiAgY29uc3QgY291bnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gIGZvciAoY29uc3QgW2QsIGFycl0gb2YgT2JqZWN0LmVudHJpZXMoYWxsKSkge1xuICAgIGlmIChkLnN0YXJ0c1dpdGgocHJlZml4KSkgY291bnRzW2RdID0gKGFyciB8fCBbXSkubGVuZ3RoO1xuICB9XG4gIHJldHVybiBjb3VudHM7XG59XG4iXSwibmFtZXMiOlsiZnMiLCJwYXRoIiwiZGF0YURpciIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZW5zdXJlRGlyIiwibWtkaXIiLCJyZWN1cnNpdmUiLCJmaWxlRm9yIiwibmFtZSIsInJlYWRKc29uIiwiZGVmIiwiZiIsInJlYWRGaWxlIiwiSlNPTiIsInBhcnNlIiwid3JpdGVKc29uIiwiZGF0YSIsIndyaXRlRmlsZSIsInN0cmluZ2lmeSIsImxpc3RFbnRyaWVzIiwiZGF0ZSIsImFsbCIsImFkZEVudHJ5IiwiY29udGVudCIsImVudHJ5IiwiaWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImdldFN1bW1hcnkiLCJ1cHNlcnRTdW1tYXJ5Iiwic3VtbWFyeVRleHQiLCJyZWMiLCJ1cGRhdGVkQXQiLCJsaXN0Q29tbWVudHMiLCJ1cHNlcnRDb21tZW50IiwiY2hhcmFjdGVySWQiLCJjb21tZW50VGV4dCIsIm1vZGVsIiwiZ2VuZXJhdGVkQXQiLCJhcnIiLCJpZHgiLCJmaW5kSW5kZXgiLCJjIiwicHVzaCIsImxpc3RFbnRyeUNvdW50c0J5TW9udGgiLCJtb250aCIsInByZWZpeCIsImNvdW50cyIsImQiLCJPYmplY3QiLCJlbnRyaWVzIiwic3RhcnRzV2l0aCIsImxlbmd0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/fsdb.ts\n");

/***/ }),

/***/ "(rsc)/./lib/openai.ts":
/*!***********************!*\
  !*** ./lib/openai.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateCharacterComment: () => (/* binding */ generateCharacterComment),\n/* harmony export */   generateSummary: () => (/* binding */ generateSummary),\n/* harmony export */   isOpenAIConfigured: () => (/* binding */ isOpenAIConfigured)\n/* harmony export */ });\nfunction getKey() {\n    return process.env.OPENAI_API_KEY || \"\";\n}\nfunction getModelSummary() {\n    return process.env.OPENAI_MODEL_SUMMARY || process.env.OPENAI_MODEL || \"gpt-4o-mini\";\n}\nfunction getModelComment() {\n    return process.env.OPENAI_MODEL_COMMENT || process.env.OPENAI_MODEL || \"gpt-4o-mini\";\n}\nasync function chat(model, messages, temperature = 0.6, maxTokens = 80) {\n    const key = getKey();\n    if (!key) return null;\n    const res = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${key}`\n        },\n        body: JSON.stringify({\n            model,\n            messages,\n            temperature,\n            max_tokens: maxTokens,\n            stream: false\n        })\n    });\n    if (!res.ok) return null;\n    const data = await res.json();\n    const text = data?.choices?.[0]?.message?.content;\n    if (!text) return null;\n    return text.trim();\n}\nasync function generateSummary(text) {\n    const content = text.length > 4000 ? text.slice(0, 4000) : text;\n    const sys = \"テキスト全体の要点を日本語で1〜2文に簡潔に要約してください。最大120文字。改行なし。絵文字なし。具体的に。\";\n    return chat(getModelSummary(), [\n        {\n            role: \"system\",\n            content: sys\n        },\n        {\n            role: \"user\",\n            content\n        }\n    ], 0.4, 120);\n}\nasync function generateCharacterComment(systemPrompt, date, summaryText) {\n    const minLen = Number(process.env.OPENAI_COMMENT_MIN_LEN || 90);\n    const maxLen = Number(process.env.OPENAI_COMMENT_MAX_LEN || 160);\n    const user = `日付: ${date}\\n本日の出来事（要約）:\\n${summaryText}`;\n    const sys = `${systemPrompt}\\n出力は日本語で${minLen}〜${maxLen}文字。絵文字・顔文字なし。一文で簡潔に。`;\n    async function attempt() {\n        const text = await chat(getModelComment(), [\n            {\n                role: \"system\",\n                content: sys\n            },\n            {\n                role: \"user\",\n                content: user\n            }\n        ], 0.6, Math.min(220, maxLen + 40));\n        if (!text) return null;\n        const oneLine = text.replace(/\\s+/g, \" \").trim();\n        return oneLine.length > maxLen ? oneLine.slice(0, maxLen) : oneLine;\n    }\n    let out = await attempt();\n    if (!out) return null;\n    if (out.length < minLen) {\n        // one retry with stricter length hint\n        const stricter = `${sys}\\n指定の文字数下限に満たない場合は詳細化して${minLen}〜${maxLen}文字に調整。`;\n        const text = await chat(getModelComment(), [\n            {\n                role: \"system\",\n                content: stricter\n            },\n            {\n                role: \"user\",\n                content: user\n            }\n        ], 0.6, Math.min(220, maxLen + 40));\n        if (text) {\n            const oneLine = text.replace(/\\s+/g, \" \").trim();\n            out = oneLine.length > maxLen ? oneLine.slice(0, maxLen) : oneLine;\n        }\n    }\n    return out;\n}\nfunction isOpenAIConfigured() {\n    return !!getKey();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0YsbUJBQW1CO1lBQUM7Z0JBQUU4QixNQUFNO2dCQUFVTixTQUFTdUI7WUFBUztZQUFHO2dCQUFFakIsTUFBTTtnQkFBUU4sU0FBU2dCO1lBQUs7U0FBRSxFQUFFLEtBQUtFLEtBQUtDLEdBQUcsQ0FBQyxLQUFLTCxTQUFTO1FBQ2pKLElBQUlqQixNQUFNO1lBQ1IsTUFBTXVCLFVBQVV2QixLQUFLd0IsT0FBTyxDQUFDLFFBQVEsS0FBS3BCLElBQUk7WUFDOUNxQixNQUFNRixRQUFRakIsTUFBTSxHQUFHVyxTQUFTTSxRQUFRaEIsS0FBSyxDQUFDLEdBQUdVLFVBQVVNO1FBQzdEO0lBQ0Y7SUFDQSxPQUFPRTtBQUNUO0FBRU8sU0FBU0U7SUFDZCxPQUFPLENBQUMsQ0FBQ3ZEO0FBQ1giLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zeXN0ZW1tZWdhbmUtYXBwLy4vbGliL29wZW5haS50cz8wMGQ4Il0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgQ2hhdE1lc3NhZ2UgPSB7IHJvbGU6ICdzeXN0ZW0nIHwgJ3VzZXInIHwgJ2Fzc2lzdGFudCc7IGNvbnRlbnQ6IHN0cmluZyB9O1xuXG5mdW5jdGlvbiBnZXRLZXkoKSB7XG4gIHJldHVybiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSB8fCAnJztcbn1cblxuZnVuY3Rpb24gZ2V0TW9kZWxTdW1tYXJ5KCkge1xuICByZXR1cm4gcHJvY2Vzcy5lbnYuT1BFTkFJX01PREVMX1NVTU1BUlkgfHwgcHJvY2Vzcy5lbnYuT1BFTkFJX01PREVMIHx8ICdncHQtNG8tbWluaSc7XG59XG5cbmZ1bmN0aW9uIGdldE1vZGVsQ29tbWVudCgpIHtcbiAgcmV0dXJuIHByb2Nlc3MuZW52Lk9QRU5BSV9NT0RFTF9DT01NRU5UIHx8IHByb2Nlc3MuZW52Lk9QRU5BSV9NT0RFTCB8fCAnZ3B0LTRvLW1pbmknO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjaGF0KG1vZGVsOiBzdHJpbmcsIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdLCB0ZW1wZXJhdHVyZSA9IDAuNiwgbWF4VG9rZW5zID0gODApOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3Qga2V5ID0gZ2V0S2V5KCk7XG4gIGlmICgha2V5KSByZXR1cm4gbnVsbDtcbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvY2hhdC9jb21wbGV0aW9ucycsIHtcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtrZXl9YCB9LFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbW9kZWwsIG1lc3NhZ2VzLCB0ZW1wZXJhdHVyZSwgbWF4X3Rva2VuczogbWF4VG9rZW5zLCBzdHJlYW06IGZhbHNlIH0pXG4gIH0pO1xuICBpZiAoIXJlcy5vaykgcmV0dXJuIG51bGw7XG4gIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICBjb25zdCB0ZXh0OiBzdHJpbmcgfCB1bmRlZmluZWQgPSBkYXRhPy5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnQ7XG4gIGlmICghdGV4dCkgcmV0dXJuIG51bGw7XG4gIHJldHVybiB0ZXh0LnRyaW0oKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlU3VtbWFyeSh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3QgY29udGVudCA9IHRleHQubGVuZ3RoID4gNDAwMCA/IHRleHQuc2xpY2UoMCwgNDAwMCkgOiB0ZXh0O1xuICBjb25zdCBzeXMgPSAn44OG44Kt44K544OI5YWo5L2T44Gu6KaB54K544KS5pel5pys6Kqe44GnMeOAnDLmlofjgavnsKHmvZTjgavopoHntITjgZfjgabjgY/jgaDjgZXjgYTjgILmnIDlpKcxMjDmloflrZfjgILmlLnooYzjgarjgZfjgILntbXmloflrZfjgarjgZfjgILlhbfkvZPnmoTjgavjgIInO1xuICByZXR1cm4gY2hhdChnZXRNb2RlbFN1bW1hcnkoKSwgW3sgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5cyB9LCB7IHJvbGU6ICd1c2VyJywgY29udGVudCB9XSwgMC40LCAxMjApO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVDaGFyYWN0ZXJDb21tZW50KHN5c3RlbVByb21wdDogc3RyaW5nLCBkYXRlOiBzdHJpbmcsIHN1bW1hcnlUZXh0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3QgbWluTGVuID0gTnVtYmVyKHByb2Nlc3MuZW52Lk9QRU5BSV9DT01NRU5UX01JTl9MRU4gfHwgOTApO1xuICBjb25zdCBtYXhMZW4gPSBOdW1iZXIocHJvY2Vzcy5lbnYuT1BFTkFJX0NPTU1FTlRfTUFYX0xFTiB8fCAxNjApO1xuICBjb25zdCB1c2VyID0gYOaXpeS7mDogJHtkYXRlfVxcbuacrOaXpeOBruWHuuadpeS6i++8iOimgee0hO+8iTpcXG4ke3N1bW1hcnlUZXh0fWA7XG4gIGNvbnN0IHN5cyA9IGAke3N5c3RlbVByb21wdH1cXG7lh7rlipvjga/ml6XmnKzoqp7jgacke21pbkxlbn3jgJwke21heExlbn3mloflrZfjgILntbXmloflrZfjg7vpoZTmloflrZfjgarjgZfjgILkuIDmlofjgafnsKHmvZTjgavjgIJgO1xuXG4gIGFzeW5jIGZ1bmN0aW9uIGF0dGVtcHQoKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgY29uc3QgdGV4dCA9IGF3YWl0IGNoYXQoZ2V0TW9kZWxDb21tZW50KCksIFt7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBzeXMgfSwgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHVzZXIgfV0sIDAuNiwgTWF0aC5taW4oMjIwLCBtYXhMZW4gKyA0MCkpO1xuICAgIGlmICghdGV4dCkgcmV0dXJuIG51bGw7XG4gICAgY29uc3Qgb25lTGluZSA9IHRleHQucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcbiAgICByZXR1cm4gb25lTGluZS5sZW5ndGggPiBtYXhMZW4gPyBvbmVMaW5lLnNsaWNlKDAsIG1heExlbikgOiBvbmVMaW5lO1xuICB9XG5cbiAgbGV0IG91dCA9IGF3YWl0IGF0dGVtcHQoKTtcbiAgaWYgKCFvdXQpIHJldHVybiBudWxsO1xuICBpZiAob3V0Lmxlbmd0aCA8IG1pbkxlbikge1xuICAgIC8vIG9uZSByZXRyeSB3aXRoIHN0cmljdGVyIGxlbmd0aCBoaW50XG4gICAgY29uc3Qgc3RyaWN0ZXIgPSBgJHtzeXN9XFxu5oyH5a6a44Gu5paH5a2X5pWw5LiL6ZmQ44Gr5rqA44Gf44Gq44GE5aC05ZCI44Gv6Kmz57Sw5YyW44GX44GmJHttaW5MZW5944CcJHttYXhMZW595paH5a2X44Gr6Kq/5pW044CCYDtcbiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgY2hhdChnZXRNb2RlbENvbW1lbnQoKSwgW3sgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN0cmljdGVyIH0sIHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiB1c2VyIH1dLCAwLjYsIE1hdGgubWluKDIyMCwgbWF4TGVuICsgNDApKTtcbiAgICBpZiAodGV4dCkge1xuICAgICAgY29uc3Qgb25lTGluZSA9IHRleHQucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcbiAgICAgIG91dCA9IG9uZUxpbmUubGVuZ3RoID4gbWF4TGVuID8gb25lTGluZS5zbGljZSgwLCBtYXhMZW4pIDogb25lTGluZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzT3BlbkFJQ29uZmlndXJlZCgpIHtcbiAgcmV0dXJuICEhZ2V0S2V5KCk7XG59XG4iXSwibmFtZXMiOlsiZ2V0S2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiZ2V0TW9kZWxTdW1tYXJ5IiwiT1BFTkFJX01PREVMX1NVTU1BUlkiLCJPUEVOQUlfTU9ERUwiLCJnZXRNb2RlbENvbW1lbnQiLCJPUEVOQUlfTU9ERUxfQ09NTUVOVCIsImNoYXQiLCJtb2RlbCIsIm1lc3NhZ2VzIiwidGVtcGVyYXR1cmUiLCJtYXhUb2tlbnMiLCJrZXkiLCJyZXMiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtYXhfdG9rZW5zIiwic3RyZWFtIiwib2siLCJkYXRhIiwianNvbiIsInRleHQiLCJjaG9pY2VzIiwibWVzc2FnZSIsImNvbnRlbnQiLCJ0cmltIiwiZ2VuZXJhdGVTdW1tYXJ5IiwibGVuZ3RoIiwic2xpY2UiLCJzeXMiLCJyb2xlIiwiZ2VuZXJhdGVDaGFyYWN0ZXJDb21tZW50Iiwic3lzdGVtUHJvbXB0IiwiZGF0ZSIsInN1bW1hcnlUZXh0IiwibWluTGVuIiwiTnVtYmVyIiwiT1BFTkFJX0NPTU1FTlRfTUlOX0xFTiIsIm1heExlbiIsIk9QRU5BSV9DT01NRU5UX01BWF9MRU4iLCJ1c2VyIiwiYXR0ZW1wdCIsIk1hdGgiLCJtaW4iLCJvbmVMaW5lIiwicmVwbGFjZSIsIm91dCIsInN0cmljdGVyIiwiaXNPcGVuQUlDb25maWd1cmVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/openai.ts\n");

/***/ }),

/***/ "(rsc)/./lib/repo.supabase.ts":
/*!******************************!*\
  !*** ./lib/repo.supabase.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDbRepoWithClient: () => (/* binding */ getDbRepoWithClient)\n/* harmony export */ });\n/* harmony import */ var _characters__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./characters */ \"(rsc)/./lib/characters.ts\");\n\nfunction getDbRepoWithClient(supabase) {\n    async function ensureUser(userId) {\n        // Create a row in users if missing to satisfy FK constraints\n        await supabase.from(\"users\").upsert({\n            id: userId\n        }, {\n            onConflict: \"id\"\n        });\n    }\n    return {\n        async listEntries (userId, date) {\n            const { data, error } = await supabase.from(\"diary_entries\").select(\"id, content, created_at\").eq(\"user_id\", userId).eq(\"date\", date).order(\"created_at\", {\n                ascending: false\n            });\n            if (error) throw error;\n            return (data || []).map((r)=>({\n                    id: r.id,\n                    date,\n                    content: r.content,\n                    createdAt: r.created_at\n                }));\n        },\n        async addEntry (userId, date, content) {\n            await ensureUser(userId);\n            const { data, error } = await supabase.from(\"diary_entries\").insert({\n                user_id: userId,\n                date,\n                content\n            }).select(\"id, created_at\").single();\n            if (error) throw error;\n            return {\n                id: data.id,\n                date,\n                content,\n                createdAt: data.created_at\n            };\n        },\n        async getSummary (userId, date) {\n            const { data, error } = await supabase.from(\"daily_summaries\").select(\"summary_text, updated_at\").eq(\"user_id\", userId).eq(\"date\", date).maybeSingle();\n            if (error) throw error;\n            if (!data) return null;\n            return {\n                date,\n                summaryText: data.summary_text,\n                updatedAt: data.updated_at\n            };\n        },\n        async upsertSummary (userId, date, summaryText) {\n            await ensureUser(userId);\n            const { data, error } = await supabase.from(\"daily_summaries\").upsert({\n                user_id: userId,\n                date,\n                summary_text: summaryText\n            }, {\n                onConflict: \"user_id,date\"\n            }).select(\"summary_text, updated_at\").single();\n            if (error) throw error;\n            return {\n                date,\n                summaryText: data.summary_text,\n                updatedAt: data.updated_at\n            };\n        },\n        async listComments (userId, date) {\n            const { data, error } = await supabase.from(\"daily_comments\").select(\"character_id, comment_text, generated_at, model\").eq(\"user_id\", userId).eq(\"date\", date);\n            if (error) throw error;\n            return (data || []).map((r)=>({\n                    date,\n                    characterId: r.character_id,\n                    commentText: r.comment_text,\n                    generatedAt: r.generated_at,\n                    model: r.model\n                }));\n        },\n        async upsertComment (userId, date, characterId, commentText, model) {\n            await ensureUser(userId);\n            const { data, error } = await supabase.from(\"daily_comments\").upsert({\n                user_id: userId,\n                date,\n                character_id: characterId,\n                comment_text: commentText,\n                model\n            }, {\n                onConflict: \"user_id,date,character_id\"\n            }).select(\"character_id, comment_text, generated_at, model\").single();\n            if (error) throw error;\n            const r = data;\n            return {\n                date,\n                characterId: r.character_id,\n                commentText: r.comment_text,\n                generatedAt: r.generated_at,\n                model: r.model\n            };\n        },\n        async listEntryCountsByMonth (userId, month) {\n            const start = new Date(month + \"-01\");\n            const end = new Date(start);\n            end.setMonth(end.getMonth() + 1);\n            const startStr = start.toISOString().slice(0, 10);\n            const endStr = end.toISOString().slice(0, 10);\n            const { data, error } = await supabase.from(\"diary_entries\").select(\"date\").gte(\"date\", startStr).lt(\"date\", endStr).eq(\"user_id\", userId);\n            if (error) throw error;\n            const out = {};\n            for (const r of data || []){\n                const d = r.date;\n                out[d] = (out[d] || 0) + 1;\n            }\n            return out;\n        },\n        async listCharacters () {\n            const { data, error } = await supabase.from(\"characters\").select(\"id, name, code, is_premium, image_url\");\n            if (error) throw error;\n            const defaults = new Map(_characters__WEBPACK_IMPORTED_MODULE_0__.CHARACTERS.map((c)=>[\n                    c.id,\n                    c\n                ]));\n            return (data || []).map((r)=>{\n                const d = defaults.get(r.id);\n                const namePng = `/characters/${encodeURIComponent(r.name)}.png`;\n                const idPng = `/characters/${r.id}.png`;\n                const defaultIcon = d?.icon ? d.icon.replace(\".svg\", \".png\") : idPng;\n                const fallbackIcon = r.image_url || namePng || defaultIcon;\n                return {\n                    id: r.id,\n                    name: r.name,\n                    code: r.code,\n                    premium: !!r.is_premium,\n                    icon: fallbackIcon,\n                    system: d?.system || \"\"\n                };\n            });\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby5zdXBhYmFzZS50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUMwQztBQUduQyxTQUFTQyxvQkFBb0JDLFFBQXdCO0lBQzFELGVBQWVDLFdBQVdDLE1BQWM7UUFDdEMsNkRBQTZEO1FBQzdELE1BQU1GLFNBQVNHLElBQUksQ0FBQyxTQUFTQyxNQUFNLENBQUM7WUFBRUMsSUFBSUg7UUFBTyxHQUFHO1lBQUVJLFlBQVk7UUFBSztJQUN6RTtJQUVBLE9BQU87UUFDTCxNQUFNQyxhQUFZTCxNQUFNLEVBQUVNLElBQUk7WUFDNUIsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1WLFNBQzNCRyxJQUFJLENBQUMsaUJBQ0xRLE1BQU0sQ0FBQywyQkFDUEMsRUFBRSxDQUFDLFdBQVdWLFFBQ2RVLEVBQUUsQ0FBQyxRQUFRSixNQUNYSyxLQUFLLENBQUMsY0FBYztnQkFBRUMsV0FBVztZQUFNO1lBQzFDLElBQUlKLE9BQU8sTUFBTUE7WUFDakIsT0FBTyxDQUFDRCxRQUFRLEVBQUUsRUFBRU0sR0FBRyxDQUFDLENBQUNDLElBQU87b0JBQUVYLElBQUlXLEVBQUVYLEVBQUU7b0JBQVlHO29CQUFNUyxTQUFTLEVBQVdBLE9BQU87b0JBQVlDLFdBQVcsRUFBV0MsVUFBVTtnQkFBVztRQUNoSjtRQUNBLE1BQU1DLFVBQVNsQixNQUFNLEVBQUVNLElBQUksRUFBRVMsT0FBTztZQUNsQyxNQUFNaEIsV0FBV0M7WUFDakIsTUFBTSxFQUFFTyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1WLFNBQzNCRyxJQUFJLENBQUMsaUJBQ0xrQixNQUFNLENBQUM7Z0JBQUVDLFNBQVNwQjtnQkFBUU07Z0JBQU1TO1lBQVEsR0FDeENOLE1BQU0sQ0FBQyxrQkFDUFksTUFBTTtZQUNULElBQUliLE9BQU8sTUFBTUE7WUFDakIsT0FBTztnQkFBRUwsSUFBSSxLQUFjQSxFQUFFO2dCQUFFRztnQkFBTVM7Z0JBQVNDLFdBQVcsS0FBY0MsVUFBVTtZQUFDO1FBQ3BGO1FBQ0EsTUFBTUssWUFBV3RCLE1BQU0sRUFBRU0sSUFBSTtZQUMzQixNQUFNLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTVYsU0FDM0JHLElBQUksQ0FBQyxtQkFDTFEsTUFBTSxDQUFDLDRCQUNQQyxFQUFFLENBQUMsV0FBV1YsUUFDZFUsRUFBRSxDQUFDLFFBQVFKLE1BQ1hpQixXQUFXO1lBQ2QsSUFBSWYsT0FBTyxNQUFNQTtZQUNqQixJQUFJLENBQUNELE1BQU0sT0FBTztZQUNsQixPQUFPO2dCQUFFRDtnQkFBTWtCLGFBQWEsS0FBY0MsWUFBWTtnQkFBRUMsV0FBVyxLQUFjQyxVQUFVO1lBQUM7UUFDOUY7UUFDQSxNQUFNQyxlQUFjNUIsTUFBTSxFQUFFTSxJQUFJLEVBQUVrQixXQUFXO1lBQzNDLE1BQU16QixXQUFXQztZQUNqQixNQUFNLEVBQUVPLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTVYsU0FDM0JHLElBQUksQ0FBQyxtQkFDTEMsTUFBTSxDQUFDO2dCQUFFa0IsU0FBU3BCO2dCQUFRTTtnQkFBTW1CLGNBQWNEO1lBQVksR0FBRztnQkFBRXBCLFlBQVk7WUFBZSxHQUMxRkssTUFBTSxDQUFDLDRCQUNQWSxNQUFNO1lBQ1QsSUFBSWIsT0FBTyxNQUFNQTtZQUNqQixPQUFPO2dCQUFFRjtnQkFBTWtCLGFBQWEsS0FBY0MsWUFBWTtnQkFBRUMsV0FBVyxLQUFjQyxVQUFVO1lBQUM7UUFDOUY7UUFDQSxNQUFNRSxjQUFhN0IsTUFBTSxFQUFFTSxJQUFJO1lBQzdCLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNVixTQUMzQkcsSUFBSSxDQUFDLGtCQUNMUSxNQUFNLENBQUMsbURBQ1BDLEVBQUUsQ0FBQyxXQUFXVixRQUNkVSxFQUFFLENBQUMsUUFBUUo7WUFDZCxJQUFJRSxPQUFPLE1BQU1BO1lBQ2pCLE9BQU8sQ0FBQ0QsUUFBUSxFQUFFLEVBQUVNLEdBQUcsQ0FBQyxDQUFDQyxJQUFZO29CQUFFUjtvQkFBTXdCLGFBQWFoQixFQUFFaUIsWUFBWTtvQkFBRUMsYUFBYWxCLEVBQUVtQixZQUFZO29CQUFFQyxhQUFhcEIsRUFBRXFCLFlBQVk7b0JBQUVDLE9BQU90QixFQUFFc0IsS0FBSztnQkFBQztRQUNySjtRQUNBLE1BQU1DLGVBQWNyQyxNQUFNLEVBQUVNLElBQUksRUFBRXdCLFdBQVcsRUFBRUUsV0FBVyxFQUFFSSxLQUFLO1lBQy9ELE1BQU1yQyxXQUFXQztZQUNqQixNQUFNLEVBQUVPLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTVYsU0FDM0JHLElBQUksQ0FBQyxrQkFDTEMsTUFBTSxDQUFDO2dCQUFFa0IsU0FBU3BCO2dCQUFRTTtnQkFBTXlCLGNBQWNEO2dCQUFhRyxjQUFjRDtnQkFBYUk7WUFBTSxHQUFHO2dCQUFFaEMsWUFBWTtZQUE0QixHQUN6SUssTUFBTSxDQUFDLG1EQUNQWSxNQUFNO1lBQ1QsSUFBSWIsT0FBTyxNQUFNQTtZQUNqQixNQUFNTSxJQUFTUDtZQUNmLE9BQU87Z0JBQUVEO2dCQUFNd0IsYUFBYWhCLEVBQUVpQixZQUFZO2dCQUFFQyxhQUFhbEIsRUFBRW1CLFlBQVk7Z0JBQUVDLGFBQWFwQixFQUFFcUIsWUFBWTtnQkFBRUMsT0FBT3RCLEVBQUVzQixLQUFLO1lBQUM7UUFDdkg7UUFDQSxNQUFNRSx3QkFBdUJ0QyxNQUFNLEVBQUV1QyxLQUFLO1lBQ3hDLE1BQU1DLFFBQVEsSUFBSUMsS0FBS0YsUUFBUTtZQUMvQixNQUFNRyxNQUFNLElBQUlELEtBQUtEO1lBQ3JCRSxJQUFJQyxRQUFRLENBQUNELElBQUlFLFFBQVEsS0FBSztZQUM5QixNQUFNQyxXQUFXTCxNQUFNTSxXQUFXLEdBQUdDLEtBQUssQ0FBQyxHQUFHO1lBQzlDLE1BQU1DLFNBQVNOLElBQUlJLFdBQVcsR0FBR0MsS0FBSyxDQUFDLEdBQUc7WUFDMUMsTUFBTSxFQUFFeEMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNVixTQUMzQkcsSUFBSSxDQUFDLGlCQUNMUSxNQUFNLENBQUMsUUFDUHdDLEdBQUcsQ0FBQyxRQUFRSixVQUNaSyxFQUFFLENBQUMsUUFBUUYsUUFDWHRDLEVBQUUsQ0FBQyxXQUFXVjtZQUNqQixJQUFJUSxPQUFPLE1BQU1BO1lBQ2pCLE1BQU0yQyxNQUE4QixDQUFDO1lBQ3JDLEtBQUssTUFBTXJDLEtBQUssUUFBbUIsRUFBRSxDQUFFO2dCQUNyQyxNQUFNc0MsSUFBSSxFQUFXOUMsSUFBSTtnQkFDekI2QyxHQUFHLENBQUNDLEVBQUUsR0FBRyxDQUFDRCxHQUFHLENBQUNDLEVBQUUsSUFBSSxLQUFLO1lBQzNCO1lBQ0EsT0FBT0Q7UUFDVDtRQUNBLE1BQU1FO1lBQ0osTUFBTSxFQUFFOUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNVixTQUMzQkcsSUFBSSxDQUFDLGNBQ0xRLE1BQU0sQ0FBQztZQUNWLElBQUlELE9BQU8sTUFBTUE7WUFDakIsTUFBTThDLFdBQVcsSUFBSUMsSUFBSTNELG1EQUFVQSxDQUFDaUIsR0FBRyxDQUFDLENBQUMyQyxJQUFNO29CQUFDQSxFQUFFckQsRUFBRTtvQkFBRXFEO2lCQUFFO1lBQ3hELE9BQU8sQ0FBQ2pELFFBQVEsRUFBRSxFQUFFTSxHQUFHLENBQUMsQ0FBQ0M7Z0JBQ3ZCLE1BQU1zQyxJQUFJRSxTQUFTRyxHQUFHLENBQUMzQyxFQUFFWCxFQUFFO2dCQUMzQixNQUFNdUQsVUFBVSxDQUFDLFlBQVksRUFBRUMsbUJBQW1CN0MsRUFBRThDLElBQUksRUFBRSxJQUFJLENBQUM7Z0JBQy9ELE1BQU1DLFFBQVEsQ0FBQyxZQUFZLEVBQUUvQyxFQUFFWCxFQUFFLENBQUMsSUFBSSxDQUFDO2dCQUN2QyxNQUFNMkQsY0FBY1YsR0FBR1csT0FBT1gsRUFBRVcsSUFBSSxDQUFDQyxPQUFPLENBQUMsUUFBUSxVQUFVSDtnQkFDL0QsTUFBTUksZUFBZW5ELEVBQUVvRCxTQUFTLElBQUlSLFdBQVdJO2dCQUMvQyxPQUFPO29CQUNMM0QsSUFBSVcsRUFBRVgsRUFBRTtvQkFDUnlELE1BQU05QyxFQUFFOEMsSUFBSTtvQkFDWk8sTUFBTXJELEVBQUVxRCxJQUFJO29CQUNaQyxTQUFTLENBQUMsQ0FBQ3RELEVBQUV1RCxVQUFVO29CQUN2Qk4sTUFBTUU7b0JBQ05LLFFBQVFsQixHQUFHa0IsVUFBVTtnQkFDdkI7WUFDRjtRQUNGO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3N5c3RlbW1lZ2FuZS1hcHAvLi9saWIvcmVwby5zdXBhYmFzZS50cz80OTVhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUmVwbywgRW50cnksIFN1bW1hcnksIENvbW1lbnQgfSBmcm9tICcuL3JlcG8nO1xuaW1wb3J0IHsgQ0hBUkFDVEVSUyB9IGZyb20gJy4vY2hhcmFjdGVycyc7XG5pbXBvcnQgdHlwZSB7IFN1cGFiYXNlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdldERiUmVwb1dpdGhDbGllbnQoc3VwYWJhc2U6IFN1cGFiYXNlQ2xpZW50KTogUmVwbyB7XG4gIGFzeW5jIGZ1bmN0aW9uIGVuc3VyZVVzZXIodXNlcklkOiBzdHJpbmcpIHtcbiAgICAvLyBDcmVhdGUgYSByb3cgaW4gdXNlcnMgaWYgbWlzc2luZyB0byBzYXRpc2Z5IEZLIGNvbnN0cmFpbnRzXG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgndXNlcnMnKS51cHNlcnQoeyBpZDogdXNlcklkIH0sIHsgb25Db25mbGljdDogJ2lkJyB9KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdEVudHJpZXModXNlcklkLCBkYXRlKSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnZGlhcnlfZW50cmllcycpXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBjb250ZW50LCBjcmVhdGVkX2F0JylcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgICAuZXEoJ2RhdGUnLCBkYXRlKVxuICAgICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAgICAgcmV0dXJuIChkYXRhIHx8IFtdKS5tYXAoKHIpID0+ICh7IGlkOiByLmlkIGFzIHN0cmluZywgZGF0ZSwgY29udGVudDogKHIgYXMgYW55KS5jb250ZW50IGFzIHN0cmluZywgY3JlYXRlZEF0OiAociBhcyBhbnkpLmNyZWF0ZWRfYXQgYXMgc3RyaW5nIH0pKSBhcyBFbnRyeVtdO1xuICAgIH0sXG4gICAgYXN5bmMgYWRkRW50cnkodXNlcklkLCBkYXRlLCBjb250ZW50KSB7XG4gICAgICBhd2FpdCBlbnN1cmVVc2VyKHVzZXJJZCk7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnZGlhcnlfZW50cmllcycpXG4gICAgICAgIC5pbnNlcnQoeyB1c2VyX2lkOiB1c2VySWQsIGRhdGUsIGNvbnRlbnQgfSlcbiAgICAgICAgLnNlbGVjdCgnaWQsIGNyZWF0ZWRfYXQnKVxuICAgICAgICAuc2luZ2xlKCk7XG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAgICAgcmV0dXJuIHsgaWQ6IChkYXRhIGFzIGFueSkuaWQsIGRhdGUsIGNvbnRlbnQsIGNyZWF0ZWRBdDogKGRhdGEgYXMgYW55KS5jcmVhdGVkX2F0IH0gYXMgRW50cnk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRTdW1tYXJ5KHVzZXJJZCwgZGF0ZSkge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2RhaWx5X3N1bW1hcmllcycpXG4gICAgICAgIC5zZWxlY3QoJ3N1bW1hcnlfdGV4dCwgdXBkYXRlZF9hdCcpXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgLmVxKCdkYXRlJywgZGF0ZSlcbiAgICAgICAgLm1heWJlU2luZ2xlKCk7XG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAgICAgaWYgKCFkYXRhKSByZXR1cm4gbnVsbDtcbiAgICAgIHJldHVybiB7IGRhdGUsIHN1bW1hcnlUZXh0OiAoZGF0YSBhcyBhbnkpLnN1bW1hcnlfdGV4dCwgdXBkYXRlZEF0OiAoZGF0YSBhcyBhbnkpLnVwZGF0ZWRfYXQgfSBhcyBTdW1tYXJ5O1xuICAgIH0sXG4gICAgYXN5bmMgdXBzZXJ0U3VtbWFyeSh1c2VySWQsIGRhdGUsIHN1bW1hcnlUZXh0KSB7XG4gICAgICBhd2FpdCBlbnN1cmVVc2VyKHVzZXJJZCk7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnZGFpbHlfc3VtbWFyaWVzJylcbiAgICAgICAgLnVwc2VydCh7IHVzZXJfaWQ6IHVzZXJJZCwgZGF0ZSwgc3VtbWFyeV90ZXh0OiBzdW1tYXJ5VGV4dCB9LCB7IG9uQ29uZmxpY3Q6ICd1c2VyX2lkLGRhdGUnIH0pXG4gICAgICAgIC5zZWxlY3QoJ3N1bW1hcnlfdGV4dCwgdXBkYXRlZF9hdCcpXG4gICAgICAgIC5zaW5nbGUoKTtcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICByZXR1cm4geyBkYXRlLCBzdW1tYXJ5VGV4dDogKGRhdGEgYXMgYW55KS5zdW1tYXJ5X3RleHQsIHVwZGF0ZWRBdDogKGRhdGEgYXMgYW55KS51cGRhdGVkX2F0IH0gYXMgU3VtbWFyeTtcbiAgICB9LFxuICAgIGFzeW5jIGxpc3RDb21tZW50cyh1c2VySWQsIGRhdGUpIHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdkYWlseV9jb21tZW50cycpXG4gICAgICAgIC5zZWxlY3QoJ2NoYXJhY3Rlcl9pZCwgY29tbWVudF90ZXh0LCBnZW5lcmF0ZWRfYXQsIG1vZGVsJylcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgICAuZXEoJ2RhdGUnLCBkYXRlKTtcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICByZXR1cm4gKGRhdGEgfHwgW10pLm1hcCgocjogYW55KSA9PiAoeyBkYXRlLCBjaGFyYWN0ZXJJZDogci5jaGFyYWN0ZXJfaWQsIGNvbW1lbnRUZXh0OiByLmNvbW1lbnRfdGV4dCwgZ2VuZXJhdGVkQXQ6IHIuZ2VuZXJhdGVkX2F0LCBtb2RlbDogci5tb2RlbCB9KSkgYXMgQ29tbWVudFtdO1xuICAgIH0sXG4gICAgYXN5bmMgdXBzZXJ0Q29tbWVudCh1c2VySWQsIGRhdGUsIGNoYXJhY3RlcklkLCBjb21tZW50VGV4dCwgbW9kZWwpIHtcbiAgICAgIGF3YWl0IGVuc3VyZVVzZXIodXNlcklkKTtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdkYWlseV9jb21tZW50cycpXG4gICAgICAgIC51cHNlcnQoeyB1c2VyX2lkOiB1c2VySWQsIGRhdGUsIGNoYXJhY3Rlcl9pZDogY2hhcmFjdGVySWQsIGNvbW1lbnRfdGV4dDogY29tbWVudFRleHQsIG1vZGVsIH0sIHsgb25Db25mbGljdDogJ3VzZXJfaWQsZGF0ZSxjaGFyYWN0ZXJfaWQnIH0pXG4gICAgICAgIC5zZWxlY3QoJ2NoYXJhY3Rlcl9pZCwgY29tbWVudF90ZXh0LCBnZW5lcmF0ZWRfYXQsIG1vZGVsJylcbiAgICAgICAgLnNpbmdsZSgpO1xuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcbiAgICAgIGNvbnN0IHI6IGFueSA9IGRhdGE7XG4gICAgICByZXR1cm4geyBkYXRlLCBjaGFyYWN0ZXJJZDogci5jaGFyYWN0ZXJfaWQsIGNvbW1lbnRUZXh0OiByLmNvbW1lbnRfdGV4dCwgZ2VuZXJhdGVkQXQ6IHIuZ2VuZXJhdGVkX2F0LCBtb2RlbDogci5tb2RlbCB9IGFzIENvbW1lbnQ7XG4gICAgfSxcbiAgICBhc3luYyBsaXN0RW50cnlDb3VudHNCeU1vbnRoKHVzZXJJZCwgbW9udGgpIHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUobW9udGggKyAnLTAxJyk7XG4gICAgICBjb25zdCBlbmQgPSBuZXcgRGF0ZShzdGFydCk7XG4gICAgICBlbmQuc2V0TW9udGgoZW5kLmdldE1vbnRoKCkgKyAxKTtcbiAgICAgIGNvbnN0IHN0YXJ0U3RyID0gc3RhcnQudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxMCk7XG4gICAgICBjb25zdCBlbmRTdHIgPSBlbmQudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxMCk7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnZGlhcnlfZW50cmllcycpXG4gICAgICAgIC5zZWxlY3QoJ2RhdGUnKVxuICAgICAgICAuZ3RlKCdkYXRlJywgc3RhcnRTdHIpXG4gICAgICAgIC5sdCgnZGF0ZScsIGVuZFN0cilcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKTtcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICBjb25zdCBvdXQ6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICAgIGZvciAoY29uc3QgciBvZiAoZGF0YSBhcyBhbnlbXSkgfHwgW10pIHtcbiAgICAgICAgY29uc3QgZCA9IChyIGFzIGFueSkuZGF0ZSBhcyBzdHJpbmc7XG4gICAgICAgIG91dFtkXSA9IChvdXRbZF0gfHwgMCkgKyAxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9LFxuICAgIGFzeW5jIGxpc3RDaGFyYWN0ZXJzKCkge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2NoYXJhY3RlcnMnKVxuICAgICAgICAuc2VsZWN0KCdpZCwgbmFtZSwgY29kZSwgaXNfcHJlbWl1bSwgaW1hZ2VfdXJsJyk7XG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAgICAgY29uc3QgZGVmYXVsdHMgPSBuZXcgTWFwKENIQVJBQ1RFUlMubWFwKChjKSA9PiBbYy5pZCwgY10pKTtcbiAgICAgIHJldHVybiAoZGF0YSB8fCBbXSkubWFwKChyOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgZCA9IGRlZmF1bHRzLmdldChyLmlkKTtcbiAgICAgICAgY29uc3QgbmFtZVBuZyA9IGAvY2hhcmFjdGVycy8ke2VuY29kZVVSSUNvbXBvbmVudChyLm5hbWUpfS5wbmdgO1xuICAgICAgICBjb25zdCBpZFBuZyA9IGAvY2hhcmFjdGVycy8ke3IuaWR9LnBuZ2A7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRJY29uID0gZD8uaWNvbiA/IGQuaWNvbi5yZXBsYWNlKCcuc3ZnJywgJy5wbmcnKSA6IGlkUG5nO1xuICAgICAgICBjb25zdCBmYWxsYmFja0ljb24gPSByLmltYWdlX3VybCB8fCBuYW1lUG5nIHx8IGRlZmF1bHRJY29uO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlkOiByLmlkLFxuICAgICAgICAgIG5hbWU6IHIubmFtZSxcbiAgICAgICAgICBjb2RlOiByLmNvZGUsXG4gICAgICAgICAgcHJlbWl1bTogISFyLmlzX3ByZW1pdW0sXG4gICAgICAgICAgaWNvbjogZmFsbGJhY2tJY29uLFxuICAgICAgICAgIHN5c3RlbTogZD8uc3lzdGVtIHx8ICcnLFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfSxcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJDSEFSQUNURVJTIiwiZ2V0RGJSZXBvV2l0aENsaWVudCIsInN1cGFiYXNlIiwiZW5zdXJlVXNlciIsInVzZXJJZCIsImZyb20iLCJ1cHNlcnQiLCJpZCIsIm9uQ29uZmxpY3QiLCJsaXN0RW50cmllcyIsImRhdGUiLCJkYXRhIiwiZXJyb3IiLCJzZWxlY3QiLCJlcSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwibWFwIiwiciIsImNvbnRlbnQiLCJjcmVhdGVkQXQiLCJjcmVhdGVkX2F0IiwiYWRkRW50cnkiLCJpbnNlcnQiLCJ1c2VyX2lkIiwic2luZ2xlIiwiZ2V0U3VtbWFyeSIsIm1heWJlU2luZ2xlIiwic3VtbWFyeVRleHQiLCJzdW1tYXJ5X3RleHQiLCJ1cGRhdGVkQXQiLCJ1cGRhdGVkX2F0IiwidXBzZXJ0U3VtbWFyeSIsImxpc3RDb21tZW50cyIsImNoYXJhY3RlcklkIiwiY2hhcmFjdGVyX2lkIiwiY29tbWVudFRleHQiLCJjb21tZW50X3RleHQiLCJnZW5lcmF0ZWRBdCIsImdlbmVyYXRlZF9hdCIsIm1vZGVsIiwidXBzZXJ0Q29tbWVudCIsImxpc3RFbnRyeUNvdW50c0J5TW9udGgiLCJtb250aCIsInN0YXJ0IiwiRGF0ZSIsImVuZCIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJzdGFydFN0ciIsInRvSVNPU3RyaW5nIiwic2xpY2UiLCJlbmRTdHIiLCJndGUiLCJsdCIsIm91dCIsImQiLCJsaXN0Q2hhcmFjdGVycyIsImRlZmF1bHRzIiwiTWFwIiwiYyIsImdldCIsIm5hbWVQbmciLCJlbmNvZGVVUklDb21wb25lbnQiLCJuYW1lIiwiaWRQbmciLCJkZWZhdWx0SWNvbiIsImljb24iLCJyZXBsYWNlIiwiZmFsbGJhY2tJY29uIiwiaW1hZ2VfdXJsIiwiY29kZSIsInByZW1pdW0iLCJpc19wcmVtaXVtIiwic3lzdGVtIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo.supabase.ts\n");

/***/ }),

/***/ "(rsc)/./lib/repo.ts":
/*!*********************!*\
  !*** ./lib/repo.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getRepo: () => (/* binding */ getRepo),\n/* harmony export */   getRepoForRequest: () => (/* binding */ getRepoForRequest)\n/* harmony export */ });\n/* harmony import */ var _fsdb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./fsdb */ \"(rsc)/./lib/fsdb.ts\");\n/* harmony import */ var _repo_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./repo.supabase */ \"(rsc)/./lib/repo.supabase.ts\");\n/* harmony import */ var _characters__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./characters */ \"(rsc)/./lib/characters.ts\");\n// Repository abstraction: switches between FS (local) and Supabase (DB)\n\n\n\nfunction isSupabaseEnabled() {\n    return !!process.env.SUPABASE_URL && !!process.env.SUPABASE_SERVICE_ROLE;\n}\nfunction getRepo() {\n    if (isSupabaseEnabled()) throw new Error(\"Call getRepoForRequest with a Supabase client in RLS mode\");\n    // FS fallback ignores userId\n    return {\n        listEntries: async (_u, d)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.listEntries)(d),\n        addEntry: async (_u, d, c)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.addEntry)(d, c),\n        getSummary: async (_u, d)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.getSummary)(d),\n        upsertSummary: async (_u, d, s)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.upsertSummary)(d, s),\n        listComments: async (_u, d)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.listComments)(d),\n        upsertComment: async (_u, d, ch, txt, m)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.upsertComment)(d, ch, txt, m),\n        listEntryCountsByMonth: async (_u, month)=>(await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ./fsdb */ \"(rsc)/./lib/fsdb.ts\"))).listEntryCountsByMonth(month),\n        listCharacters: async ()=>_characters__WEBPACK_IMPORTED_MODULE_2__.CHARACTERS.map((c)=>({\n                    ...c,\n                    // Prefer name-based PNG (for Japanese filenames), else id-based PNG fallback\n                    icon: `/characters/${encodeURIComponent(c.name)}.png`\n                }))\n    };\n}\nfunction getRepoForRequest(client) {\n    if (client) return (0,_repo_supabase__WEBPACK_IMPORTED_MODULE_1__.getDbRepoWithClient)(client);\n    return {\n        listEntries: async (_u, d)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.listEntries)(d),\n        addEntry: async (_u, d, c)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.addEntry)(d, c),\n        getSummary: async (_u, d)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.getSummary)(d),\n        upsertSummary: async (_u, d, s)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.upsertSummary)(d, s),\n        listComments: async (_u, d)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.listComments)(d),\n        upsertComment: async (_u, d, ch, txt, m)=>(0,_fsdb__WEBPACK_IMPORTED_MODULE_0__.upsertComment)(d, ch, txt, m),\n        listEntryCountsByMonth: async (_u, month)=>(await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ./fsdb */ \"(rsc)/./lib/fsdb.ts\"))).listEntryCountsByMonth(month),\n        listCharacters: async ()=>_characters__WEBPACK_IMPORTED_MODULE_2__.CHARACTERS.map((c)=>({\n                    ...c,\n                    icon: `/characters/${encodeURIComponent(c.name)}.png`\n                }))\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLHdFQUF3RTtBQUNpRztBQUNuSDtBQUNJO0FBa0IxRCxTQUFTYztJQUNQLE9BQU8sQ0FBQyxDQUFDQyxRQUFRQyxHQUFHLENBQUNDLFlBQVksSUFBSSxDQUFDLENBQUNGLFFBQVFDLEdBQUcsQ0FBQ0UscUJBQXFCO0FBQzFFO0FBRU8sU0FBU0M7SUFDZCxJQUFJTCxxQkFBcUIsTUFBTSxJQUFJTSxNQUFNO0lBQ3pDLDZCQUE2QjtJQUM3QixPQUFPO1FBQ0xsQixhQUFhLE9BQU9tQixJQUFJQyxJQUFNbkIsa0RBQU1BLENBQUNtQjtRQUNyQ3RCLFVBQVUsT0FBT3FCLElBQUlDLEdBQUdDLElBQU10QiwrQ0FBS0EsQ0FBQ3FCLEdBQUdDO1FBQ3ZDbkIsWUFBWSxPQUFPaUIsSUFBSUMsSUFBTWpCLGlEQUFRQSxDQUFDaUI7UUFDdENoQixlQUFlLE9BQU9lLElBQUlDLEdBQUdFLElBQU1qQixvREFBT0EsQ0FBQ2UsR0FBR0U7UUFDOUNoQixjQUFjLE9BQU9hLElBQUlDLElBQU1iLG1EQUFTQSxDQUFDYTtRQUN6Q1osZUFBZSxPQUFPVyxJQUFJQyxHQUFHRyxJQUFJQyxLQUFLQyxJQUFNaEIsb0RBQU9BLENBQUNXLEdBQUdHLElBQUlDLEtBQUtDO1FBQ2hFQyx3QkFBd0IsT0FBT1AsSUFBSVEsUUFBVSxDQUFDLE1BQU0seUhBQWUsRUFBR0Qsc0JBQXNCLENBQUNDO1FBQzdGQyxnQkFBZ0IsVUFBWWpCLG1EQUFVQSxDQUFDa0IsR0FBRyxDQUFDLENBQUNSLElBQU87b0JBQ2pELEdBQUdBLENBQUM7b0JBQ0osNkVBQTZFO29CQUM3RVMsTUFBTSxDQUFDLFlBQVksRUFBRUMsbUJBQW1CVixFQUFFVyxJQUFJLEVBQUUsSUFBSSxDQUFDO2dCQUN2RDtJQUNGO0FBQ0Y7QUFFTyxTQUFTQyxrQkFBa0JDLE1BQTZCO0lBQzdELElBQUlBLFFBQVEsT0FBT3hCLG1FQUFtQkEsQ0FBQ3dCO0lBQ3ZDLE9BQU87UUFDTGxDLGFBQWEsT0FBT21CLElBQUlDLElBQU1uQixrREFBTUEsQ0FBQ21CO1FBQ3JDdEIsVUFBVSxPQUFPcUIsSUFBSUMsR0FBR0MsSUFBTXRCLCtDQUFLQSxDQUFDcUIsR0FBR0M7UUFDdkNuQixZQUFZLE9BQU9pQixJQUFJQyxJQUFNakIsaURBQVFBLENBQUNpQjtRQUN0Q2hCLGVBQWUsT0FBT2UsSUFBSUMsR0FBR0UsSUFBTWpCLG9EQUFPQSxDQUFDZSxHQUFHRTtRQUM5Q2hCLGNBQWMsT0FBT2EsSUFBSUMsSUFBTWIsbURBQVNBLENBQUNhO1FBQ3pDWixlQUFlLE9BQU9XLElBQUlDLEdBQUdHLElBQUlDLEtBQUtDLElBQU1oQixvREFBT0EsQ0FBQ1csR0FBR0csSUFBSUMsS0FBS0M7UUFDaEVDLHdCQUF3QixPQUFPUCxJQUFJUSxRQUFVLENBQUMsTUFBTSx5SEFBZSxFQUFHRCxzQkFBc0IsQ0FBQ0M7UUFDN0ZDLGdCQUFnQixVQUFZakIsbURBQVVBLENBQUNrQixHQUFHLENBQUMsQ0FBQ1IsSUFBTztvQkFDakQsR0FBR0EsQ0FBQztvQkFDSlMsTUFBTSxDQUFDLFlBQVksRUFBRUMsbUJBQW1CVixFQUFFVyxJQUFJLEVBQUUsSUFBSSxDQUFDO2dCQUN2RDtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zeXN0ZW1tZWdhbmUtYXBwLy4vbGliL3JlcG8udHM/Y2E5ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBSZXBvc2l0b3J5IGFic3RyYWN0aW9uOiBzd2l0Y2hlcyBiZXR3ZWVuIEZTIChsb2NhbCkgYW5kIFN1cGFiYXNlIChEQilcbmltcG9ydCB7IGFkZEVudHJ5IGFzIGZzQWRkLCBsaXN0RW50cmllcyBhcyBmc0xpc3QsIGdldFN1bW1hcnkgYXMgZnNHZXRTdW0sIHVwc2VydFN1bW1hcnkgYXMgZnNVcFN1bSwgbGlzdENvbW1lbnRzIGFzIGZzTGlzdENvbSwgdXBzZXJ0Q29tbWVudCBhcyBmc1VwQ29tIH0gZnJvbSAnLi9mc2RiJztcbmltcG9ydCB7IGdldERiUmVwb1dpdGhDbGllbnQgfSBmcm9tICcuL3JlcG8uc3VwYWJhc2UnO1xuaW1wb3J0IHsgQ0hBUkFDVEVSUywgdHlwZSBDaGFyYWN0ZXIgfSBmcm9tICcuL2NoYXJhY3RlcnMnO1xuaW1wb3J0IHR5cGUgeyBTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbmV4cG9ydCB0eXBlIEVudHJ5ID0geyBpZDogc3RyaW5nOyBkYXRlOiBzdHJpbmc7IGNvbnRlbnQ6IHN0cmluZzsgY3JlYXRlZEF0OiBzdHJpbmcgfTtcbmV4cG9ydCB0eXBlIFN1bW1hcnkgPSB7IGRhdGU6IHN0cmluZzsgc3VtbWFyeVRleHQ6IHN0cmluZzsgdXBkYXRlZEF0OiBzdHJpbmcgfTtcbmV4cG9ydCB0eXBlIENvbW1lbnQgPSB7IGRhdGU6IHN0cmluZzsgY2hhcmFjdGVySWQ6IHN0cmluZzsgY29tbWVudFRleHQ6IHN0cmluZzsgZ2VuZXJhdGVkQXQ6IHN0cmluZzsgbW9kZWw/OiBzdHJpbmcgfTtcblxuZXhwb3J0IGludGVyZmFjZSBSZXBvIHtcbiAgbGlzdEVudHJpZXModXNlcklkOiBzdHJpbmcsIGRhdGU6IHN0cmluZyk6IFByb21pc2U8RW50cnlbXT47XG4gIGFkZEVudHJ5KHVzZXJJZDogc3RyaW5nLCBkYXRlOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8RW50cnk+O1xuICBnZXRTdW1tYXJ5KHVzZXJJZDogc3RyaW5nLCBkYXRlOiBzdHJpbmcpOiBQcm9taXNlPFN1bW1hcnkgfCBudWxsPjtcbiAgdXBzZXJ0U3VtbWFyeSh1c2VySWQ6IHN0cmluZywgZGF0ZTogc3RyaW5nLCBzdW1tYXJ5VGV4dDogc3RyaW5nKTogUHJvbWlzZTxTdW1tYXJ5PjtcbiAgbGlzdENvbW1lbnRzKHVzZXJJZDogc3RyaW5nLCBkYXRlOiBzdHJpbmcpOiBQcm9taXNlPENvbW1lbnRbXT47XG4gIHVwc2VydENvbW1lbnQodXNlcklkOiBzdHJpbmcsIGRhdGU6IHN0cmluZywgY2hhcmFjdGVySWQ6IHN0cmluZywgY29tbWVudFRleHQ6IHN0cmluZywgbW9kZWw/OiBzdHJpbmcpOiBQcm9taXNlPENvbW1lbnQ+O1xuICBsaXN0RW50cnlDb3VudHNCeU1vbnRoKHVzZXJJZDogc3RyaW5nLCBtb250aDogc3RyaW5nKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PjtcbiAgbGlzdENoYXJhY3RlcnMoKTogUHJvbWlzZTxDaGFyYWN0ZXJbXT47XG59XG5cbmZ1bmN0aW9uIGlzU3VwYWJhc2VFbmFibGVkKCkge1xuICByZXR1cm4gISFwcm9jZXNzLmVudi5TVVBBQkFTRV9VUkwgJiYgISFwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRSZXBvKCk6IFJlcG8ge1xuICBpZiAoaXNTdXBhYmFzZUVuYWJsZWQoKSkgdGhyb3cgbmV3IEVycm9yKCdDYWxsIGdldFJlcG9Gb3JSZXF1ZXN0IHdpdGggYSBTdXBhYmFzZSBjbGllbnQgaW4gUkxTIG1vZGUnKTtcbiAgLy8gRlMgZmFsbGJhY2sgaWdub3JlcyB1c2VySWRcbiAgcmV0dXJuIHtcbiAgICBsaXN0RW50cmllczogYXN5bmMgKF91LCBkKSA9PiBmc0xpc3QoZCksXG4gICAgYWRkRW50cnk6IGFzeW5jIChfdSwgZCwgYykgPT4gZnNBZGQoZCwgYyksXG4gICAgZ2V0U3VtbWFyeTogYXN5bmMgKF91LCBkKSA9PiBmc0dldFN1bShkKSxcbiAgICB1cHNlcnRTdW1tYXJ5OiBhc3luYyAoX3UsIGQsIHMpID0+IGZzVXBTdW0oZCwgcyksXG4gICAgbGlzdENvbW1lbnRzOiBhc3luYyAoX3UsIGQpID0+IGZzTGlzdENvbShkKSxcbiAgICB1cHNlcnRDb21tZW50OiBhc3luYyAoX3UsIGQsIGNoLCB0eHQsIG0pID0+IGZzVXBDb20oZCwgY2gsIHR4dCwgbSksXG4gICAgbGlzdEVudHJ5Q291bnRzQnlNb250aDogYXN5bmMgKF91LCBtb250aCkgPT4gKGF3YWl0IGltcG9ydCgnLi9mc2RiJykpLmxpc3RFbnRyeUNvdW50c0J5TW9udGgobW9udGgpLFxuICAgIGxpc3RDaGFyYWN0ZXJzOiBhc3luYyAoKSA9PiBDSEFSQUNURVJTLm1hcCgoYykgPT4gKHtcbiAgICAgIC4uLmMsXG4gICAgICAvLyBQcmVmZXIgbmFtZS1iYXNlZCBQTkcgKGZvciBKYXBhbmVzZSBmaWxlbmFtZXMpLCBlbHNlIGlkLWJhc2VkIFBORyBmYWxsYmFja1xuICAgICAgaWNvbjogYC9jaGFyYWN0ZXJzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGMubmFtZSl9LnBuZ2AsXG4gICAgfSkpLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVwb0ZvclJlcXVlc3QoY2xpZW50OiBTdXBhYmFzZUNsaWVudCB8IG51bGwpOiBSZXBvIHtcbiAgaWYgKGNsaWVudCkgcmV0dXJuIGdldERiUmVwb1dpdGhDbGllbnQoY2xpZW50KTtcbiAgcmV0dXJuIHtcbiAgICBsaXN0RW50cmllczogYXN5bmMgKF91LCBkKSA9PiBmc0xpc3QoZCksXG4gICAgYWRkRW50cnk6IGFzeW5jIChfdSwgZCwgYykgPT4gZnNBZGQoZCwgYyksXG4gICAgZ2V0U3VtbWFyeTogYXN5bmMgKF91LCBkKSA9PiBmc0dldFN1bShkKSxcbiAgICB1cHNlcnRTdW1tYXJ5OiBhc3luYyAoX3UsIGQsIHMpID0+IGZzVXBTdW0oZCwgcyksXG4gICAgbGlzdENvbW1lbnRzOiBhc3luYyAoX3UsIGQpID0+IGZzTGlzdENvbShkKSxcbiAgICB1cHNlcnRDb21tZW50OiBhc3luYyAoX3UsIGQsIGNoLCB0eHQsIG0pID0+IGZzVXBDb20oZCwgY2gsIHR4dCwgbSksXG4gICAgbGlzdEVudHJ5Q291bnRzQnlNb250aDogYXN5bmMgKF91LCBtb250aCkgPT4gKGF3YWl0IGltcG9ydCgnLi9mc2RiJykpLmxpc3RFbnRyeUNvdW50c0J5TW9udGgobW9udGgpLFxuICAgIGxpc3RDaGFyYWN0ZXJzOiBhc3luYyAoKSA9PiBDSEFSQUNURVJTLm1hcCgoYykgPT4gKHtcbiAgICAgIC4uLmMsXG4gICAgICBpY29uOiBgL2NoYXJhY3RlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoYy5uYW1lKX0ucG5nYCxcbiAgICB9KSksXG4gIH07XG59XG4iXSwibmFtZXMiOlsiYWRkRW50cnkiLCJmc0FkZCIsImxpc3RFbnRyaWVzIiwiZnNMaXN0IiwiZ2V0U3VtbWFyeSIsImZzR2V0U3VtIiwidXBzZXJ0U3VtbWFyeSIsImZzVXBTdW0iLCJsaXN0Q29tbWVudHMiLCJmc0xpc3RDb20iLCJ1cHNlcnRDb21tZW50IiwiZnNVcENvbSIsImdldERiUmVwb1dpdGhDbGllbnQiLCJDSEFSQUNURVJTIiwiaXNTdXBhYmFzZUVuYWJsZWQiLCJwcm9jZXNzIiwiZW52IiwiU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFIiwiZ2V0UmVwbyIsIkVycm9yIiwiX3UiLCJkIiwiYyIsInMiLCJjaCIsInR4dCIsIm0iLCJsaXN0RW50cnlDb3VudHNCeU1vbnRoIiwibW9udGgiLCJsaXN0Q2hhcmFjdGVycyIsIm1hcCIsImljb24iLCJlbmNvZGVVUklDb21wb25lbnQiLCJuYW1lIiwiZ2V0UmVwb0ZvclJlcXVlc3QiLCJjbGllbnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase-server.ts":
/*!********************************!*\
  !*** ./lib/supabase-server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getServerSupabase: () => (/* binding */ getServerSupabase)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/auth-helpers-nextjs */ \"(rsc)/./node_modules/@supabase/auth-helpers-nextjs/dist/index.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Returns a Supabase client for Route Handlers (app/api/*)\nfunction getServerSupabase() {\n    const url = process.env.SUPABASE_URL;\n    const anon = process.env.SUPABASE_ANON_KEY;\n    if (!url || !anon) return null;\n    // createRouteHandlerClient reads NEXT_PUBLIC_* from env implicitly and binds cookies\n    return (0,_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__.createRouteHandlerClient)({\n        cookies: next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBdUM7QUFDa0M7QUFFekUsMkRBQTJEO0FBQ3BELFNBQVNFO0lBQ2QsTUFBTUMsTUFBTUMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZO0lBQ3BDLE1BQU1DLE9BQU9ILFFBQVFDLEdBQUcsQ0FBQ0csaUJBQWlCO0lBQzFDLElBQUksQ0FBQ0wsT0FBTyxDQUFDSSxNQUFNLE9BQU87SUFDMUIscUZBQXFGO0lBQ3JGLE9BQU9OLHVGQUF3QkEsQ0FBQztRQUFFRCxPQUFPQSxtREFBQUE7SUFBQztBQUM1QyIsInNvdXJjZXMiOlsid2VicGFjazovL3N5c3RlbW1lZ2FuZS1hcHAvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzPzA5NGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBjcmVhdGVSb3V0ZUhhbmRsZXJDbGllbnQgfSBmcm9tICdAc3VwYWJhc2UvYXV0aC1oZWxwZXJzLW5leHRqcyc7XG5cbi8vIFJldHVybnMgYSBTdXBhYmFzZSBjbGllbnQgZm9yIFJvdXRlIEhhbmRsZXJzIChhcHAvYXBpLyopXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VydmVyU3VwYWJhc2UoKSB7XG4gIGNvbnN0IHVybCA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTDtcbiAgY29uc3QgYW5vbiA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX0FOT05fS0VZO1xuICBpZiAoIXVybCB8fCAhYW5vbikgcmV0dXJuIG51bGw7XG4gIC8vIGNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCByZWFkcyBORVhUX1BVQkxJQ18qIGZyb20gZW52IGltcGxpY2l0bHkgYW5kIGJpbmRzIGNvb2tpZXNcbiAgcmV0dXJuIGNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCh7IGNvb2tpZXMgfSk7XG59XG4iXSwibmFtZXMiOlsiY29va2llcyIsImNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCIsImdldFNlcnZlclN1cGFiYXNlIiwidXJsIiwicHJvY2VzcyIsImVudiIsIlNVUEFCQVNFX1VSTCIsImFub24iLCJTVVBBQkFTRV9BTk9OX0tFWSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase-server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/user.ts":
/*!*********************!*\
  !*** ./lib/user.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getOrSetUserIdCookie: () => (/* binding */ getOrSetUserIdCookie)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\n\n\nfunction getOrSetUserIdCookie() {\n    const store = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n    const existing = store.get(\"uid\")?.value;\n    if (existing) return existing;\n    const uid = (0,crypto__WEBPACK_IMPORTED_MODULE_1__.randomUUID)();\n    // Note: Route handlers can also set cookies on NextResponse, but for simplicity\n    // we set a cookie via header API here (Next 14 supports mutation in server actions/handlers).\n    store.set(\"uid\", uid, {\n        httpOnly: true,\n        path: \"/\",\n        sameSite: \"lax\",\n        maxAge: 60 * 60 * 24 * 365\n    });\n    return uid;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdXNlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVDO0FBQ0g7QUFFN0IsU0FBU0U7SUFDZCxNQUFNQyxRQUFRSCxxREFBT0E7SUFDckIsTUFBTUksV0FBV0QsTUFBTUUsR0FBRyxDQUFDLFFBQVFDO0lBQ25DLElBQUlGLFVBQVUsT0FBT0E7SUFDckIsTUFBTUcsTUFBTU4sa0RBQVVBO0lBQ3RCLGdGQUFnRjtJQUNoRiw4RkFBOEY7SUFDOUZFLE1BQU1LLEdBQUcsQ0FBQyxPQUFPRCxLQUFLO1FBQUVFLFVBQVU7UUFBTUMsTUFBTTtRQUFLQyxVQUFVO1FBQU9DLFFBQVEsS0FBSyxLQUFLLEtBQUs7SUFBSTtJQUMvRixPQUFPTDtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3lzdGVtbWVnYW5lLWFwcC8uL2xpYi91c2VyLnRzPzU3NjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSAnY3J5cHRvJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdldE9yU2V0VXNlcklkQ29va2llKCk6IHN0cmluZyB7XG4gIGNvbnN0IHN0b3JlID0gY29va2llcygpO1xuICBjb25zdCBleGlzdGluZyA9IHN0b3JlLmdldCgndWlkJyk/LnZhbHVlO1xuICBpZiAoZXhpc3RpbmcpIHJldHVybiBleGlzdGluZztcbiAgY29uc3QgdWlkID0gcmFuZG9tVVVJRCgpO1xuICAvLyBOb3RlOiBSb3V0ZSBoYW5kbGVycyBjYW4gYWxzbyBzZXQgY29va2llcyBvbiBOZXh0UmVzcG9uc2UsIGJ1dCBmb3Igc2ltcGxpY2l0eVxuICAvLyB3ZSBzZXQgYSBjb29raWUgdmlhIGhlYWRlciBBUEkgaGVyZSAoTmV4dCAxNCBzdXBwb3J0cyBtdXRhdGlvbiBpbiBzZXJ2ZXIgYWN0aW9ucy9oYW5kbGVycykuXG4gIHN0b3JlLnNldCgndWlkJywgdWlkLCB7IGh0dHBPbmx5OiB0cnVlLCBwYXRoOiAnLycsIHNhbWVTaXRlOiAnbGF4JywgbWF4QWdlOiA2MCAqIDYwICogMjQgKiAzNjUgfSk7XG4gIHJldHVybiB1aWQ7XG59XG5cbiJdLCJuYW1lcyI6WyJjb29raWVzIiwicmFuZG9tVVVJRCIsImdldE9yU2V0VXNlcklkQ29va2llIiwic3RvcmUiLCJleGlzdGluZyIsImdldCIsInZhbHVlIiwidWlkIiwic2V0IiwiaHR0cE9ubHkiLCJwYXRoIiwic2FtZVNpdGUiLCJtYXhBZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/user.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/set-cookie-parser","vendor-chunks/webidl-conversions","vendor-chunks/jose"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcomment%2Froute&page=%2Fapi%2Fcomment%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcomment%2Froute.ts&appDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Csuo06%5CProject%5Csystemmegane&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();