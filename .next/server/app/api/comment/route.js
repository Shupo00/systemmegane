"use strict";(()=>{var e={};e.id=753,e.ids=[753],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},629:e=>{e.exports=require("fs/promises")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},4674:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>q,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>j});var s={};r.r(s),r.d(s,{GET:()=>f,POST:()=>g,dynamic:()=>x,runtime:()=>d});var n=r(9303),a=r(8716),o=r(670),i=r(7070),u=r(9454),p=r(2131),c=r(1472),m=r(9869),l=r(9678);let d="nodejs",x="force-dynamic";async function f(e){let{searchParams:t}=new URL(e.url),r=t.get("date");if(!r)return i.NextResponse.json({error:"date_required"},{status:400});let s=(0,c.b)(),{data:n}=s?await s.auth.getUser():{data:{user:null}},a=n?.user?.id||(0,p.a)(),o=(0,u.X)(n?.user?s:null),m=await o.listComments(a,r);return i.NextResponse.json(m)}async function g(e){let{date:t,character_id:r}=await e.json().catch(()=>({}));if(!t||!r)return i.NextResponse.json({error:"invalid_input"},{status:400});if("true"===process.env.REQUIRE_OPENAI&&!(0,l.mf)())return i.NextResponse.json({error:"openai_required"},{status:503});if((0,m.Z9)(r)&&"true"!==process.env.PREMIUM_ACTIVE)return i.NextResponse.json({error:"locked"},{status:402});let s=(0,c.b)(),{data:n}=s?await s.auth.getUser():{data:{user:null}},a=n?.user?.id||(0,p.a)(),o=(0,u.X)(n?.user?s:null),d=(await o.getSummary(a,t))?.summaryText||"";if(!d){let e=(await o.listEntries(a,t)).map(e=>e.content).reverse().join("\n"),r="";(0,l.mf)()&&(r=await (0,l.h8)(e)||""),r||(r=(e=>{let t=(e||"").replace(/\s+/g," ").trim();return t.slice(0,160)+(t.length>160?"…":"")})(e));try{await o.upsertSummary(a,t,r)}catch{}d=r}let x="",f="mock",g=(0,m.Pm)(r);if((0,l.mf)()&&g){let e=await (0,l.hT)(g.system,t,d);e&&(x=e,f=process.env.OPENAI_MODEL_COMMENT||process.env.OPENAI_MODEL||"gpt-4o-mini")}x||(x=((({power:"権力関係を直視せよ: ",judge:"規範の線引きを確認: ",art:"表現の質感に注目: ",priest:"内在と超越の往復: ",teacher:"学びの成果を点検: ",market:"交換の妥当性を査定: ",news:"情報の公共性を吟味: ",truth:"真偽の基準を限定: "})[r]||"")+(d||"出来事は穏やか。").slice(0,140)).slice(0,160));let h=await o.upsertComment(a,t,r,x,f);return i.NextResponse.json(h)}m.k_.filter(e=>!e.premium);let h=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/comment/route",pathname:"/api/comment",filename:"route",bundlePath:"app/api/comment/route"},resolvedPagePath:"C:\\Users\\suo06\\Project\\systemmegane\\app\\api\\comment\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:q,staticGenerationAsyncStorage:j,serverHooks:y}=h,v="/api/comment/route";function w(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:j})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,180,213],()=>r(4674));module.exports=s})();