(()=>{var e={};e.id=174,e.ids=[174],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},6494:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>h,tree:()=>l}),s(8768),s(1506),s(5866);var r=s(3191),a=s(8716),i=s(7922),n=s.n(i),d=s(5231),c={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>d[e]);s.d(t,c);let l=["",{children:["day",{children:["[date]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8768)),"C:\\Users\\suo06\\Project\\systemmegane\\app\\day\\[date]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"C:\\Users\\suo06\\Project\\systemmegane\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\suo06\\Project\\systemmegane\\app\\day\\[date]\\page.tsx"],m="/day/[date]/page",u={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/day/[date]/page",pathname:"/day/[date]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},7410:(e,t,s)=>{Promise.resolve().then(s.bind(s,5191)),Promise.resolve().then(s.bind(s,933)),Promise.resolve().then(s.bind(s,6618))},2904:(e,t,s)=>{Promise.resolve().then(s.bind(s,3814))},2706:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},5191:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(326),a=s(7577),i=s(5047),n=s(7574);function d(){let e=(0,n.o)(),t=(0,i.useRouter)(),[s,d]=(0,a.useState)(null),[c,l]=(0,a.useState)(!1);if(!e)return null;async function o(){e&&(l(!0),await e.auth.signOut(),l(!1),t.refresh())}return s?(0,r.jsxs)("span",{children:["\xb7 ",r.jsx("span",{className:"muted",title:s.email||void 0,children:"ログイン中"})," ",r.jsx("button",{className:"btn small",style:{marginLeft:".5rem"},onClick:o,disabled:c,children:c?"処理中…":"ログアウト"})]}):(0,r.jsxs)("span",{children:["\xb7 ",r.jsx("a",{href:"/auth",children:"ログイン"})]})}},3814:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(326),a=s(7577),i=s(5047);function n({open:e,title:t,onClose:s,children:a,actions:i}){return e?r.jsx("div",{className:"modal-backdrop",onClick:s,children:(0,r.jsxs)("div",{className:"modal-window",onClick:e=>e.stopPropagation(),children:[t&&r.jsx("div",{className:"modal-header",children:r.jsx("h3",{className:"heading-serif",style:{margin:0},children:t})}),r.jsx("div",{className:"modal-body",children:a}),i&&r.jsx("div",{className:"modal-actions",children:i})]})}):null}function d(){let{date:e}=(0,i.useParams)(),t=(0,i.useRouter)(),[s,d]=(0,a.useState)(""),[c,l]=(0,a.useState)([]),[o,m]=(0,a.useState)({}),[u,h]=(0,a.useState)(""),[p,x]=(0,a.useState)([]),[j,g]=(0,a.useState)(null),v=(0,a.useMemo)(()=>Array.isArray(e)?e[0]:e,[e]);async function N(){let e=async(e,t)=>{try{if(!e.ok||!(e.headers.get("content-type")||"").includes("application/json"))return t;return await e.json()}catch{return t}};try{let[t,s]=await Promise.all([fetch(`/api/entries?date=${v}`),fetch(`/api/comment?date=${v}`)]),r=await e(t,[]),a=await e(s,[]);l(r);let i={};for(let e of a)i[e.characterId]=e;m(i)}catch(e){}}async function y(){let e=await fetch("/api/summary",{method:"POST",body:JSON.stringify({date:v})});e.ok&&h((await e.json()).summaryText)}async function b(){if(!s.trim())return;let e=await fetch("/api/entries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:v,content:s})});if(!e.ok){let t=await e.json().catch(()=>({}));alert(t?.error?`投稿エラー: ${t.error}`:"投稿エラー");return}d(""),await N(),await y()}async function f(e){let t=await fetch("/api/comment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:v,character_id:e})});if(t.ok){let e=await t.json().catch(()=>null);e&&m(t=>({...t,[e.characterId]:e}))}else{let e=await t.json().catch(()=>({}));alert(e?.error==="openai_required"?"OpenAI未設定のため生成できません（REQUIRE_OPENAI=true）":"生成エラー")}}let P=j&&p.find(e=>e.id===j)||null,w=j?o[j]:void 0;return(0,r.jsxs)("div",{className:"day-grid",children:[r.jsx("div",{className:"card",style:{gridColumn:"1 / -1"},children:(0,r.jsxs)("div",{className:"row",style:{alignItems:"center"},children:[r.jsx("button",{className:"btn ghost",onClick:()=>t.push("/"),children:"← 別の日付へ"}),(0,r.jsxs)("h2",{style:{margin:0},children:["日別ページ: ",v]})]})}),(0,r.jsxs)("div",{className:"day-layout",style:{gridColumn:"1 / -1",width:"100%"},children:[(0,r.jsxs)("div",{className:"card",children:[r.jsx("h3",{children:"新規入力"}),r.jsx("textarea",{className:"input",rows:5,placeholder:"今日の出来事…",value:s,onChange:e=>d(e.target.value)}),r.jsx("div",{className:"row",children:r.jsx("button",{className:"btn primary",onClick:b,children:"投稿"})})]}),(0,r.jsxs)("div",{className:"card entries-card",children:[r.jsx("h3",{children:"当日エントリ"}),0===c.length&&r.jsx("p",{className:"muted",children:"まだありません"}),c.length>0&&r.jsx("div",{className:"stack",children:c.map(e=>(0,r.jsxs)("div",{className:"entry-card",children:[r.jsx("div",{className:"entry-meta",children:new Date(e.createdAt).toLocaleString()}),r.jsx("div",{style:{whiteSpace:"pre-wrap"},children:e.content})]},e.id))})]})]}),(0,r.jsxs)("div",{className:"card",style:{gridColumn:"1 / -1"},children:[r.jsx("h3",{children:"日全体要約"}),r.jsx("p",{style:{whiteSpace:"pre-wrap"},children:u||"（未生成）"}),r.jsx("div",{className:"row",children:r.jsx("button",{className:"btn",onClick:()=>fetch("/api/summary",{method:"POST",body:JSON.stringify({date:v,force:!0})}).then(async e=>{if(e.ok)await y();else{let t=await e.json().catch(()=>({}));alert(t?.error==="openai_required"?"OpenAI未設定のため要約できません（REQUIRE_OPENAI=true）":"要約エラー")}}),children:"再要約"})})]}),(0,r.jsxs)("div",{className:"card",style:{gridColumn:"1 / -1"},children:[r.jsx("h3",{children:"無料キャラ（自動展開）"}),r.jsx("div",{className:"grid",children:p.filter(e=>!e.premium).map(e=>(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"character-head",children:[r.jsx("img",{className:"avatar",src:`${e.icon}${e.icon.includes("?")?"&":"?"}v=${process.env.NEXT_PUBLIC_ASSET_TAG??""}`,alt:e.name,"data-tried":"namepng",onError:t=>{let s=(t.currentTarget.getAttribute("data-tried")||"").split(","),r=`${process.env.NEXT_PUBLIC_ASSET_TAG??""}`;if(!s.includes("idpng")){t.currentTarget.src=`/characters/${encodeURIComponent(e.id)}.png?v=${r}`,t.currentTarget.setAttribute("data-tried",[...s,"idpng"].join(","));return}if(!s.includes("idsvg")){t.currentTarget.src=`/characters/${encodeURIComponent(e.id)}.svg?v=${r}`,t.currentTarget.setAttribute("data-tried",[...s,"idsvg"].join(","));return}t.currentTarget.src=`/characters/placeholder.svg?v=${r}`}}),r.jsx("div",{children:(0,r.jsxs)("div",{children:[r.jsx("strong",{children:e.name})," ",r.jsx("span",{className:"muted",children:e.code}),o[e.id]&&r.jsx("span",{className:`badge ${o[e.id]?.model&&o[e.id]?.model!=="mock"?"ai":"mock"}`,children:o[e.id]?.model&&o[e.id]?.model!=="mock"?"AI":"Mock"})]})})]}),r.jsx("p",{style:{whiteSpace:"pre-wrap",minHeight:"2.4em"},children:o[e.id]?.commentText||"未生成"}),(0,r.jsxs)("div",{className:"row",children:[r.jsx("button",{className:"btn",onClick:()=>f(e.id),children:o[e.id]?"再生成":"生成"}),r.jsx("button",{className:"btn ghost",onClick:()=>g(e.id),children:"詳細"})]})]},e.id))})]}),(0,r.jsxs)("div",{className:"card",style:{gridColumn:"1 / -1"},children:[r.jsx("h3",{children:"課金キャラ（ロック）"}),r.jsx("div",{className:"grid",children:p.filter(e=>e.premium).map(e=>(0,r.jsxs)("div",{className:"card lock",children:[(0,r.jsxs)("div",{className:"character-head",children:[r.jsx("img",{className:"avatar",src:`${e.icon}${e.icon.includes("?")?"&":"?"}v=${process.env.NEXT_PUBLIC_ASSET_TAG??""}`,alt:e.name,"data-tried":"namepng",onError:t=>{let s=(t.currentTarget.getAttribute("data-tried")||"").split(","),r=`${process.env.NEXT_PUBLIC_ASSET_TAG??""}`;if(!s.includes("idpng")){t.currentTarget.src=`/characters/${encodeURIComponent(e.id)}.png?v=${r}`,t.currentTarget.setAttribute("data-tried",[...s,"idpng"].join(","));return}if(!s.includes("idsvg")){t.currentTarget.src=`/characters/${encodeURIComponent(e.id)}.svg?v=${r}`,t.currentTarget.setAttribute("data-tried",[...s,"idsvg"].join(","));return}t.currentTarget.src=`/characters/placeholder.svg?v=${r}`}}),r.jsx("div",{children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("strong",{children:["\uD83D\uDD12 ",e.name]})," ",r.jsx("span",{className:"muted",children:e.code}),o[e.id]&&r.jsx("span",{className:`badge ${o[e.id]?.model&&o[e.id]?.model!=="mock"?"ai":"mock"}`,children:o[e.id]?.model&&o[e.id]?.model!=="mock"?"AI":"Mock"})]})})]}),r.jsx("p",{className:"muted",children:"\xa5500で解放（MVP: 環境変数で解放可）"}),(0,r.jsxs)("div",{className:"row",children:[r.jsx("button",{className:"btn ghost",onClick:()=>f(e.id),children:"生成（解放時）"}),r.jsx("button",{className:"btn ghost",onClick:()=>g(e.id),children:"詳細"})]}),r.jsx("p",{style:{whiteSpace:"pre-wrap",minHeight:"2.4em"},children:o[e.id]?.commentText||"ロック中"})]},e.id))})]}),r.jsx(n,{open:!!P,title:P?`${P.name}（${P.code}）`:"",onClose:()=>g(null),actions:P?(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>f(P.id),children:w?"再生成":"生成"}),r.jsx("button",{className:"btn ghost",onClick:()=>g(null),children:"閉じる"})]}):null,children:P&&(0,r.jsxs)("div",{className:"stack",children:[(0,r.jsxs)("div",{className:"character-head",children:[r.jsx("img",{className:"avatar",src:`${P.icon}${P.icon.includes("?")?"&":"?"}v=${process.env.NEXT_PUBLIC_ASSET_TAG??""}`,alt:P.name}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"muted",children:["モデル: ",w?.model||"—"]}),(0,r.jsxs)("div",{className:"muted",children:["時刻: ",w?.generatedAt?new Date(w.generatedAt).toLocaleString():"—"]})]})]}),r.jsx("div",{className:"card",style:{background:"#fff",borderColor:"var(--border)"},children:r.jsx("div",{style:{whiteSpace:"pre-wrap",fontSize:"1.05rem",lineHeight:1.7},children:w?.commentText||"未生成（生成を押してください）"})})]})})]})}},7574:(e,t,s)=>{"use strict";s.d(t,{o:()=>a});var r=s(9813);function a(){return(0,r.createClientComponentClient)()}},8768:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`C:\Users\suo06\Project\systemmegane\app\day\[date]\page.tsx#default`)},1506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c,metadata:()=>d});var r=s(9510),a=s(9698),i=s.n(a);s(7272),s(3701);let n=(0,s(5782).default)(()=>s.e(464).then(s.bind(s,6464)),{loadableGenerated:{modules:["app\\layout.tsx -> @/app/components/AuthMenu"]},ssr:!1}),d={title:"社会システム日記",description:"多視点の“コードAIキャラ”が日記にコメントするアプリ"};function c({children:e}){return r.jsx("html",{lang:"ja",children:r.jsx("body",{className:i().variable,children:(0,r.jsxs)("div",{className:"container",children:[(0,r.jsxs)("header",{children:[r.jsx("h1",{children:"社会システム日記"}),(0,r.jsxs)("nav",{className:"muted",children:[r.jsx("a",{href:"/",children:"ホーム"}),r.jsx(n,{})]})]}),r.jsx("main",{children:e})]})})})}},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,752],()=>s(6494));module.exports=r})();